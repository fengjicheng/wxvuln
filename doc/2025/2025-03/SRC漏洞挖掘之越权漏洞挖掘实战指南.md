#  SRC漏洞挖掘之越权漏洞挖掘实战指南   
原创 炽汐安全屋  炽汐安全屋   2025-03-18 18:19  
  
## 一、越权漏洞简介  
### 1.1 什么是越权漏洞？  
  
越权漏洞（Privilege Escalation）是指攻击者通过某种方式绕过系统的权限控制机制，访问到超出其正常权限范围的资源或功能。这种漏洞通常发生在Web应用中，尤其是在用户身份验证和权限管理不当的情况下。  
### 1.2 越权漏洞的危害  
- **数据泄露**  
：攻击者可以访问到敏感数据，如其他用户的个人信息、订单记录等。  
  
- **功能滥用**  
：攻击者可能执行系统中只有高级用户才能执行的操作，例如删除数据、修改配置等。  
  
- **权限提升**  
：通过越权漏洞，攻击者可能进一步获取更高的系统权限，从而完全控制系统。  
  
### 1.3 越权漏洞分类  
  
根据攻击方式和权限范围，越权漏洞可以分为以下几类：  
1. **水平越权**  
：攻击者访问同一权限级别下的其他用户资源。  
  
1. 示例：普通用户A可以查看普通用户B的订单信息。  
  
1. **垂直越权**  
：攻击者访问高于其当前权限级别的资源或功能。  
  
1. 示例：普通用户伪造请求，执行管理员-only操作。  
  
## 二、越权漏洞挖掘方法  
### 2.1 手动检测  
#### 1. 识别潜在越权点  
- **用户身份相关接口**  
：如用户资料查看、订单管理等。  
  
- **权限敏感操作**  
：如删除数据、修改配置等。  
  
#### 2. 测试步骤  
1. **注册多个账号**  
创建不同权限的账号（例如普通用户和管理员），用于模拟越权场景。  
  
1. **分析请求参数**  
使用抓包工具（如Burp Suite）捕获请求，观察是否有用户ID、role字段等可篡改的参数。  
  
1. **伪造请求**  
修改请求中的权限相关参数，尝试访问不属于当前用户的资源或功能。  
  
1. **验证结果**  
根据响应判断是否成功越权。例如，是否能查看其他用户的数据，或执行高级操作。  
  
#### 3. 示例：基于参数篡改的越权漏洞  
  
假设某系统的订单查看接口为：  
  
GET /orders?userId=123  
  
攻击者可以修改userId  
为其他用户的ID，若系统未验证权限，可能成功查看他人订单。  
### 2.2 自动化工具辅助检测  
1. **Burp Suite**  
1. 使用Intruder模块枚举用户ID，测试是否能访问其他用户资源。  
  
1. **Postman**  
1. 手动修改请求头或参数，测试越权场景。  
  
## 三、特殊情况处理  
### 3.1 绕过权限校验  
- **伪造身份验证信息**  
修改Cookie或Token中的用户ID或role字段。  
  
- **利用JSON参数不严谨性**  
某些系统可能仅前端校验权限，后端未严格验证。  
  
### 3.2 绕过WAF规则  
- **参数隐藏**  
将越权相关的参数隐藏在其他参数中，或使用参数混淆。  
  
- **多步跳转**  
分步骤执行操作，避免触发权限校验逻辑。  
  
## 四、防御与修复  
### 4.1 权限管理最佳实践  
1. **严格的RBAC模型**  
1. 根据角色分配资源访问权限。  
  
1. **动态权限校验**  
1. 每次请求都验证用户是否有权限执行操作。  
  
### 4.2 输入参数白名单  
- 对所有输入参数进行严格过滤，防止恶意篡改。  
  
### 4.3 日志审计  
- 记录敏感操作日志，及时发现异常行为。  
  
## 五、实战案例  
### 案例1：基于路径的越权漏洞  
  
某系统的用户资料接口为：  
  
GET /users/{id}/profile  
  
攻击者可以修改{id}  
为其他用户ID，若系统未验证权限，可能成功查看他人资料。  
  
**修复方法**  
：在后端增加权限校验逻辑，确保当前用户与请求中的用户ID一致。  
### 案例2：基于功能的越权漏洞  
  
某系统的删除订单接口仅前端隐藏了“删除”按钮，但未在后端验证权限。攻击者可以通过修改请求参数执行删除操作。  
  
**修复方法**  
：在后端增加权限校验，确保只有订单所有者或管理员才能删除订单。  
## 六、总结  
  
越权漏洞是Web应用中较为隐蔽但危害巨大的安全问题。通过手动测试和工具辅助，可以有效发现潜在的越权风险。在防御方面，严格的权限管理和输入验证是关键。开发者需时刻保持警惕，确保每一处敏感操作都经过充分校验。  
  
**SRC安全研究团队****为网络空间的安全而努力！**  
  
  
