#  【已支持暴露面风险排查】Rsync缓冲区溢出与信息泄露漏洞（CVE-2024-12084/CVE-2024-12085）   
原创 NS-CERT  绿盟科技CERT   2025-01-17 23:48  
  
**通告编号:NS-2024-0004-1**  
  
2025-01-17  
  
<table><tbody style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><tr style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><td valign="top" style="-webkit-tap-highlight-color: transparent;margin: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-color: rgb(216, 216, 216);visibility: visible;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;visibility: visible;">TA</span></strong><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;visibility: visible;">G：</span></strong></td><td valign="top" style="-webkit-tap-highlight-color: transparent;margin: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-color: rgb(216, 216, 216);visibility: visible;"><p style="-webkit-tap-highlight-color: transparent;outline: 0px;vertical-align: inherit;line-height: 1.75em;font-size: 14px;color: rgb(0, 0, 0);font-family: 微软雅黑;visibility: visible;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;caret-color: red;line-height: 1.5em;letter-spacing: normal;font-family: 微软雅黑, &#34;Microsoft YaHei&#34;;visibility: visible;">Rsync、CVE-2024-12084、CVE-2024-12085</strong></p></td></tr><tr style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><td valign="top" style="-webkit-tap-highlight-color: transparent;margin: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-color: rgb(216, 216, 216);visibility: visible;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;color: rgb(0, 0, 0);visibility: visible;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;visibility: visible;">漏洞危害：</span></strong></span><span style="-webkit-tap-highlight-color: transparent;outline: 0px;color: rgb(255, 0, 0);visibility: visible;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;visibility: visible;"></span></strong></span></td><td valign="top" style="-webkit-tap-highlight-color: transparent;margin: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-color: rgb(216, 216, 216);visibility: visible;"><p style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;caret-color: red;line-height: 1.5em;letter-spacing: normal;font-size: 14px;font-family: 微软雅黑, &#34;Microsoft YaHei&#34;;visibility: visible;">攻击者利用此次漏洞，可实现远程代码执行。</strong></p></td></tr><tr style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><td valign="top" style="-webkit-tap-highlight-color: transparent;margin: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-color: rgb(216, 216, 216);visibility: visible;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;visibility: visible;">版本：</span></strong></td><td valign="top" style="-webkit-tap-highlight-color: transparent;margin: 5px 10px;outline: 0px;word-break: break-all;hyphens: auto;border-color: rgb(216, 216, 216);visibility: visible;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;visibility: visible;">1.1<br style="-webkit-tap-highlight-color: transparent;outline: 0px;visibility: visible;"/></span></strong></td></tr></tbody></table>  
  
**1**  
  
  
**漏洞概述**  
  
  
近日，绿盟科技监测到Rsync发布安全公告，修复了Rsync中的缓冲区溢出与信息泄露漏洞（CVE-2024-12084/CVE-2024-12085），两个漏洞组合使用可实现远程代码执行，请相关用户尽快采取措施进行防护。  
  
CVE-2024-12084：Rsync守护进程中存在堆缓冲区溢出漏洞，由于对用户控制的校验和长度 (s2length) 处理不当，当Rsyncd配置为允许匿名访问时，攻击者可通过构造恶意的s2length值将数据写入内存中超出分配范围的区域，从而实现远程代码执行。CVSS评分9.8。  
  
CVE-2024-12085：Rsync守护进程存在内存缓冲区内操作限制不当的问题，由于未正确初始化内存，当Rsync比较文件校验和时攻击者可通过特定操作读取未初始化的内存数据，造成信息泄露。CVSS评分7.5。  
  
Rsync是一个功能强大的文件同步工具，主要用于在本地或网络中的不同位置高效地复制和同步文件和目录，广泛应用于备份、镜像站点管理以及远程文件同步。Rsync服务默认开放在873端口/TCP，Rsync Daemon（Rsyncd）是Rsync服务端的守护进程。  
  
  
参考链接：  
  
https://download.samba.org/pub/rsync/NEWS#3.4.0  
  
  
**SEE MORE →**  
  
  
**2****影响范围**  
  
**受影响版本：**  
  
CVE-2024-12084  
：  
- Rsync = 3.2.7  
  
- Rsync = 3.3.0  
  
CVE-2024-12085  
：  
- Rsync <= 3.3.0  
  
已知影响Linux发行版：Ubuntu、Debian、AlmaLinux OS、Arch Linux、Gentoo Linux、NixOS、SUSE Linux、Triton Data Center  
  
**注：**  
Rsync默认安装时，Rsyncd守护进程需手动配置后才会启用，建议重点关注可能开放匿名访问的文件共享和公共镜像主机。  
  
  
**不受影响版本：**  
  
- Rsync >= 3.4.0  
  
  
  
  
**3****漏洞检测**  
  
**3.1 版本检测**  
  
相关用户可以通过下列命令查看当前使用的Rsync版本来判断系统是否在影响范围：  
<table><tbody><tr><td width="436" valign="top" style="padding: 0pt 5.4pt;border-width: 1pt;border-color: windowtext;background: rgb(215, 215, 215);"><section style="text-align: justify;line-height: 1.5em;"><span style="font-family: Arial;font-size: 14px;">rsync --version</span><span style="font-family:宋体;font-size:12.0000pt;"><o:p></o:p></span></section></td></tr></tbody></table>  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvHwTRRrscxIuuLuO69tDHbFn4b0K4V7dSfuulyENFTdWSzBLD3Da1ggA/640?wx_fmt=png&from=appmsg "")  
  
  
**3.2 产品检测**  
  
绿盟科技远程安全评估系统（RSAS）已具备对Rsync匿名访问与相关漏洞登录扫描的检测能力，请有部署此设备的用户升级至最新版本。  
<table><tbody style="-webkit-tap-highlight-color: transparent;outline: 0px;"><tr style="-webkit-tap-highlight-color: transparent;outline: 0px;"><td width="80" style="-webkit-tap-highlight-color: transparent;padding: 0cm 5.4pt;outline: 0px;word-break: break-all;hyphens: auto;border-top: 1.5pt double windowtext;border-right-width: 1pt;border-right-color: windowtext;border-bottom: none;border-left: 1.5pt double windowtext;background: rgb(217, 217, 217);"><br/></td><td width="61" style="-webkit-tap-highlight-color: transparent;padding: 0cm 5.4pt;outline: 0px;word-break: break-all;hyphens: auto;border-top: 1.5pt double windowtext;border-right-width: 1pt;border-right-color: windowtext;border-bottom: none;border-left: none;background: rgb(217, 217, 217);"><p style="-webkit-tap-highlight-color: transparent;margin-bottom: 0.0001pt;outline: 0px;text-align: left;text-indent: 0cm;line-height: 21.25px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;">升级包版本号</span></strong><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;"><o:p style="-webkit-tap-highlight-color: transparent;outline: 0px;"></o:p></span></span></p></td><td width="130" style="-webkit-tap-highlight-color: transparent;padding: 0cm 5.4pt;outline: 0px;word-break: break-all;hyphens: auto;border-top: 1.5pt double windowtext;border-right: 1.5pt double windowtext;border-bottom: none;border-left: none;background: rgb(217, 217, 217);"><p style="-webkit-tap-highlight-color: transparent;margin-bottom: 0.0001pt;outline: 0px;text-align: left;text-indent: 0cm;line-height: 21.25px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;">升级包下载链接</span></strong><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;"><o:p style="-webkit-tap-highlight-color: transparent;outline: 0px;"></o:p></span></span></p></td></tr><tr style="-webkit-tap-highlight-color: transparent;outline: 0px;"><td width="80" valign="top" style="-webkit-tap-highlight-color: transparent;padding: 0cm 5.4pt;outline: 0px;word-break: break-all;hyphens: auto;border-width: 1pt 1pt 1pt 1.5pt;border-left-style: double;border-color: windowtext;background: rgb(230, 230, 230);"><p style="-webkit-tap-highlight-color: transparent;margin-bottom: 0.0001pt;outline: 0px;text-align: left;text-indent: 0cm;line-height: 21.25px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-size: 14px;"><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;">RSAS V6</span></strong><strong style="-webkit-tap-highlight-color: transparent;outline: 0px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;">系统插件升级包</span></strong></span><span style="font-size: 14px;-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;"><o:p style="-webkit-tap-highlight-color: transparent;outline: 0px;"></o:p></span></p></td><td width="61" valign="top" style="-webkit-tap-highlight-color: transparent;padding: 0cm 5.4pt;outline: 0px;word-break: break-all;hyphens: auto;border-top-width: 1pt;border-top-color: windowtext;border-right-width: 1pt;border-right-color: windowtext;border-bottom-width: 1pt;border-bottom-color: windowtext;border-left: none;"><p style="-webkit-tap-highlight-color: transparent;margin-bottom: 0.0001pt;outline: 0px;text-align: left;text-indent: 0cm;line-height: 21.25px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;font-size: 14px;">V6.0R02F01.3902<o:p style="-webkit-tap-highlight-color: transparent;outline: 0px;"></o:p></span></p></td><td width="150" valign="top" style="-webkit-tap-highlight-color: transparent;padding: 0cm 5.4pt;outline: 0px;word-break: break-all;hyphens: auto;border-top-width: 1pt;border-top-color: windowtext;border-right: 1.5pt double windowtext;border-bottom-width: 1pt;border-bottom-color: windowtext;border-left: none;"><p style="-webkit-tap-highlight-color: transparent;margin-bottom: 0.0001pt;outline: 0px;text-align: left;text-indent: 0cm;line-height: 21.25px;"><span style="-webkit-tap-highlight-color: transparent;outline: 0px;font-family: 微软雅黑, sans-serif;font-size: 14px;">https://update.nsfocus.com/update/listRsasDetail/v/vulsys<o:p style="-webkit-tap-highlight-color: transparent;outline: 0px;"></o:p></span></p></td></tr></tbody></table>  
关于RSAS的升级配置指导，请参考如下链接：  
  
https://mp.weixin.qq.com/s/SgOaCZeKrNn-4uR8Yj_C3Q  
  
  
**4****暴露面风险排查方案**  
  
**4.1 云端检测**  
  
目前绿盟科技鹰眼运营中心的两高一弱排查方案已支持针对Rsync服务暴露的风险排查：  
   
  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvHLHRwIOJmcuWkoZ5o1o2MhbXfsFntKgh8DVu23LCedEIsXfw3IA8hSA/640?wx_fmt=png&from=appmsg "")  
  
绿盟科技外部攻击面管理服务（EASM）可进行Rsync相关漏洞风险的互联网资产排查，目前已帮助服务客户群体完成了暴露面摸排与风险验证，在威胁发生前及时进行漏洞预警与闭环处置。  
  
**有需要的用户请访问下列链接或扫描二维码登记进行免费试用：**  
  
https://t1.nsfocus.com/portal#/applyUse?product=cards  
  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvHnDtAhbmN1tje25pLfiaZANmFzXOibhLZmIp8xR8TsDYRkBibf89D3hJ3Q/640?wx_fmt=png&from=appmsg "")  
  
   
  
另，若对EASM服务感兴趣的客户可通过联系绿盟当地区域同事或发送邮件至rs@nsfocus.com安排详细的咨询交流。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvHYpVWOZ5eU8WHLjuDN4AEIHhTJr5yYJ4BPzBd7dGnZ7hgojOBhXzibrw/640?wx_fmt=png&from=appmsg "")  
  
  
**4.2 本地排查**  
  
绿盟科技  
CTEM解决方案可以被动  
+主动进行  
Rsync  
相关资产的发现和排查：  
  
用户使用外部攻击面发现功能将  
Rsync  
漏洞线索同步至云端，可通过资产测绘的方式获取目标单位的受影响资产。  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvHOj17e7cicdRicmsbs6zurqTuLTDc0PBibPNnEhZztD0sgqC5DcWDNAs2g/640?wx_fmt=png&from=appmsg "")  
  
  
用户添加扫描任务，可通过选择资产组或手动添加内外网主机  
IP  
；  
  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvHKhGenKSJiatB5PiaX0K7gicVSwGjibLpu15CHtriabFUkVosF5pf6vfeMpg/640?wx_fmt=png&from=appmsg "")  
  
  
可设置  
Rsync  
默认  
873  
端口进行扫描；  
  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvH6zyFo95avsqzVFadBCia9IaPkdFkBFLuyuyPyIZH2iaPxywgoD7T0DSQ/640?wx_fmt=png&from=appmsg "")  
  
可对资产发现结果进行筛选和处置。  
  
同时，  
绿盟科技**自动化渗透测试工具（EZ）**  
目前已支持  
Rsync  
服务的匿名访问验证，可使用下列命令对单个或批量主机进行检测：  
<table><tbody><tr><td style="padding: 0px 7px;border-color: windowtext;background: none 0% 0% repeat scroll rgb(215, 215, 215);" width="581" valign="top"><p><span style="font-family: Arial;font-size: 14px;color: rgb(0, 0, 0);">./ez servicescan --hosts 192.168.13.41 --ports 873 --pocs rsync</span></p></td></tr><tr><td style="padding: 0px 7px;border-color: currentcolor windowtext windowtext;border-top-style: none;border-top-width: medium;background: none 0% 0% repeat scroll rgb(215, 215, 215);" width="581" valign="top"><p><span style="font-family: Arial;font-size: 14px;color: rgb(0, 0, 0);">./ez servicescan --hosts-file ip.txt --ports 873 --pocs rsync</span></p></td></tr></tbody></table>  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvHqvFsibkyd26zArwjXcQPU3lMrSbSEu2nqic1MEg8EZL2D3hy5E91ZVyQ/640?wx_fmt=png&from=appmsg "")  
  
若使用的受影响版本  
Rsync开放匿名访问，则说明存在安全风险。  
  
工具下载链接：  
https://github.com/m-sec-org/EZ/releases  
  
新用户请注册绿盟科技**M-SEC社区**  
(已备案)申请证书进行使用：  
https://msec.nsfocus.com  
  
![](https://mmbiz.qpic.cn/mmbiz_png/VvfsuOanecoLgSibTmtTZFRTIicMe70uvH4riajLb2RYUGxk3xhblCFnOswH0vic76sKbHhC2IbYpNdnTfzSbCq5EA/640?wx_fmt=png&from=appmsg "")  
  
  
  
**5****漏洞防护**  
  
**5.1 官方升级**  
  
目前官方已发布新版本修复了上述漏洞，请受影响的用户尽快升级版本进行防护，下载链接：https://rsync.samba.org/download.html  
  
  
**5.2 其他防护措施**  
  
若相关用户暂时无法进行升级操作，可通过下列措施进行临时缓解：  
  
1、CVE-2024-12084：  
可修改Rsyncd配置文件，添加auth users和secrets file，创建包含用户和密码的文件，禁止Rsync的匿名读取权限。  
<table><tbody><tr><td width="411" valign="top" style="padding: 0pt 5.4pt;border-width: 1pt;border-color: windowtext;background: rgb(215, 215, 215);word-break: break-all;"><section style="margin-bottom: 0pt;margin-left: 0pt;text-align: left;line-height: 1.75em;text-indent: 0em;"><span style="font-size: 14px;color: rgb(0, 0, 0);"><span style="font-family: Arial;line-height: 125%;">auth users = &lt;username&gt;<br/>secrets file = /etc/rsyncd.secrets</span><span style="font-family: Arial;line-height: 125%;background: rgb(255, 255, 255);"><o:p></o:p></span></span></section></td></tr></tbody></table>  
CVE-2024-12085：可使用“-ftrivial-auto-var-init=zero”选项集编译Rsync，实现零初始化“sum2”变量的内存。  
  
2、用户可通过主机和网络防火墙设备上的防火墙规则过滤不受信任的Rsync连接，在不影响业务的前提下可屏蔽Rsync服务端口或进行访问限制。  
  
  
  
  
**END**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qR4ORTNELImFwJM2rh6GKbnrurdFA28jJ8chUPyC1U6aW3jhenqEiaXkmeGVmfOnvAJy8j3My901JQ7emHaicYzA/640?wx_fmt=png "")  
           
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/qR4ORTNELImFwJM2rh6GKbnrurdFA28jib7icfic0lJJHh3eLRpIXiaia08KqOSEibBsz64vlOH9aqicu3lmjccEeAFWQ/640?wx_fmt=jpeg "")  
          
  
**声明**  
  
本安全公告仅用来描述可能存在的安全问题，绿盟科技不为此安全公告提供任何保证或承诺。由于传播、利用此安全公告所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，绿盟科技以及安全公告作者不为此承担任何责任。              
  
绿盟科技拥有对此安全公告的修改和解释权。如欲转载或传播此安全公告，必须保证此安全公告的完整性，包括版权声明等全部内容。未经绿盟科技允许，不得任意修改或者增减此安全公告内容，不得以任何方式将其用于商业目的。              
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/qR4ORTNELImFwJM2rh6GKbnrurdFA28jib7icfic0lJJHh3eLRpIXiaia08KqOSEibBsz64vlOH9aqicu3lmjccEeAFWQ/640?wx_fmt=jpeg "")  
  
  
**绿盟科技CERT**  
****  
∣  
微信公众号  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/VvfsuOanecoLgSibTmtTZFRTIicMe70uvHLXyPV08siaicmVmymksxribtBgBC20kupX6JQbz8sRpHtwsKSj4QSTtlA/640?wx_fmt=jpeg&from=appmsg "绿盟科技CERT公众号.jpg")  
  
![](https://mmbiz.qpic.cn/mmbiz/Hu8hctxHqSW0nSJn8p8OHVEQwHicSwTibFJMBE650AxdzfISoeY8woe2QsgCINIBrccBOOUft2HuU0GsNQWibSG7g/640 "")  
  
长按识别二维码，关注网络安全威胁信息  
  
  
