#  Apache Tomcat远程代码执行漏洞(CVE-2024-50379)复现+修复方案.   
原创 Btwlon  极梦C   2024-12-19 02:33  
  
前言  
  
有点鸡肋呀  
‍  
‍  
‍  
‍  
‍  
‍  
‍  
‍  
  
  
不是星标不推送文章了。  
  
师傅也不想吧~  
  
快把  
极梦C设置成星标吧。  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlPCA2vI3xOYHWBzrD7soYIHtwq9sBxicB1jiaWzHhjVOSsaEMDiaSBx2OF3FdLXibIPTaox8TvhtyNow/640?wx_fmt=png&from=appmsg&wxfrom=13 "")  
  
  
  
‍  
  
漏洞描述  
‍  
‍  
‍  
‍  
  
  
  
该漏洞源于 Windows 文件系统与 Tomcat 在路径大小写敏感性处理上的不一致。攻击者利用了 Tomcat 路径校验逻辑中的缺陷，通过绕过路径一致性检查，将原本无法解析的文件（如大小写不同的 JSP 文件）转为可解析状态。  
  
当默认 Servlet 的 readonly 参数被设置为 false（非默认配置）并允许使用 PUT 方法上传文件时，攻击者能够上传包含恶意 JSP 代码的文件并通过条件竞争不断发送请求，触发 Tomcat 对其解析和执行，最终实现远程代码执行。  
  
  
  
  
漏洞版本  
‍  
‍  
‍  
‍  
  
  
  
- Apache Tomcat 11.0.0-M1 to 11.0.1  
  
- Apache Tomcat 10.1.0-M1 to 10.1.33  
  
- Apache Tomcat 9.0.0.M1 to 9.0.97  
  
- 复现版本：Apache Tomcat 9.0.96  
  
  
  
  
  
  
复现过程  
‍  
‍  
‍  
‍  
‍  
‍  
‍  
‍  
  
  
  
修改web.xml中的readonly为false  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSk3nHOvlPKicVPEUk8MaHOXvwD45BkOEdSpnIib7ZTBew0wFwicneCIONLdgaPiaiaAJpoSQzoqfqibdBjA/640?wx_fmt=png&from=appmsg "")  
  
  
同时进行以下多个请求（注：经过验证，单个PUT配合GET也可以实现，但是概率会很低，成功的两次访问数量分别为2w和7w）  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSk3nHOvlPKicVPEUk8MaHOXvPwFwibA1LlEjOR76qJxIqHtrNSNibGGQmfwGBaPDtzXFty8ES8PldZHg/640?wx_fmt=png&from=appmsg "")  
  
  
写入的Jsp文件  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSk3nHOvlPKicVPEUk8MaHOXvibPhXOQc7pOUfkyqTGu8koZoHsnIqGureyVrvpnsFhnbOaMjudzj0Rw/640?wx_fmt=png&from=appmsg "")  
  
  
不断请求，成功访问到jsp，从请求数量也可以看出成功率很低（最少案例200个get请求左右）  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSk3nHOvlPKicVPEUk8MaHOXvTwnzlxRm9zDgDzojlBL8FjicImx8BDqbqMAwWAyr1pBKTiatesQYuibJg/640?wx_fmt=png&from=appmsg "")  
  
  
  
  
这是弹计算机的效果，一弹一个不吱声  
‍  
‍  
  
<% Runtime.getRuntime().exec("calc.exe");%>  
  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSk3nHOvlPKicVPEUk8MaHOXvjRAl6skLCn8s8X5nkuMIibMq30jpo8tNK9sl0aPBCKhesB36XT3Y89A/640?wx_fmt=png&from=appmsg "")  
  
  
解决方案  
‍  
‍  
‍  
‍  
  
  
  
  
1、根据业务需求评估，将 conf/web.xml文件中的 readOnly 参数设置为 true 或注释该参数，禁用 PUT 方法并重启 Tomcat 服务以使配置生效，从而临时规避该安全风险。  
  
2、  
Apache 官方已发布安全通告并发布了修复版本，下载安全版本修复漏洞：  
  
Tomcat 11.0.2：https://tomcat.apache.org/download-11.cgi  
  
Tomcat 10.1.34：https://tomcat.apache.org/download-10.cgi  
  
Tomcat 9.0.98：https://tomcat.apache.org/download-90.cgi  
  
  
  
  
  
  
  
  
  
  
关于文章/Tools获取方式:请关注交流群或者知识星球。  
  
  
  
  
  
  
  
  
  
  
  
关于交流群：因为某些原因，更改一下交流群的获取方式:  
  
1.请点击  
联系我们->联系官方->客服小助手添加二维码拉群 。    
  
![](https://mmbiz.qpic.cn/mmbiz_png/1kZ9ibb5tl5Cia8Pe5Tln5a1lCBThxiaRvVvH8JJuXhTTsErgic1iasMfD6PWd4XXT4LBvDic60A9GCzEIP8PXo0Kchg/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
  
  
  
  
  
关于知识星球的获取方式:  
  
1.后台回复发送 "  
知识星球"，即可获取知识星球二维码。  
  
2如若上述方式不行，请点击  
联系我们->联系官方  
->客服小助手添加二维码进入星球 。    
  
3.为了提高质量,推出"  
免费名人堂"名额,后台回复发送 "  
知识星球"了解详情。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/1kZ9ibb5tl5Cia8Pe5Tln5a1lCBThxiaRvVvH8JJuXhTTsErgic1iasMfD6PWd4XXT4LBvDic60A9GCzEIP8PXo0Kchg/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
  
  
  
  
  
  
**团队介绍**  
  
高级攻防小组,  
  
5年以上一线攻击选手,每年30场+，成绩均占比前10%。部/省/市/行业  
  
src第一，混迹于各种众测。  
  
多个红队平台等。  
  
实战派，一切为了实战。  
  
  
  
  
  
  
  
  
  
后台回复"红队",进入实战派红队的小白交流群。后台回复"交流群",进入闲聊的小白交流群。  
  
  
  
  
  
  
  
承接红蓝对抗,安全众测,安全培训,SRC培训,代码审计,渗透测试,  
应急响应,免杀等.  
  
(  
安全可靠,排名稳定,战绩可查.  
)  
  
  
  
  
  
  
  
  
星梦计划招生ing中.实战src的全方位讲解.  
‍  
‍  
‍  
‍  
‍  
‍  
‍  
‍  
  
  
  
  
  
  
  
  
  
  
  
  
**星球内容**  
  
正式运营星球:  
  
1.src真实漏洞挖掘案例分享(永久不定时更新),过程详细一看就会哦。2.自研/二开等工具/平台的分享。3.漏洞分析/资料共享等。  
  
  
  
  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlo4h8cmibntTlCFJO50vLYJfy8uKibLLHDg5vYO9Nk7Kq2iae9W4XXBb6ibK0n1bFUficfAX5PsFdnOgQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlo4h8cmibntTlCFJO50vLYJWQ5NdqGKzjia4icYxYJF983A5mK16QuckdE1YP75DDucumLf1jeR2CsQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlo4h8cmibntTlCFJO50vLYJtX5icqZ4xibyqYKroLOib6W5Kqick33EUNMTSvLht1R1CnD9K3IuoFmAWQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlo4h8cmibntTlCFJO50vLYJZqm9JCxoxrXOX8v37SRwYB9nlFBhkMic2Z1cy0xeuhicwCFwp3eNw9Tw/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSky2ErOwFMfuyBnU31x1Uj6PZWogemf5REJPYa31WqIP75F0uUvDf3ywh1XkUcHIOTRBc1DOAGbxQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSky2ErOwFMfuyBnU31x1Uj6u4N6BicUcM7TJxHo4tPCEQZblwje3MOyvqzRSYktzx5sOHgWemFSCKQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSky2ErOwFMfuyBnU31x1Uj62xTEZXPnApSbR28MKQYOZoibA0WvqrF1nIrbYlIhY309yl5Fib93w7nQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlX35A5dqqibBHic3oEWTbTpbylJlHkMPgSQMmWjibT53vcuN61Lq9GTnv8jByMm8VwDfkrSicok5ibWZA/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSky2ErOwFMfuyBnU31x1Uj6Fb9iaIicjZAOuqcCACD1TRqS6wbwtXf0qwNpaTIobcQkIERoYMmBk7jQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlX35A5dqqibBHic3oEWTbTpb32IeKkcDcHPpBowfT8j9icCVPItPaDdNs0liaUqDNLksmhpGpCp3Q05w/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlX35A5dqqibBHic3oEWTbTpb0oaLpENCfpxATTSY3bILwibIbxiaEcWeExDZ642h345GAQsvhZvmjo0Q/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmuqib0x4yT0TT6icYMyR1tLz7alpqZuzwFkLpypdkpMfx2dNNFjkaoPxmEBsGSy1cknnibaR1oKW6mA/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmuqib0x4yT0TT6icYMyR1tLzrFXyia2GhKl9L22tStIEIru8aSlso95Md9asCGFGnHdqvVW6H9UXQeQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmuqib0x4yT0TT6icYMyR1tLzMCrslouPl5wzysOaZ6GIpwfaZ1L0NCFwnwu8lZ6oXIjpresJ3MfQYA/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmuqib0x4yT0TT6icYMyR1tLzp18hvAZVuvhwiaYoEBia6nK5HET8ltnnAMHeEKtjlbjSicMQ1GY07J1nQ/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmuqib0x4yT0TT6icYMyR1tLzXJtMGdicLibDYnHqp9Dl7Rge4u0PkJKU1EsiceZBbVb97GB4d0LicEj5Lw/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmjh5T2BWl7sh6ibOqyW3WJs5iaZkV6fibKHBKBEbLRGibibxAnH0Xib0lV7TEVowYW6cc9lIxdLm40zMiaw/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmjh5T2BWl7sh6ibOqyW3WJsDawzjlOuS14heZX9Ax3ILJB3l8DLu0aibBrwQoPdZZbo0EGlnTbMOOw/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmjh5T2BWl7sh6ibOqyW3WJsyDpZjQm83zhVsbDfbE9hpHfNXJ4HwE4gT9gAWUy6KnabUT5licIUTuA/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSmjh5T2BWl7sh6ibOqyW3WJs7aU4jAFIicWHNNFE2JYdxp7YgeaOicrjiajBkTJoh04Kn22JNOXe1wAiaw/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSkapr9ibNichibdQvJRftuppYvBJ59bRw5U7Z7SJrjjJIzrc1hkt0KA0fYwem40ic38QUxSYKUrPtnXnw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSkapr9ibNichibdQvJRftuppYvwgaZYIqtr1sANR78ItvL2WHzevCxgxcMnVVIO1ic9icN0el1sagY8cTg/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSkapr9ibNichibdQvJRftuppYvIEI0c5l4xahhibPpsyeCOxibnPYBlwxp0Ur1qggMicTqjQ0CjYmybqY8w/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSkapr9ibNichibdQvJRftuppYvqa0Ljd3KNKiaiaVRHOVO2J6UMQp7NaATEjA8Offk95pgqU0QoQ5kwYmw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSl9WoxvpvP82uRH1icibXgibmnxENltLsziaPGpmiaETT88fVsxsP27BeKmSygjlOqP4EiaHibcqF8nxjBHg/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSl9WoxvpvP82uRH1icibXgibmnmIvT9OAicFGJTRFAesAIOlHmjV9n3GEd6p7cLia2PMmx8mOiaBq364QvA/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSl9WoxvpvP82uRH1icibXgibmnicQQBrS8TSFaAEB4Fn0aXe7U1yUTFgAdV2xrlaGgBHCibAknIyPs1vMA/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSl9WoxvpvP82uRH1icibXgibmnial7HAVjwsvE6kJ5kiarSSVsCiczcKYNH3XeZDnDRxziayyGDenaoOKXvg/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlgTbk0KyY4C4MGX2mwfnoFZLA5YgPHPuicRiaMQx5u9W2m714Pib1fhKclZDaHomrffqYWDvd5WJdew/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlgTbk0KyY4C4MGX2mwfnoFHTKAB5KEEC5RicaErl9j7gicSql43JARkLUd8Oruoxx2Sq8f4osF3JibA/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSnr7SlwGhKoiasYiafFqzG1XichI6kcicxRGXc1rOZVjlCePs8ZpKyl6cazYKTUoNhhc76zOsdGlAeIaw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSnr7SlwGhKoiasYiafFqzG1XicicFcU3cmGric3yjbAtkygkdI4YDkkyvdHD1YGH403f5zVbwrh5Aevkbw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSnr7SlwGhKoiasYiafFqzG1XicCG2eqITmBTvTibuP9tHxzqpiajO39odva0icdw2S37sbMfZBgRGQVxCQA/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSnr7SlwGhKoiasYiafFqzG1XicibdibfcCYQV0cP5DAUQG2u05S5j5W6KeM8f8sFJia60fxyFBDHExorbZw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSliaepxgObwEg6xDKmF21o9ftUibLopE3Xs5Z9Dm52Q7Lox57X1d89mrun3eWyUCKSTXMyYIibUV3lKg/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSliaepxgObwEg6xDKmF21o9fv8s8kH1c2Mwhp8MWLprcJxYVPlJU9NvP0FXIo2Z1FaToFseFnhSo5w/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlgibAqLicdJhGfNibkKZuz7LyrXTSCkVF07J5UWcbSTbYDqvre92c64WodqibfEHVjwyUl1hEpJbA5Qw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlgibAqLicdJhGfNibkKZuz7LymhLLRcsNtIh7fnAkKbPqT39YtbqGialEDia6MCZko0yhoXeS4EYZvIJQ/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/PZCtvaaOQSlXZLdyZDEnDHIC8NClibLOHfsEbqX5Efd2DtZSrez5b3ib8dRHeiaYOP8eRn3ibDt7ZFE0vIiaGjBhWbw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
  
  
  
免责声明  
  
  
          
  
  
本公众号文章以技术分享学习为目的。  
  
由于传播、利用本公众号发布文章而造成的任何直接或者间接的后果及损失，均由使用者本人负责，公众号及作者不为此承担任何责任。  
  
一旦造成后果请自行承担！如有侵权烦请告知，我们会立即删除并致歉。谢谢！  
  
  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/ibZ6uZjjH3v7LQZwTb4qED3KvozKicnJd9ejpVoCntCRqf53IiaK2T3myzcUn5sswkUPfpQj1KHAALFcMFNYjfriaw/640?wx_fmt=gif&tp=wxpic&wxfrom=5&wx_lazy=1 "")  
  
  
  
  
  
  
  
  
  
