#  DTStack Taier 1.4.0 listNames sql注入分析(CVE-2024-41579)   
原创 韭菜  fraud安全   2024-12-17 01:00  
  
# 通告  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6vibiaPicz9GlSjBgjjrEHHaVHF0lDiavXL7e2LLRa8mCjjFwRqgxInu2QXUfEiby7eQw1qUSLhv133ibtg/640?wx_fmt=png&from=appmsg "")  
# 漏洞分析  
  
根据参考文献，很幸运发现了payload  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6vibiaPicz9GlSjBgjjrEHHaVHuPYKgXPqf1BmbgibEHR2pLB1jrPDuSAqLR8ebQ5Z8m7NCe1SkILKKKA/640?wx_fmt=png&from=appmsg "")  
  
通过payload可以知道漏洞触发接口是listNames  
触发参数是jobName  
  
在项目的**Model**  
层和**xml文件**  
查询jobName  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6vibiaPicz9GlSjBgjjrEHHaVH8icTZHmBFIlnMwBlWiaFzPfbib2kK6U0Dia0KuJu28whmXsr9d314uWBDA/640?wx_fmt=png&from=appmsg "")  
  
在Java中sql拼接大致分为两种$  
和#  
  
$：预编译拼接sql语句  
# #：直接拼接sql语句  
  
项目判断是**Spring**  
框架，寻找接口到**Controller**  
层  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6vibiaPicz9GlSjBgjjrEHHaVHia7NEGoc8dbJj9wsc0Sph3gobAq5tGtvLNlFRpE1FEKZ18WQVnJJaqA/640?wx_fmt=png&from=appmsg "")  
  
根据图上所示，**Controlle**  
层直接**post**  
获取jobName  
请求参数  
  
调用连ConsoleController.listNames->ConsoleService.listNames->ScheduleJobCacheMapper->listNames  
# 东施效颦-漏洞挖掘  
  
通过上述分析，寻找一个新的注入点  
  
ScheduleJobCacheMapper.xml发现getOne接口使用了#  
号作为占位符  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6vibiaPicz9GlSjBgjjrEHHaVHqia17qe0CHvy1N3LCqB53vpXE4xqDPLoibt5mkiah3duQviabP16xLTlgA/640?wx_fmt=png&from=appmsg "")  
  
逆向追踪对应的**Model**  
层  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6vibiaPicz9GlSjBgjjrEHHaVHUerjzTGHZIsib2kwpYiaicpk5g7fd8L2P511k9qm7DTNIMrXxXAFdHDfw/640?wx_fmt=png&from=appmsg "")  
  
继续追踪发现jobId  
是通过**Controller**  
传递的  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6vibiaPicz9GlSjBgjjrEHHaVHRqugXicInb1JXXgrxwm8g8HxDgsXZgBZGYD5vRPiaqC2C3ao3PFBE9Yw/640?wx_fmt=png&from=appmsg "")  
  
继续分析**Controller**  
代码，发现jobId  
通过请求直接获取的  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6vibiaPicz9GlSjBgjjrEHHaVHh0DEGWMvRrhsIIFvo4dvbQTYE1YTkSolAVTPbKDoYb5FhK0CXEbF9Q/640?wx_fmt=png&from=appmsg "")  
  
那么挖掘的sql注入：  
  
请求方式：POST请求  
  
请求接口：/taier/api/console/jobStick  
  
注入参数：jobId  
  
  
