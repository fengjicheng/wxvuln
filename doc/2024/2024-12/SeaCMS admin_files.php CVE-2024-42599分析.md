#  SeaCMS admin_files.php CVE-2024-42599分析   
原创 韭菜  fraud安全   2024-12-13 00:32  
  
## 漏洞文件定位  
  
根据漏洞通告提示问题文件在admin_files.php  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6uBDHIGSIZVYxsHv1mdV1mgCV6AIcTzmvJU8WDnB6lVFe8RxATdajKUhqwwQCsBFlZjZicicN2QjtMQ/640?wx_fmt=png&from=appmsg "")  
  
快速浏览文件，发现做了白名单限制，php文件上传无法实现  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6uBDHIGSIZVYxsHv1mdV1mglsrshkeBBOcBUq0KwJV4X3ukNauewr0iazLDVGkyQdicOhEVHShicrLLg/640?wx_fmt=png&from=appmsg "")  
  
但是漏洞通告说的是remote code execution vulnerability（远程代码执行）  
  
那么查找远程代码执行的关键字，发现可以远程加载admin_files.htm  
文件  
<table><thead><tr style="box-sizing: border-box;background-color: rgb(255, 255, 255);border-top-width: 1px;border-top-style: solid;border-top-color: rgb(204, 204, 204);"><th valign="top" style="box-sizing: border-box;padding: 6px 13px;font-weight: bold;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">include</span></section></th><th valign="top" style="box-sizing: border-box;padding: 6px 13px;font-weight: bold;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">包含并运行指定文件 执行出错会抛出错误</span></section></th><th valign="top" style="box-sizing: border-box;padding: 6px 13px;font-weight: bold;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">include &#39;vars.php&#39;; (括号可有可无)</span></section></th></tr></thead><tbody><tr style="box-sizing: border-box;background-color: rgb(255, 255, 255);border-top-width: 1px;border-top-style: solid;border-top-color: rgb(204, 204, 204);"><td valign="top" style="box-sizing: border-box;padding: 6px 13px;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">require</span></section></td><td valign="top" style="box-sizing: border-box;padding: 6px 13px;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">同include 执行出错会抛出警告</span></section></td><td valign="top" style="box-sizing: border-box;padding: 6px 13px;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">require(&#39;somefile.php&#39;); (括号可有可无)</span></section></td></tr><tr style="box-sizing: border-box;background-color: rgb(248, 248, 248);border-top-width: 1px;border-top-style: solid;border-top-color: rgb(204, 204, 204);"><td valign="top" style="box-sizing: border-box;padding: 6px 13px;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">require_once</span></section></td><td valign="top" style="box-sizing: border-box;padding: 6px 13px;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">同require 但会检查之前是否已经包含该文件 确保不重复包含</span></section></td><td valign="top" style="box-sizing: border-box;padding: 6px 13px;border: 1px solid rgb(221, 221, 221);"><section><span leaf=""><br/></span></section></td></tr><tr style="box-sizing: border-box;background-color: rgb(255, 255, 255);border-top-width: 1px;border-top-style: solid;border-top-color: rgb(204, 204, 204);"><td valign="top" style="box-sizing: border-box;padding: 6px 13px;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">include_once</span></section></td><td valign="top" style="box-sizing: border-box;padding: 6px 13px;border: 1px solid rgb(221, 221, 221);"><section><span leaf="">同include 但会检查之前是否已经包含该文件 确保不重复包含</span></section></td><td valign="top"><section><span leaf=""><br/></span></section></td></tr></tbody></table>  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6uBDHIGSIZVYxsHv1mdV1mg7r5rGRcpiaDKCVolVddqDjttmgJWvw1sN8JjXicskoEEaOF3qKtUIheA/640?wx_fmt=png&from=appmsg "")  
  
而且htm在文件上传修改的白名单里，浏览修改模块发现只对文件后缀进行了过滤  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6uBDHIGSIZVYxsHv1mdV1mgIbnqeeGLR6UXTjv3ea3DQrmmewowREXdibqctesK9WovRRpCwdKvpUA/640?wx_fmt=png&from=appmsg "")  
  
那么payload思路  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6uBDHIGSIZVYxsHv1mdV1mgkU4gO78BsEIJItmHMicib8VHrqEf8mCslNIDhrlkbUYFmAXsyolKZYDA/640?wx_fmt=png&from=appmsg "")  
  
构造payload  
```
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Eqn4A05JY6uBDHIGSIZVYxsHv1mdV1mgYyA6HicGA91Wz640J72gYXiaYrny3fsibOSe6CSeEjLLxeEPRHjl9txaw/640?wx_fmt=png&from=appmsg "")  
  
访问admin_files.php  
  
  
  
