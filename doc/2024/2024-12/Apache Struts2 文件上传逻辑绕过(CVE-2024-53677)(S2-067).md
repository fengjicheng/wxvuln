#  Apache Struts2 文件上传逻辑绕过(CVE-2024-53677)(S2-067)   
 网络安全者   2024-12-19 16:00  
  
## 前言  
  
   
Apache官方公告  
又更新了一个Struts2的漏洞，考虑到很久没有发无密码的博客了，再加上漏洞的影响并不严重，因此公开分享利用的思路。  
## 分析  
### 影响版本  
  
Struts 2.0.0 - Struts 2.3.37 (  
EOL  
), Struts 2.5.0 - Struts 2.5.33, Struts 6.0.0 - Struts 6.3.0.2  
### 环境搭建  
  
Struts2的环境搭建比较简单，分析时使用了两种不同漏洞场景的代码  
  
UploadsAction对应多文件上传的场景，也是最简单的场景，不需要任何其他背景知识方便理解  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">15</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">16</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">17</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">18</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">19</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">20</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">21</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">22</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">23</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">24</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">25</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">26</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">27</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">28</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">29</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">30</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">31</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">32</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">33</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">34</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">35</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">36</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">37</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">38</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">39</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">40</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">41</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">42</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">43</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">44</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">45</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">46</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">47</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">48</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">49</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">50</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">51</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">package</span></span><span leaf=""> com.struts2;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">import</span></span><span leaf=""> com.opensymphony.xwork2.ActionSupport;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">import</span></span><span leaf=""> java.io.*;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">import</span></span><span leaf=""> java.util.ArrayList;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">import</span></span><span leaf=""> java.util.List;</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">class</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">UploadsAction</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">extends</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">ActionSupport</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">static</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">final</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">long</span></span><span leaf=""> serialVersionUID =</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">1L</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span leaf=""> List&lt;File&gt; upload;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span leaf=""> List&lt;String&gt; uploadContentType;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span leaf=""> List&lt;String&gt; uploadFileName;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span leaf=""> List&lt;String&gt; uploadedFileNames =</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">new</span></span><span leaf=""> ArrayList&lt;String&gt;();</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> List&lt;File&gt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">getUpload</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> upload;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">void</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">setUpload</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(List&lt;File&gt; upload)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.upload = upload;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> List&lt;String&gt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">getUploadContentType</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> uploadContentType;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">void</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">setUploadContentType</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(List&lt;String&gt; uploadContentType)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.uploadContentType = uploadContentType;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> List&lt;String&gt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">getUploadFileName</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> uploadFileName;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">void</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">setUploadFileName</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(List&lt;String&gt; uploadFileName)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.uploadFileName = uploadFileName;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> List&lt;String&gt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">getUploadedFileNames</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> uploadedFileNames;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> String</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">doUpload</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">for</span></span><span leaf=""> (</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">int</span></span><span leaf=""> i =</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">0</span></span><span leaf="">; i &lt; uploadFileName.size(); i++) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">uploadedFileNames.add(uploadFileName.get(i));</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> SUCCESS;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
UploadAction对应单文件上传的场景  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">15</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">16</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">17</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">18</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">19</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">20</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">21</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">22</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">23</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">24</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">25</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">26</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">27</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">28</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">29</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">30</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">31</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">32</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">33</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">34</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">35</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">36</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">37</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">38</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">39</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">40</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">41</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">42</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">43</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">44</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">45</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">46</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">47</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">package</span></span><span leaf=""> com.struts2;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">import</span></span><span leaf=""> com.opensymphony.xwork2.ActionSupport;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">import</span></span><span leaf=""> java.io.*;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">import</span></span><span leaf=""> java.util.ArrayList;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">import</span></span><span leaf=""> java.util.List;</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">class</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">UploadAction</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">extends</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">ActionSupport</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">static</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">final</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">long</span></span><span leaf=""> serialVersionUID =</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">1L</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span leaf=""> File upload;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span leaf=""> String uploadContentType;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">private</span></span><span leaf=""> String uploadFileName;</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> File</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">getUpload</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> upload;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">void</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">setUpload</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(File upload)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.upload = upload;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> String</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">getUploadContentType</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> uploadContentType;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">void</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">setUploadContentType</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(String uploadContentType)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.uploadContentType = uploadContentType;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> String</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">getUploadFileName</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> uploadFileName;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">void</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">setUploadFileName</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(String uploadFileName)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.uploadFileName = uploadFileName;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> String</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">doUpload</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">()</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> SUCCESS;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
struts.xml  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">15</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">16</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">&lt;!DOCTYPE</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">struts</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">PUBLIC</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">&#34;-//Apache Software Foundation//DTD Struts Configuration 2.0//EN&#34;</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">&#34;http://struts.apache.org/dtds/struts-2.0.dtd&#34;</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">struts</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">package</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">name</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;upload&#34;</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">extends</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;struts-default&#34;</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">action</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">name</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;upload&#34;</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">class</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;com.struts2.UploadAction&#34;</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">method</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;doUpload&#34;</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">result</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">name</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;success&#34;</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">type</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;&#34;</span></span><span leaf="">&gt;</span></span><span leaf="">/file.jsp</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">result</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">action</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">package</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">package</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">name</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;uploads&#34;</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">extends</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;struts-default&#34;</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">action</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">name</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;uploads&#34;</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">class</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;com.struts2.UploadsAction&#34;</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">method</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;doUpload&#34;</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">result</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">name</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;success&#34;</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">type</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;&#34;</span></span><span leaf="">&gt;</span></span><span leaf="">/files.jsp</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">result</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">action</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">package</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">struts</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
file.jsp  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;%</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">@page</span></span><span leaf=""> contentType=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;text/html; charset=UTF-8&#34;</span></span><span leaf=""> language=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;java&#34;</span></span><span leaf=""> %&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;%@ taglib prefix=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;y4tacker&#34;</span></span><span leaf=""> uri=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;/struts-tags&#34;</span></span><span leaf="">%&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">上传的文件名是:&lt;y4tacker:property value=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;uploadFileName&#34;</span></span><span leaf=""> /&gt;</span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
files.jsp  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;%</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">@page</span></span><span leaf=""> contentType=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;text/html; charset=UTF-8&#34;</span></span><span leaf=""> language=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;java&#34;</span></span><span leaf=""> %&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;%@ taglib prefix=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;y4tacker&#34;</span></span><span leaf=""> uri=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;/struts-tags&#34;</span></span><span leaf="">%&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;y4tacker:</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">if</span></span><span leaf=""> test=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;uploadedFileNames.size() &gt; 0&#34;</span></span><span leaf="">&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">文件上传成功:</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;y4tacker:iterator value=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;uploadedFileNames&#34;</span></span><span leaf="">&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;li&gt;&lt;y4tacker:property /&gt;&lt;/li&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;/y4tacker:iterator&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;/y4tacker:</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">if</span></span><span leaf="">&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;y4tacker:</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">else</span></span><span leaf="">&gt;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">no files.</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&lt;/y4tacker:</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">else</span></span><span leaf="">&gt;</span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
web.xml  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">15</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">16</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">17</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">18</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">19</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">20</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">21</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">22</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">23</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">24</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">25</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">26</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">27</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">28</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">29</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">30</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">31</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">32</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">33</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">34</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">&lt;!--</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">Licensed to the Apache Software Foundation (ASF) under one or more</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">contributor license agreements. See the NOTICE file distributed with</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">this work for additional information regarding copyright ownership.</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">The ASF licenses this file to You under the Apache License, Version 2.0</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">(the &#34;License&#34;); you may not use this file except in compliance with</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">the License. You may obtain a copy of the License at</span></span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">http://www.apache.org/licenses/LICENSE-2.0</span></span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">Unless required by applicable law or agreed to in writing, software</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">distributed under the License is distributed on an &#34;AS IS&#34; BASIS,</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">See the License for the specific language governing permissions and</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">limitations under the License.</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">--&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">web-app</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">xmlns</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">xmlns:xsi</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">xsi:schemaLocation</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;http://xmlns.jcp.org/xml/ns/javaee</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&#34;</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">version</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;4.0&#34;</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">metadata-complete</span></span><span leaf="">=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">&#34;true&#34;</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter-name</span></span><span leaf="">&gt;</span></span><span leaf="">struts2</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter-name</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter-class</span></span><span leaf="">&gt;</span></span><span leaf="">org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter-class</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter-mapping</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter-name</span></span><span leaf="">&gt;</span></span><span leaf="">struts2</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter-name</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">url-pattern</span></span><span leaf="">&gt;</span></span><span leaf="">*.action</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">url-pattern</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">filter-mapping</span></span><span leaf="">&gt;</span></span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">&lt;/</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">web-app</span></span><span leaf="">&gt;</span></span></span></pre></td></tr></tbody></table>  
目录结构如下  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkiaBbeCEtma04b7rkib9bO8Ziaic39d25Fh0P4H4EGUN8aahH4a965ictBxg/640?wx_fmt=png&from=appmsg "")  
### 前置知识  
  
由于是S2-066的绕过，所以需要对上一个漏洞的原理有所了解，在我上一篇文章中  
Apache Struts2 文件上传分析(S2-066)  
对此有详细的介绍，这里就不详细描述了，对于上一个漏洞，官方的修复也很暴力，在FileUploadInterceptor  
中设置参数时，忽略大小写遍历删除同名参数再做添加  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">15</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">16</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">17</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">18</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> HttpParameters</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">appendAll</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(Map&lt;String, Parameter&gt; newParams)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.remove(newParams.keySet());</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.parameters.putAll(newParams);</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span leaf=""> HttpParameters</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">remove</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(Set&lt;String&gt; paramsToRemove)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">Iterator var2 = paramsToRemove.iterator();</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">while</span></span><span leaf="">(var2.hasNext()) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">String paramName = (String)var2.next();</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.parameters.entrySet().removeIf((p) -&gt; {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> ((String)p.getKey()).equalsIgnoreCase(paramName);</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">});</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
S2-067，不同于以往的漏洞分析，这一次不能通过官方的commits对比快速定位漏洞原因  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkkaic1stiap3Ke3Tn0EB8libMehLRSSib2sGMdxHY2Hz7m5iaoYAVmPXWWjQ/640?wx_fmt=png&from=appmsg "")  
  
原因是官方直接使用了一个新的类，在  
官方文档  
中，告诉我们在处理上传时推荐使用新的拦截器org.apache.struts2.interceptor.ActionFileUploadInterceptor  
  
简单分析不难看到，其与之前的org.apache.struts2.interceptor.FileUploadInterceptor  
最大的区别在于，这一次并没有参数存储的过程，因此也不存在变量覆盖的问题  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkMsf6KwlUZnK0rFuZaHuNxzH6ezq5YyfeLDmGevwoeeHXp67dsuIk2Q/640?wx_fmt=png&from=appmsg "")  
## 失败的尝试  
  
在一开始，没有其他背景知识的情况下，我的第一个思路是java.lang.String#equalsIgnoreCase  
是否安全？  
  
查看Java的实现可以看到，在regionMatches  
中对于每个字符的比较过程中都是同时转小写以及大写做比较  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">15</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">16</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">17</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">18</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">19</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">20</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">21</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">22</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">23</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">24</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">25</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">26</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">27</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">28</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">29</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">30</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">31</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">32</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">33</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">34</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">35</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">36</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">37</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">38</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">39</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">40</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">41</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">42</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">43</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">44</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">45</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">46</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">47</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">boolean</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">equalsIgnoreCase</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(String anotherString)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> (</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf=""> == anotherString) ?</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">true</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">: (anotherString !=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">null</span></span><span leaf="">)</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&amp;&amp; (anotherString.value.length == value.length)</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">&amp;&amp; regionMatches(</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">true</span></span><span leaf="">,</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">0</span></span><span leaf="">, anotherString,</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">0</span></span><span leaf="">, value.length);</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">public</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">boolean</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">regionMatches</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">boolean</span></span><span leaf=""> ignoreCase,</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">int</span></span><span leaf=""> toffset,</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">String other,</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">int</span></span><span leaf=""> ooffset,</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">int</span></span><span leaf=""> len)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">char</span></span><span leaf=""> ta[] = value;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">int</span></span><span leaf=""> to = toffset;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">char</span></span><span leaf=""> pa[] = other.value;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">int</span></span><span leaf=""> po = ooffset;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// Note: toffset, ooffset, or len might be near -1&gt;&gt;&gt;1.</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">if</span></span><span leaf=""> ((ooffset &lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">0</span></span><span leaf="">) || (toffset &lt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">0</span></span><span leaf="">)</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">|| (toffset &gt; (</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">long</span></span><span leaf="">)value.length - len)</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">|| (ooffset &gt; (</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">long</span></span><span leaf="">)other.value.length - len)) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">false</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">while</span></span><span leaf=""> (len-- &gt;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">0</span></span><span leaf="">) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">char</span></span><span leaf=""> c1 = ta[to++];</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">char</span></span><span leaf=""> c2 = pa[po++];</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">if</span></span><span leaf=""> (c1 == c2) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">continue</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">if</span></span><span leaf=""> (ignoreCase) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// If characters don&#39;t match but case may be ignored,</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// try converting both characters to uppercase.</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// If the results match, then the comparison scan should</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// continue.</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">char</span></span><span leaf=""> u1 = Character.toUpperCase(c1);</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">char</span></span><span leaf=""> u2 = Character.toUpperCase(c2);</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">if</span></span><span leaf=""> (u1 == u2) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">continue</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// Unfortunately, conversion to uppercase does not work properly</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// for the Georgian alphabet, which has strange rules about case</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// conversion. So we need to make one last check before</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// exiting.</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">if</span></span><span leaf=""> (Character.toLowerCase(u1) == Character.toLowerCase(u2)) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">continue</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">false</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">true</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
在这个时候，突然想到phithon曾写过一篇关于:  
Fuzz中的javascript大小写特性的文章  
  
同样的，有个天马行空的思路就是，有没有可能存在一些字符它的大写等于另一个字符的小写呢？如果存在这种情况，在后面参数绑定过程中ognl.OgnlRuntime#capitalizeBeanPropertyName  
做参数处理时又通过对其转大写还原成正常的字母  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkZibUVcgicAfqlSfQoWbL2g5zPcjQVPEV1NOiaOBjzMZHartSA2E4icvNVw/640?wx_fmt=png&from=appmsg "")  
  
很可惜，跑了很久的代码并没有发现存在这样的情况🤪那么  
  
(Ps: 当然这其中不止失败了一次，期间也想过很多不同的思路，当然都是以失败告终🥱)  
## Struts2的参数绑定  
  
在上文中提到了，新版的Struts2文件上传拦截器没有参数存储的过程，那么很容易联想到漏洞的利用还是与参数相关，Struts2中对于参数绑定通过Ognl表达式实现，具体实现在com.opensymphony.xwork2.interceptor.ParametersInterceptor  
拦截器中  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkiaE1neH23L0tQoyicvrzme1MssqQm2DopWqlewibKDjCRibAUz7Za80Dicg/640?wx_fmt=png&from=appmsg "")  
  
简单发一个上传的包Debug做验证  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqktGw7oP6O7YOaoIaF4zCrObiabictIxcZhjxsffiaDzCsEBQYdswlbalBA/640?wx_fmt=png&from=appmsg "")  
  
在com.opensymphony.xwork2.interceptor.ParametersInterceptor#setParameters  
中，有着对参数字符的限制函数，只有isAcceptableParameter  
条件为true  
才能做接下来的参数绑定  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkljVFichRGlXETLibUolDibBemY29cZezbGT1shhxfiacibQZgdXPIMLWyWw/640?wx_fmt=png&from=appmsg "")  
  
这部分限制还是满死的，毕竟历史上Struts2被爆出无数RCE漏洞，其中修修补补无数(没学过的自己去补补课)，因此想要绕过各种个样限制直接完成RCE是极为困难的。另外在这里，我也不会把所有的参数限制条件列举出来，哪里卡住绕哪里即可，这里就浪费时间讲解一些不重要的过程，当然有兴趣也可以具体看看各个限制条件。  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">15</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">16</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// com.opensymphony.xwork2.interceptor.ParametersInterceptor#isAcceptableParameter</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">protected</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">boolean</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">isAcceptableParameter</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(String name, Object action)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">ParameterNameAware parameterNameAware = action</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">instanceof</span></span><span leaf=""> ParameterNameAware ? (ParameterNameAware)action :</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">null</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.acceptableName(name) &amp;&amp; (parameterNameAware ==</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">null</span></span><span leaf=""> || parameterNameAware.acceptableParameterName(name));</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">// com.opensymphony.xwork2.interceptor.ParametersInterceptor#isAcceptableParameterValue</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">protected</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">boolean</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(37, 127, 173);"><span leaf="">isAcceptableParameterValue</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">(Parameter param, Object action)</span></span></span><span leaf="">{</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">ParameterValueAware parameterValueAware = action</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">instanceof</span></span><span leaf=""> ParameterValueAware ? (ParameterValueAware)action :</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">null</span></span><span leaf="">;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">boolean</span></span><span leaf=""> acceptableParamValue = parameterValueAware ==</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">null</span></span><span leaf=""> || parameterValueAware.acceptableParameterValue(param.getValue());</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">if</span></span><span leaf=""> (</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.hasParamValuesToExclude() ||</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.hasParamValuesToAccept()) {</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">acceptableParamValue &amp;=</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">this</span></span><span leaf="">.acceptableValue(param.getName(), param.getValue());</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">return</span></span><span leaf=""> acceptableParamValue;</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">}</span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
在这里，RCE的宏伟目标就暂不考虑了，我们只需要知道既然Struts2使用了Ognl做参数绑定的实现，那么便可以尝试通过参数绑定的过程去实现对上传文件名的修改，从而绕过系统对于目录穿越的限制  
## S2-067之多文件上传场景绕过  
  
回到本身，简单整理下漏洞绕过的思路，用一句话来概括就是:  
  
在参数名与文件上传参数不一致的前提下，能通过Ognl参数绑定过程对文件名做修改  
  
在多文件上传情景下，为方便调试，首先简单构造一个上传多文件的数据包  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">15</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">16</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">17</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">18</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">19</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">POST</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">/uploads.action</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">HTTP/1.1</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">Host</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">127.0.0.1:8080</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">Connection</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">keep-alive</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">Content-Type</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">multipart/form-data; boundary=----WebKitFormBoundaryq0PW93h6lyBzjZNZ</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">User-Agent</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">Content-Length</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">138</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">------WebKitFormBoundaryq0PW93h6lyBzjZNZ</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">Content-Disposition: form-data;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">name</span></span><span leaf="">=&#34;Upload&#34;;filename=&#34;1.txt&#34;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">Content-</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">Type</span></span><span leaf="">:</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">text</span></span><span leaf="">/plain</span></span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">y4tacker</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">------WebKitFormBoundaryq0PW93h6lyBzjZNZ</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">Content-Disposition: form-data;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">name</span></span><span leaf="">=&#34;Upload&#34;;filename=&#34;2.txt&#34;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">Content-</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">Type</span></span><span leaf="">:</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">text</span></span><span leaf="">/plain</span></span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">1</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">------WebKitFormBoundaryq0PW93h6lyBzjZNZ--</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"></span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
在这个场景下如何使用简单的Ognl表达式对文件名做赋值呢？  
  
由于在这里我们的uploadFileName是列表的格式  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqksdicngjECWcYIZ5mhqJC4GvL3J7JhrDsWvUoTPhAicUibpV6ztDx45SLg/640?wx_fmt=png&from=appmsg "")  
  
我们很容易想到使用中括号写法uploadFileName[0]  
的形式对其中的文件名做修改，简单在控制台尝试，在这里成功对我们的文件名做了修改  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkaWvWOSqKzApzEibiaicqDXrB8vD63RXmlta3juKAe1J19bUt4WIGNdpfg/640?wx_fmt=png&from=appmsg "")  
  
在这个场景下，很容易验证得到绕过的Poc，在自己尝试时同样别忘了参数保存是在TreeMap  
中，这是个有序列表，简单解释下尽管在FileUploadInterceptor  
中参数保存在无序的HashMap  
中了，但是在com.opensymphony.xwork2.interceptor.ParametersInterceptor#setParameters  
完成参数绑定的过程中重新用了有序的Treemap  
做包装  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkBSKeuUCYVicIiaDLqOXJcIXAWp1TZ02ibEdweRupVGjm6LSRb4ibmIQaYQ/640?wx_fmt=png&from=appmsg "")  
  
因此错误的大小写以及参数名会影响其排列顺序，导致文件名无法覆盖(S2-066的时候也讲过)  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkkfGeOaIOribG1dUT6MxMZhulNOpjPfovKdsjVzkNVaOXtxVB5Kr6rHQ/640?wx_fmt=png&from=appmsg "")  
## S2-067之单文件上传场景绕过  
  
同样的Payload放在单文件上传的场景自然而然就失效了，毕竟我们的uploadFileName  
在这里只是一个String  
类型的变量  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkYrxskSSCspzR1Ln0yqmJGOFkJrUv7bmOXX5wgDxf3N25FGAsRrTGFA/640?wx_fmt=png&from=appmsg "")  
  
同样的为了完成文件名的修改，我们依旧需要在参数名与文件上传参数不一致的前提下，通过Ognl参数绑定过程对文件名做修改  
  
在讲解之前我们需要知道一个概念，在Ognl中有个重要的概念叫做值栈  
，值栈主要目的是为了让能方便的访问Action的属性  
  
在Struts2中默认的实现为OgnlValueStack  
，Struts2在执行一次请求的过程中会把当前的Action对象自动存入值栈中，  
  
因此我们只要能获取到这个对象就能完成对文件名的修改  
  
为了方便调试Ognl语句，我们首先构造一个正常的Http流量包  
  
<table><tbody><tr style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;text-align: right;opacity: 0.2;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">1</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">2</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">3</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">4</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">5</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">6</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">7</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">8</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">9</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">10</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">11</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">12</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">13</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span leaf="">14</span></span><span leaf=""><br/></span></pre></td><td valign="top" style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;padding: 0px 8px;border-bottom: none;"><pre style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;overflow-x: auto;padding: 0px;border: none;font-size: 13px;font-family: Menlo, &#34;Meslo LG&#34;, monospace;line-height: 22px;border-radius: 4px;margin: 0px;background: 0px 0px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">POST</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(86, 140, 59);"><span leaf="">/upload.action</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">HTTP/1.1</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">Host</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">127.0.0.1:8080</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">Connection</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">keep-alive</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">Content-Type</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">multipart/form-data; boundary=----WebKitFormBoundaryq0PW93h6lyBzjZNZ</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">User-Agent</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(210, 45, 114);"><span leaf="">Content-Length</span></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">:</span></span><span leaf="">138</span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">------WebKitFormBoundaryq0PW93h6lyBzjZNZ</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">Content-Disposition: form-data;</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">name</span></span><span leaf="">=&#34;Upload&#34;;filename=&#34;1.txt&#34;</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">Content-</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(107, 107, 184);"><span leaf="">Type</span></span><span leaf="">:</span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(147, 92, 37);"><span leaf="">text</span></span><span leaf="">/plain</span></span></span><span leaf=""><br/></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span leaf="">y4tacker</span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;color: rgb(90, 123, 140);"><span leaf="">------WebKitFormBoundaryq0PW93h6lyBzjZNZ--</span></span></span></span><span leaf=""><br/></span><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;height: 22px;"><span style="box-sizing: border-box;scrollbar-color: rgb(153, 153, 153) transparent;"></span></span><span leaf=""><br/></span></pre></td></tr></tbody></table>  
在Struts2中我们可以使用[0]  
获取整个栈对象，为方便显示转换为String对象，调用其 toString()方法输出对象信息，可以看到栈顶元素即为我们的Action对象  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkk0iaaHsNOiasIMzcdibYbictGQyVSerNuZaBJGpF4rRIw6Ox6DWps0DSXg/640?wx_fmt=png&from=appmsg "")  
  
因此我们可以使用top  
关键词直接获取到栈顶的Action  
对象，从而获取到FileName  
参数  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkg3E2zmibN10raiaTfwoPaWRa1PEltByiaChTdrLjFiabU2lnhG4PUlZhZw/640?wx_fmt=png&from=appmsg "")  
  
因此我们可以尝试使用[0].top.UploadFilename  
来对文件名做修改，但显然从返回结果来看并没有成功  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkvFmNFQTzlh3VFo6KIPzia0icwOGsuFIia9FiaHUF79EO8dGxEiaQzA2OAww/640?wx_fmt=png&from=appmsg "")  
  
经过调试发现，这里的isAcceptableParameter  
返回了false  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkWHh3IjBZ5967qfltuWBOyvRG2HDbWg6Fe6gEyBXCLNEYf27dakwmTQ/640?wx_fmt=png&from=appmsg "")  
  
没通过的条件是com.opensymphony.xwork2.interceptor.ParametersInterceptor#isAccepted  
  
对应的表达式为\w+((\.\w+)|(\[\d+])|(\(\d+\))|(\['(\w-?|[\u4e00-\u9fa5]-?)+'])|(\('(\w-?|[\u4e00-\u9fa5]-?)+'\)))*  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkEfBamyjL4DsDibxPw0bq9elS1QfolG8ibyBBF5iacE14zjFD6hyFj0kKw/640?wx_fmt=png&from=appmsg "")  
  
没通过的原因很简单[0]  
前面不能为空  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqkzSWXElsiaAcIDd2ZQw60GJI2hfbKX1XRPFXx9HssZ3jTHkxSUh24Ycg/640?wx_fmt=png&from=appmsg "")  
  
这个条件Bypass也很简单，在表达式中[0].top  
等价于top  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqknrZeb9gHBBiblIK0Uibic7STN0JEAQOPNUxPNXhMqD7ibgAAC32YeqEiaTg/640?wx_fmt=png&from=appmsg "")  
  
最终我们成功实现了在单文件上传场景下的绕过  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccxBI3CAHBAT2uLwocZkyKqk1Tibc4hb3G68Aq2TyEUGgay0fg5kj8nKSQOGHzzpVtUXKW46Nuia41NQ/640?wx_fmt=png&from=appmsg "")  
## 参考文章  
  
https://developer.aliyun.com/article/330800  
  
https://paper.seebug.org/794  
  
https://cwiki.apache.org/confluence/display/WW/S2-067  
  
https://y4tacker.github.io/2023/12/09/year/2023/12/Apache-Struts2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%86%E6%9E%90-S2-066/  
  
  
**关 注 有 礼**  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/0JJXjA8siccwx9PwF5amLT8XO4g6SprpXuwkpFq2JqfwLtQx3Bav1JlUAG6472YEr03rY8pZPHeAJUZ1LJaekdQ/640?wx_fmt=png&from=appmsg "")  
  
  
  
  
本文内容来自网络，如有侵权请联系删除  
  
  
  
