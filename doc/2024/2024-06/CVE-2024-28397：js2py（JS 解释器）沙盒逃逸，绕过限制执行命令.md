#  CVE-2024-28397：js2py（JS 解释器）沙盒逃逸，绕过限制执行命令   
 Ots安全   2024-06-22 12:07  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/bL2iaicTYdZn7gtxSFZlfuCW6AdQib8Q1onbR0U2h9icP1eRO6wH0AcyJmqZ7USD0uOYncCYIH7ZEE8IicAOPxyb9IA/640?wx_fmt=gif "")  
  
js2py是一个流行的 Python 包，可以在 Python 解释器中执行 JavaScript 代码。各种网络爬虫都会使用它来解析网站上的 JAVScript 代码。  
  
内部一个全局变量的实现存在漏洞js2py，使得攻击者可以获取js2py环境中一个python对象的引用，从而逃离js环境并在主机上执行任意命令。  
  
通常情况下，用户会调用此方法js2py.disable_pyimport()来阻止 JavaScript 代码逃离js2py环境。但利用此漏洞，攻击者可以绕过此限制并在主机上执行任何命令。  
  
威胁行为者可以托管一个包含恶意 js 文件的网站，或者通过 HTTP API 发送恶意脚本供受害者解析。通过这样做，威胁行为者可以通过在目标上执行任何 shell 命令来在主机上执行远程代码执行。  
  
漏洞详细信息  
- **受影响组件的版本号：**  
  
1. 在 Python 3 下运行的最新 js2py (<=0.74)  
  
- **受影响的产品：**  
  
1. pyload/pyload  
  
1. VeNoMouS/cloudscraper（使用 js2py 作为可选的“js 解释器”）  
  
1. dipu-bd/lightnovel-crawler  
  
- **重现步骤：**  
  
1. 在3.12下安装python3，目前js2py不支持python3.12。  
  
1. 运行pip install js2py安装js2py并执行poc.py，它将尝试head -n 1 /etc/passwd; calc; gnome-calculator; kcalc;在主机上执行。  
  
1. 如果存在漏洞，脚本应该打印Success! the vulnerability exists...或弹出计算器。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tacica4CmicAC7eW22ITGqakibsKVNluwCb45ibSVB8aibpVDrgGS17J3KWr04yBw4m8CUOxS19DkWJ0gmw/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/rWGOWg48tacica4CmicAC7eW22ITGqakibsoBXUE5Xzbjp0kyP5KNkQo6oNJsibp0rYzBxGd2Ge3hprWBpFpnzKibiaw/640?wx_fmt=jpeg&from=appmsg "")  
  
```
https://github.com/Marven11/CVE-2024-28397-js2py-Sandbox-Escape
```  
  
  
  
  
感谢您抽出  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycNnFvFYVgXoExRy0gqCkqvrAghf8KPXnwQaYq77HMsjcVka7kPcBDQw/640?wx_fmt=gif "")  
  
.  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycd5KMTutPwNWA97H5MPISWXLTXp0ibK5LXCBAXX388gY0ibXhWOxoEKBA/640?wx_fmt=gif "")  
  
.  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycU99fZEhvngeeAhFOvhTibttSplYbBpeeLZGgZt41El4icmrBibojkvLNw/640?wx_fmt=gif "")  
  
来阅读本文  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWge7Mibiad1tV0iaF8zSD5gzicbxDmfZCEL7vuOevN97CwUoUM5MLeKWibWlibSMwbpJ28lVg1yj1rQflyQ/640?wx_fmt=gif "")  
  
**点它，分享点赞在看都在这里**  
  
