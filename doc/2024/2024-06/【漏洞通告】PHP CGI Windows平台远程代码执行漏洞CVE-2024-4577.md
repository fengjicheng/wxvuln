#  【漏洞通告】PHP CGI Windows平台远程代码执行漏洞CVE-2024-4577   
深瞳漏洞实验室  深信服千里目安全技术中心   2024-06-07 17:34  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5zUTGN3qa7mkzUGxhEBibtlic5RktQK4xo0wmibyFtGcNLK7DU6r9hSJaj28BBNjJ5ob1sB7wSBHjwkQ/640?wx_fmt=gif&from=appmsg "")  
  
**漏洞名称：**  
  
PHP CGI Windows平台远程代码执行漏洞(CVE-2024-4577)  
  
**组件名称：**  
  
PHP语言  
  
**影响范围：**  
  
PHP8.3 < 8.3.8  
  
PHP8.2 < 8.2.20  
  
PHP8.1 < 8.1.29  
  
由于 PHP 8.0、PHP 7 和 PHP 5 的分支已终止使用，并且不再维护，服务器管理员可以参考“缓解方案”中的临时补丁建议。  
  
**漏洞类型：**  
  
代码注入  
  
**利用条件：**  
  
1、用户认证：无需用户认证  
  
2、前置条件：默认配置  
  
3、触发方式：远程  
  
**综合评价：**  
  
<综合评定利用难度>：容易，能造成远程代码执行。  
  
<综合评定威胁等级>：严重，能造成远程代码执行。  
  
**官方解决方案：**  
  
已发布  
  
  
  
  
**漏洞分析**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5zUTGN3qa7mkzUGxhEBibtlicmnSo1jde8XibCuwOF1gz5Kmjg4DQChiceKjJTZyn4FmA01IDRQuthWNw/640?wx_fmt=gif&from=appmsg "")  
  
**组件介绍**  
  
PHP是一种流行的通用脚本语言，特别适合 Web 开发。PHP 快速、灵活且实用，为从您的博客到世界上最流行的网站的一切提供支持。  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5zUTGN3qa7mkzUGxhEBibtlicmnSo1jde8XibCuwOF1gz5Kmjg4DQChiceKjJTZyn4FmA01IDRQuthWNw/640?wx_fmt=gif&from=appmsg "")  
  
**漏洞简介**  
  
  
2024年6月7日，深瞳漏洞实验室监测到一则PHP语言组件存在代码注入漏洞的信息，漏洞编号：CVE-2024-4577，漏洞威胁等级：严重。  
  
PHP语言在设计时忽略了Windows对字符编码转换的 Best-Fit 特性，导致**未授权的攻击者可以通过特定字符串绕过 CVE-2012-1823 补丁，执行任意PHP代码，导致服务器失陷。**  
  
  
  
**影响范围**  
  
目前受影响的PHP语言版本：  
  
PHP8.3 < 8.3.8  
  
PHP8.2 < 8.2.20  
  
PHP8.1 < 8.1.29  
  
由于 PHP 8.0、PHP 7 和 PHP 5 的分支已终止使用，并且不再维护，服务器管理员可以参考“缓解方案”中的临时补丁建议。  
  
  
**解决方案**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5zUTGN3qa7mkzUGxhEBibtlicmnSo1jde8XibCuwOF1gz5Kmjg4DQChiceKjJTZyn4FmA01IDRQuthWNw/640?wx_fmt=gif&from=appmsg "")  
  
**如何检测组件系统版本**  
  
  
通过php -v查看当前php版本  
  
![](https://mmbiz.qpic.cn/mmbiz_png/w8NHw6tcQ5zUTGN3qa7mkzUGxhEBibtlic6Sljtv7NUIBO6zFVC3ibudIV8odYw7tDINKicO2vOnIibKrK5bWZQ8LyA/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5zUTGN3qa7mkzUGxhEBibtlicmnSo1jde8XibCuwOF1gz5Kmjg4DQChiceKjJTZyn4FmA01IDRQuthWNw/640?wx_fmt=gif&from=appmsg "")  
  
**官方修复建议**  
  
  
将PHP升级到官方最新版本 8.3.8、8.2.20和8.1.29。下载链接：https://www.php.net/downloads.php  
  
  
**缓解方案：**  
  
1.不方便更新版本的Windows用户，建议暂时关闭php-cgi的使用。  
  
  
2.以下重写规则可用于阻止攻击。需要注意的是，这些规则仅对繁体中文、简体中文和日语语言环境起到临时缓解作用。在实际操作中，仍然建议更新到补丁版本或迁移架构。  
```
RewriteEngine On
RewriteCond %{QUERY_STRING} ^%ad [NC]
RewriteRule .? - [F,L]
```  
  
  
3. 对于使用 XAMPP for Windows 的用户：  
  
如果确认不需要 PHP CGI 功能，可以通过修改以下 Apache HTTP Server 配置来避免受到该漏洞的影响：  
```
C:/xampp/apache/conf/extra/httpd-xampp.conf
```  
  
找到相应的行：  
```
ScriptAlias /php-cgi/ "C:/xampp/php/"
```  
  
并将其注释掉：  
```
# ScriptAlias /php-cgi/ "C:/xampp/php/"
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5zUTGN3qa7mkzUGxhEBibtlicmnSo1jde8XibCuwOF1gz5Kmjg4DQChiceKjJTZyn4FmA01IDRQuthWNw/640?wx_fmt=gif&from=appmsg "")  
  
**深信服解决方案**  
  
  
**1.风险资产发现**  
  
支持对PHP语言的主动检测，可批量检出业务场景中该事件的**受影响资产**情况，相关产品如下：  
  
**【深信服主机安全检测响应平台CWPP】**已发布资产检测方案。  
  
**【深信服云镜YJ】** 已发布资产检测方案。  
  
  
**2.漏洞主动检测**  
  
支持对PHP CGI Windows平台远程代码执行漏洞(CVE-2024-4577)的主动检测，可批量快速检出业务场景中是否存在**漏洞风险**，相关产品如下：  
  
**【深信服云镜YJ】**预计2024年06月13日发布检测方案。  
  
**【深信服漏洞评估工具TSS】**预计2024年06月13日发布检测方案。  
  
**【深信服安全托管服务MSS】**预计2024年06月13日发布检测方案（需要具备TSS或CWPP组件能力）。  
  
**【深信服安全检测与响应平台XDR】**预计2024年06月13日发布检测方案（需要具备云镜或CWPP组件能力）。  
  
  
**3.漏洞安全监测**  
  
支持对PHP CGI Windows平台远程代码执行漏洞(CVE-2024-4577)的监测，可依据流量收集实时监控业务场景中的**受影响资产情况，快速检查受影响范围**，相关产品及服务如下：  
  
**【深信服安全感知管理平台SIP】**已发布监测方案。  
  
**【深信服安全托管服务MSS】**已发布监测方案（需要具备SIP组件能力）。  
  
**【深信服安全检测与响应平台XDR】**已发布监测方案。  
  
  
**4.漏洞安全防护**  
  
支持对PHP CGI Windows平台远程代码执行漏洞(CVE-2024-4577)的防御，**可阻断攻击者针对该事件的入侵行为**，相关产品及服务如下：  
  
**【深信服下一代防火墙AF】**已发布防护方案（需开启WAF配置）。  
  
**【深信服Web应用防火墙WAF】**已发布防护方案。  
  
**【深信服安全托管服务MSS】**已发布防护方案（需要具备AF组件能力）。  
  
**【深信服安全检测与响应平台XDR】**已发布防护方案（需要具备AF组件能力）。  
  
  
  
**参考链接**  
  
  
  
https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability/  
  
https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4577  
  
https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ucoderef/d1980631-6401-428e-a49d-d71394be7da8  
  
  
  
  
**时间轴**  
  
  
  
**2024/6/7**  
  
深瞳漏洞实验室监测到PHP CGI Windows平台远程代码执行漏洞信息。  
  
  
**2024/6/7**  
  
深瞳漏洞实验室发布漏洞通告。  
  
  
点击**阅读原文**，及时关注并登录深信服**智安全平台**，可轻松查询漏洞相关解决方案。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/w8NHw6tcQ5zUTGN3qa7mkzUGxhEBibtlicvFj8MlkicHTUx0dMw5j6PEJNQBQjcDna0BWqNOeuyTUuLYEAjSVQh3Q/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/w8NHw6tcQ5zvcIHbwGGYKbqDVYsVKzNNia1jYtHf49C7133AlDXAgex2W4lFvpia56tjQQDkiauNBrl08YbxqG01A/640?wx_fmt=jpeg&from=appmsg "")  
  
  
