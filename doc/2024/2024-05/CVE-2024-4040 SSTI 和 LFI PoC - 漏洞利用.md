#  CVE-2024-4040 SSTI 和 LFI PoC - 漏洞利用   
 Ots安全   2024-05-18 13:24  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/bL2iaicTYdZn7gtxSFZlfuCW6AdQib8Q1onbR0U2h9icP1eRO6wH0AcyJmqZ7USD0uOYncCYIH7ZEE8IicAOPxyb9IA/640?wx_fmt=gif "")  
  
这是 CrushFTP 中服务器端模板注入 (SSTI) 和本地文件包含 (LFI) 漏洞的概念验证。  
  
  
**特征**  
  
通过服务器端模板注入 (SSTI) 和身份验证绕过来利用 CrushFTP 服务器中的严重严重漏洞。将此漏洞提升为本地文件包含 (LFI)！此 PoC 漏洞利用的目的是自动检测托管 CrushFTP 的 sFTP 服务器中的漏洞以及漏洞利用！  
  
  
**单步执行代码：**  
- 匿名会话令牌的生成  
  
- 利用这些代币执行 SSTI 并创建我们自己的入口点！  
  
- 调用我们的 SSTI 端点并脱离其上下文以请求目标计算机上的任何本地资源！  
  
在做了一些 Google dorking 后，我发现目前有超过 7000 个可公开访问的 CrushFTP 门户！😬 这个CVE 6天前才被披露，不用我多说了...  
  
  
**用法**  
```
python3 crushed.py -t https://target.com
```  
  
对于指定您自己的 LFI 路径，请使用-l或--lfi参数：  
```
python3 crushed.py -t https://target.com -l /etc/passwd
```  
  
提供您自己的单词列表以使用-w或执行 LFI --wordlist。也适用于-l选项。  
```
python3 crushed.py -t https://target.com -w /lfiwordlist.txt
```  
  
比如：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tafeCNaUVXUAw6ww5h6sDYA6CmjLrjcnXvu3icqx8X9WahHDxTO3ianTYTNTMRBNu9WQmahzQfEt98Hg/640?wx_fmt=png&from=appmsg "")  
  
  
**从经过身份验证的会话窃取 Cookie - LFI 后**  
  
获得易受攻击的服务器sessions.obj文件后，我们能够提取其他用户的会话令牌，使该漏洞的严重性变得更高，并且存在帐户或服务器被接管的风险。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tafeCNaUVXUAw6ww5h6sDYA6S7lJGDGjyVTRmPxzMOYgQ8A1cJTpXJTHgJDNMLeu45eK1ibeeCE5e6g/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tafeCNaUVXUAw6ww5h6sDYA6EcjXx2qZml7Aw4a1RibBkicIKkoicicib8xx33ZSOs7ae13BzmRETsl1vicQ/640?wx_fmt=png&from=appmsg "")  
  
**自动验证提取的令牌**  
  
一旦我们从sessions.obj 文件中获取了令牌，脚本就会针对目标测试令牌组合。目标端点是/WebInterface/function?command=getUsername&c2f={current_auth_token}，在请求标头中传递两个令牌。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tafeCNaUVXUAw6ww5h6sDYA6K8eqatvmtT2In0PDib8Clwbl2icl2uHWTic8wdxhbNiahgmHCYe0rNlCew/640?wx_fmt=png&from=appmsg "")  
  
```
项目地址：
https://github.hscsec.cn/Stuub/CVE-2024-4040-SSTI-LFI-PoC?tab=readme-ov-file
```  
  
  
  
  
感谢您抽出  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycNnFvFYVgXoExRy0gqCkqvrAghf8KPXnwQaYq77HMsjcVka7kPcBDQw/640?wx_fmt=gif "")  
  
.  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycd5KMTutPwNWA97H5MPISWXLTXp0ibK5LXCBAXX388gY0ibXhWOxoEKBA/640?wx_fmt=gif "")  
  
.  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycU99fZEhvngeeAhFOvhTibttSplYbBpeeLZGgZt41El4icmrBibojkvLNw/640?wx_fmt=gif "")  
  
来阅读本文  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWge7Mibiad1tV0iaF8zSD5gzicbxDmfZCEL7vuOevN97CwUoUM5MLeKWibWlibSMwbpJ28lVg1yj1rQflyQ/640?wx_fmt=gif "")  
  
**点它，分享点赞在看都在这里**  
  
