#  CVE-2023-32243踩坑   
原创 超级兵  攻防实验室   2024-07-27 22:02  
  
本文较短，赶时间的朋友直接看最后面的结论  
  
  
wordpress cve-2023-32243  
  
漏洞插件：essential-addons-for-elementor-lite 版本：5.4.0 - 5.7.1  
  
  
某次渗透中，发现目标版本：5.5.5，在可利用范围内  
  
网传poc：  
```
```  
  
  
其中  
eael-resetpassword-nonce  
来自网站前端源码：  
var localize = {"...,"nonce":"xxxxxx",...  
部分。  
  
rp_login  
为现有用户  
  
  
利用效果：  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5rTJRpFSDJicxjxe3OPibJSkA06Sf86IL9fQmq7E7LRYu6FwyeyCr8QKew/640?wx_fmt=png&from=appmsg "")  
  
有问题  
  
  
目标wp版本为6.2，搭建本地环境进行测试  
  
添加插件：essential-addons-for-elementor-lite.5.5.5.zip  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5rQGDPVAtHkjuicMGu4v0EJUOYDxtJLjDsYCyBPZRSjAHKoDibQFJSzUAQ/640?wx_fmt=png&from=appmsg "")  
  
配置本地环境时发现此插件需要配合插件  
Elementor(版本3.23.3)  
一同安装才能使用  
  
  
测试发现和上面的报错一样，下断点跟进代码  
  
根据上面的报错信息  
Invalid user name found!  
，我们直接定位到  
  
myweb.com\wp-content\plugins\essential-addons-for-elementor-lite\includes\Traits\Login_Registration.php  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5rLNORkr2TLPtaL0FaxJ8nrtcw3I4xLbwW0cicwmrtOHOYldAXOgwdpSA/640?wx_fmt=png&from=appmsg "")  
  
$user错误导致报错，再往上看  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5rk7SCNNaY1kucT0Md8dOQMxWeWnicN43ibGDostpu2SDc1M0eicy2OlMHg/640?wx_fmt=png&from=appmsg "")  
  
这里的  
check_password_reset_key  
函数，需要传入两个参数，动态调试一下  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5rfJ8FsIs1TnGmo6IAic5aKeP3oOEUgfNb8SOSZtnDMO00TtYNViabIs8A/640?wx_fmt=png&from=appmsg "")  
  
跟进发现这两个参数都为空  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5ro2dOjo9EgwcALHIAhE3tdjcG2NO8eVvHQiceJ4Zmzicg1e8KCIzyOUeQ/640?wx_fmt=png&from=appmsg "")  
  
key为空，直接导致$user报错  
  
再往上看，  
$rp_data_db  
是设置key和login的关键  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5roahgnXMc1Z4j6XKibicj3a67qJWWdL6M6EQqItqaAchH5QIsx83RntTw/640?wx_fmt=png&from=appmsg "")  
  
跟进  
get_option  
函数  
  
注意到  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5rX1wyDIU02RPo1FeUyBBS2GDMG88UicTBBtRT8hDE5uCicfCYQTDDX3bw/640?wx_fmt=png&from=appmsg "")  
  
对应的sql语句  
```
```  
  
将这条语句直接去执行：  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5ruMYrWjpK5RtiaSXict1sUsBrdJaHVe3dTd2gEgIqy7YFJFpibWfJPsib8Q/640?wx_fmt=png&from=appmsg "")  
  
使用可视化工具进行查看  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5rR8MzEPDOhWjfspqibfIKcibvGZv8C6iazwIniakv9hc4XYB7JoCWZA0HTg/640?wx_fmt=png&from=appmsg "")  
  
没有此项，没有类似的数据  
  
  
想办法构造此项  
  
找到唯一可能有关的地方  
  
![](https://mmbiz.qpic.cn/mmbiz_png/vrbHib2seLpBLZcZljTDj2S7WYz6wDT5rovAl2DsfTDeqBNL7uiag5vtbyggQBt0fAFuq2I9Ds3d59s2TLLXDakg/640?wx_fmt=png&from=appmsg "")  
  
且此处位于上面  
check_password_reset_key  
代码逻辑之下，无法利用  
  
后查看其它资料发现，上面这套逻辑为已经打补丁修复后的代码  
  
那我还玩个锤子🔨！！！  
  
  
结论：5.5.5版本不存在CVE-2023-32243漏洞，公开消息不一定准确！  
  
  
补充：  
  
版本5.7.1确实存在此漏洞，对于上面的那条sql语句，确实有  
update_option  
的操作（将对应值添加到数据库），但是在后续重置密码之前，未利用该语句。  
  
