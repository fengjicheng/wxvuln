#  CVE-2023-3009 TeamPass漏洞复现   
Betta  火线Zone   2023-06-16 15:25  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysFg8ibvNvPDu44VrjLDJVaicyMPUebASX7oazxJyhiclSSOcJbA5pH0rSg/640?wx_fmt=png "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBys7HkpJqsibOibE6rDWpbGD7JYscK8CdCFwKr7zxbvibY99WTHF8hTaL72Q/640?wx_fmt=png "")  
  
  
**01**  
  
**简介**  
  
TeamPass 是一个密码管理器，专门用于通过在团队成员之间共享密码来以协作方式管理密码，提供大量功能，允许根据为每个用户定义的访问权限以有组织的方式管理的密码和相关数据， 是一个开源免费使用的产品，根据 OpenSource GNU GPL-3.0 分发。  
  
  
**02**  
  
**影响版本**  
  
**Teampass<3.0.9**  
  
  
**下载地址**  
  
https://github.com/nilsteampassnet/TeamPass/archive/refs/tags/3.0.8.zip  
  
  
**03**  
  
**安装**  
  
PHP版本要求>7.4  
  
http://teampass.xyz:8822/install/install.php  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBystxpBEVBPATsOWTvJ1QYX4RAZTeic0VutlYq74VnlexotKbASiaSdhrUg/640?wx_fmt=png "")  
  
  
下一步  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBys1fwibooNn9Kna84JZxSBKQFGo2Yjkqic27mGlNTw4f5joHbicXA5M3icxQ/640?wx_fmt=png "")  
  
  
安装环境需要linux,centos7换源，其实windows也可以安装  
```
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup

wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo //下载新源

yum clean all //清除缓存

yum makecache //生成新缓存
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysclSAXOExIKTBibc8YqNHRemKp91b6lLwG4bHW3ZniaXxgtfD1nUxC0Zg/640?wx_fmt=png "")  
  
```
yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
yum-config-manager --enable remi-php74
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysicDgL5gRtt1vV3WeQeYbEyJgWcNfyrBOZGp8KOaNBCYicR8Jv36ticAibQ/640?wx_fmt=png "")  
  
```
yum install php php-cli php-fpm php-mysqlnd php-zip php-devel php-gd php-mcrypt php-mbstring php-curl php-xmlrpc php-xml
php -v
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysfibHGLXHibraT10vQnuPu0hm2kbicH1y0uFNwCkSLU8aHia2YWuqMpgDzA/640?wx_fmt=png "")  
  
  
安装phpmyadmin  
```
yum install phpmyadmin
```  
  
  
配置phpMyAdmin：  
```
vim /etc/httpd/conf.d/phpMyAdmin.conf
```  
  
  
将以下行添加到文件中：  
```
<Directory /usr/share/phpMyAdmin/>
   AddDefaultCharset UTF-8
</Directory>
```  
  
  
重启Apache：  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysteyficLsVboicJKRZHQVHel9wadzTpsr5QqSJbFfIFr3mIQDbKQeK40w/640?wx_fmt=png "")  
  
```
systemctl restart httpd.service
```  
  
  
根据apache版本修改phpadmin配置  
```
vim /etc/httpd/conf.d/phpMyAdmin.conf
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBys1bVLJlPjGaYRUv1SWIBW7vib4ugZSsnJYRUm7pbM45qL16GdibKl2P2A/640?wx_fmt=png "")  
  
  
centos7开放防火墙80端口  
```
firewall-cmd --zone=public --add-port=80/tcp --permanent
firewall-cmd --reload
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kByszA4T4329QtctptW78deuPdrfnYQjCk5Gx1GhBDnpibYFcleSo188XZQ/640?wx_fmt=png "")  
```
update user set authentication_string=password('1qaz@WSX') where user='root';
```  
  
  
安装ssl证书  
```
mkdir -p /etc/ssl/localcerts
openssl req -new -x509 -days 365 -nodes -out /etc/ssl/localcerts/apache.pem -keyout /etc/ssl/localcerts/apache.key
chmod 600 /etc/ssl/localcerts/apache*
sudo ln -s /etc/httpd/conf.modules.d/10-a2enmod.conf /etc/httpd/conf.modules.d/00-base.conf
a2enmod ssl
```  
  
  
环境问题，这里装证书是最麻烦的，ssl协议能走没问题。这里其实有相对来说更简单的安装方法。  
  
  
**04**  
  
**结合Docker**  
```
docker pull teampass/teampass   //拉取镜像
wget https://github.com/nilsteampassnet/TeamPass/archive/refs/tags/3.0.8.zip   //下载项目
unzipc TeamPass-3.0.8       //解压
mv TeamPass-3.0.8 teampass  //改名
docker run -p 80:80 teampass/teampass
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBys1f9rAAd8bjVdsBL6NzZibET3JVJHj5sx9oRP49kgLnJokiaAc8KxwQhA/640?wx_fmt=png "")  
```
dcoker ps   //查看docker容器id
docker cp ./teampass/ a4fb5937eaa8:/var/www/html/    //将文件复制到docker镜像中
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysmksZ4OOsu3sMVrqHWzib717VWSvskSVNicWXtOyDbHaMMlSUrs6XthUA/640?wx_fmt=png "")  
  
  
以此方法安装也可以，该环境中时已经安装好了ssl证书的  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysZn7yeEH1f2Bno7UB6ePGTrEwZKOTLn2P8rOgTDAxqgYCvphfratQ3w/640?wx_fmt=png "")  
  
  
准备工作做好之后就可以正常走安装流程了。  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysW4m6aXutZMtrMTLhXK0lnPdS2Ph0hibbxPbNhohvTfmwlAXuNfffCag/640?wx_fmt=png "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kByslUujaDt2ZiaejqMEEe75OQ3WKrkiaUUB29HgdS17oQ3yXOibRu5EuGsJA/640?wx_fmt=png "")  
  
  
效果  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysrysw7ETjmJKbRCbMVP2WBDB2SDgGiaauj4iaR0RCTUoy6oHnb3bmADIQ/640?wx_fmt=png "")  
  
  
目前在版本3.0.9中已修复  
```
https://github.com/nilsteampassnet/teampass/commit/6ba8cf1f4b89d62a08d122d533ccf4cb4e26a4ee?diff=unified
```  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysiaPbXGZbNQWicaSR4nicWunUEFI7pqTzaOAUFyJR9yTTBGJ142NbbmWGg/640?wx_fmt=png "")  
  
  
可以看到在js中添加了过滤  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/MibgS41eXiaJ8xlpmYynsB2vLP0EF4kBysaYQ7yxqqTtA5L1PjeXFTzDNbtFSZWVh55X3zqydLbN3H3IpRvk0gCA/640?wx_fmt=png "")  
  
  
在releases中无最新版本的源文件。  
  
  
  
往期推荐  
  
[](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247498389&idx=1&sn=e78e640981a447988ec70fe02c787373&chksm=eaa972b5dddefba3fb56a33502dda53959a04f14885365ad52166956c891c0bed19b169984b5&scene=21#wechat_redirect)  
  
[](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247498370&idx=1&sn=b2cb2572d95b688098c4d2e307d8f4db&chksm=eaa972a2dddefbb4f2f2ef53bde19c23b4ba492f8983fec95cebf4d00331179120eaa019ece9&scene=21#wechat_redirect)  
  
[](http://mp.weixin.qq.com/s?__biz=MzI2NDQ5NTQzOQ==&mid=2247498370&idx=2&sn=f17c2c5c79ba506b9729ba8053df956b&chksm=eaa972a2dddefbb4d581a8a5dfbc8b261f33935238ff1e812383cb8fd3564c69e6c1b35c11cb&scene=21#wechat_redirect)  
  
![](https://mmbiz.qpic.cn/mmbiz_png/0Z0LqMyVGaTASIjjfoBKOgTfMQLibsgv1YWqEiaxriaiazXEbibW4gQElTuuLbcia0zFfmlYVf3e1RZyHQIehTYcfib5g/640?wx_fmt=png "")  
  
火线Zone是火线安全平台运营的安全社区，拥有超过20,000名可信白帽安全专家，内容涵盖渗透测试、红蓝对抗、漏洞分析、代码审计、漏洞复现等热门主题，旨在研究讨论实战攻防技术，助力社区安全专家技术成长，2年内已贡献1300+原创攻防内容，提交了100,000+原创安全漏洞。  
  
欢迎具备分享和探索精神的你加入火线Zone社区，一起分享技术干货，共建一个有技术氛围的优质安全社区！  
  
  
  
  
