#  RocketMQ 远程代码注入漏洞 CVE-2023-33246   
深瞳漏洞实验室  深信服千里目安全技术中心   2023-06-03 11:31  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5z0JApyo2H6kxhLMxQNf9dkoOLCz4ksOdiachZkPhT0FQyFN7Nm398lcDjHicfRn0dk1AibMGQib6JQrw/640?wx_fmt=gif "")  
  
**漏洞名称：**  
  
RocketMQ 远程代码注入漏洞 (CVE-2023-33246)  
  
**组件名称：**  
  
RocketMQ  
  
**影响范围：**  
  
5.x≤RocketMQ≤5.1.04.x≤RocketMQ≤4.9.5  
  
**漏洞类型：**  
  
远程代码执行  
  
**利用条件：**  
  
1、用户认证：否  
  
2、前置条件：默认配置  
  
3、触发方式：远程  
  
**综合评价：**  
  
<综合评定利用难度>：容易，无需授权即可远程代码执行。  
  
<综合评定威胁等级>：高危，能造成远程代码执行。  
  
  
  
  
  
**漏洞分析**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5z0JApyo2H6kxhLMxQNf9dkicqq2IRYicNI5U4icHhFs8C7CicLYUibIlxYib4Yaic4xloyvH7Gpac5wjZ3Q/640?wx_fmt=gif "")  
  
**组件介绍**  
  
RocketMQ 是一款低延迟、高并发、高可用、高可靠的分布式消息中间件。RocketMQ 既可为分布式应用系统提供异步解耦和削峰填谷的能力，同时也具备互联网应用所需的海量消息堆积、高吞吐、可靠重试等特性。  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5z0JApyo2H6kxhLMxQNf9dkicqq2IRYicNI5U4icHhFs8C7CicLYUibIlxYib4Yaic4xloyvH7Gpac5wjZ3Q/640?wx_fmt=gif "")  
  
**漏洞简介**  
  
2023 年 6 月 3 日，深信服安全团队监测到一则 RocketMQ 组件存在远程命令注入漏洞的信息，漏洞编号：CVE-2023-33246，漏洞威胁等级：高危。  
  
该漏洞是由于NameServer、Broker、Controller 等多个组件缺少必要的权限验证，**攻击者可利用该漏洞在未授权的情况下，构造恶意数据执行远程代码执行攻击，最终获取目标服务器的系统用户权限。**  
  
  
**影响范围**  
  
目前受影响的 RocketMQ 版本：  
  
5.x≤RocketMQ≤5.1.04.x≤RocketMQ≤4.9.5  
  
  
**漏洞验证**  
  
  
搭建 RocketMQ 组件 4.9.5 版本环境，复现该漏洞，效果如下  
  
![](https://mmbiz.qpic.cn/mmbiz_png/w8NHw6tcQ5z0JApyo2H6kxhLMxQNf9dkB6Ufn2rZzEaiaSoL1jDuaBDU2V55CtYtTqzbtHZM7tVf11tJeK0w39g/640?wx_fmt=png "")  
  
  
  
**解决方案**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5z0JApyo2H6kxhLMxQNf9dkicqq2IRYicNI5U4icHhFs8C7CicLYUibIlxYib4Yaic4xloyvH7Gpac5wjZ3Q/640?wx_fmt=gif "")  
  
**官方修复建议**  
  
  
当前官方已发布最新版本，建议受影响的用户及时更新升级到最新版本。链接如下：  
  
https://rocketmq.apache.org/download/  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/w8NHw6tcQ5z0JApyo2H6kxhLMxQNf9dkicqq2IRYicNI5U4icHhFs8C7CicLYUibIlxYib4Yaic4xloyvH7Gpac5wjZ3Q/640?wx_fmt=gif "")  
  
**深信服解决方案**  
  
  
**1.风险资产发现**  
  
支持对 RocketMQ 的主动检测，可**批量检出**业务场景中该事件的**受影响资产**情况，相关产品如下：  
  
**【深信服主机安全检测响应平台CWPP】**已发布资产检测方案。  
  
  
**2.漏洞安全检测**  
  
支持对 RocketMQ 远程代码注入漏洞 (CVE-2023-33246) 的监测，可依据流量收集**实时监控**业务场景中的**受影响资产情况，快速检查受影响范围**，相关产品及服务如下：  
  
**【深信服安全感知管理平台SIP】**预计 2023 年 6 月 5 日发布检测方案。  
  
**【深信服安全托管服务MSS】**预计 2023 年 6 月 5 日发布检测方案。  
  
**【深信服安全检测与响应平台XDR】**预计 2023 年 6 月 5 日发布检测方案。  
  
  
**3.漏洞安全防护**  
  
支持对 RocketMQ 远程代码注入漏洞 (CVE-2023-33246) 的防御，**可阻断攻击者针对该事件的入侵行为**，相关产品及服务如下：  
  
**【深信服下一代防火墙AF】**预计 2023 年 6 月 5 日发布防护方案。  
  
**【深信服Web应用防火墙WAF】**预计 2023 年 6 月 5 日发布防护方案。  
  
**【深信服安全托管服务MSS】**预计 2023 年 6 月 5 日发布防护方案。  
  
**【深信服安全检测与响应平台XDR】**预计 2023 年 6 月 5 日发布防护方案。  
  
  
**参考链接**  
  
https://lists.apache.org/thread/1s8j2c8kogthtpv3060yddk03zq0pxyp  
  
  
**时间轴**  
  
  
  
**2023/6/3**  
  
深信服监测到 RocketMQ 远程代码注入漏洞攻击信息。   
  
  
**2023/6/3**  
  
深信服千里目安全技术中心发布漏洞通告。  
  
  
点击**阅读原文**，及时关注并登录深信服**智安全平台**，可轻松查询漏洞相关解决方案。  
  
![](https://mmbiz.qpic.cn/mmbiz_png/w8NHw6tcQ5z0JApyo2H6kxhLMxQNf9dks7iaR7Y06qxZ2Wibia6NByyGQgkzY8J6062UZ98woBKF9cSrIgPKic2SgQ/640?wx_fmt=png "")  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/w8NHw6tcQ5z0JApyo2H6kxhLMxQNf9dkOIuORy6mz3qJdrLuxPu0x002icTuz48WCO1NT4ybibUDNLlpCJsBk0uw/640?wx_fmt=jpeg "")  
  
  
  
