#  速修！Apache RocketMQ 曝 RCE 漏洞   
原创 微步情报局  微步在线研究响应中心   2023-06-01 18:48  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fFyp1gWjicMKKIwzXUMSTRxJbmEAibibMabggxYnpFRmPXP4YIicg335GmW5s2lb5jibiaEImQXzbHnA7icXL3Z8Skpwg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
01 漏洞概况****  
  
  
  
Apache RocketMQ是一款使用广泛的分布式消息中间件，既可为分布式应用系统提供异步解耦和削峰填谷的能力，同时也具备互联网应用所需的海量消息堆积、高吞吐、可靠重试等特性。近日，微步漏洞团队监测到Apache RocketMQ 远程命令执行漏洞(CVE-2023-33246) 情报。攻击者可以通过该漏洞执行任意命令，导致系统被攻击与控制。  
**经过分析与研判，该漏洞利用难度低，漏洞细节已公开，可以远程命令执行，建议尽快修复。**  
****  
  
02 漏洞处置优先级（VPT）  
  
  
  
**综合处置优先级：**  
**高**  
****  
  
<table><tbody style="visibility: visible;"><tr style="height: 23.3pt;visibility: visible;"><td style="border-color: rgb(191, 191, 191);border-style: solid;border-width: 1pt;padding: 0cm 5.4pt;word-break: break-all;visibility: visible;" width="71" valign="top" height="23"><p style="visibility: visible;"><strong style="visibility: visible;"><span style="font-size: 15px;visibility: visible;">漏洞编号</span></strong></p></td><td style="border-color: rgb(191, 191, 191) rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: solid solid solid none;border-width: 1pt 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;visibility: visible;" width="106" valign="top" height="23"><p style="visibility: visible;"><span style="font-size: 14px;visibility: visible;">微步编号</span></p></td><td style="border-color: rgb(191, 191, 191) rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: solid solid solid none;border-width: 1pt 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;visibility: visible;" width="261" valign="top" height="23"><p style="visibility: visible;"><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);visibility: visible;"></span><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);">XVE-2023-16181</span><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);visibility: visible;"></span></p></td></tr><tr style="height: 23.3pt;visibility: visible;"><td rowspan="6" style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191);border-style: none solid solid;border-width: medium 1pt 1pt;padding: 0cm 5.4pt;visibility: visible;" width="91" valign="top" height="23"><p style="visibility: visible;"><strong style="visibility: visible;"><span style="font-size: 15px;visibility: visible;">漏洞评估</span></strong></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;visibility: visible;" width="126" valign="top" height="23"><p style="visibility: visible;"><span style="font-size: 14px;visibility: visible;">危害评级</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;visibility: visible;" width="261" valign="top" height="23"><p style="visibility: visible;"><span style="font-size: 14px;visibility: visible;">高危</span></p></td></tr><tr style="mso-yfti-irow:2;height:23.3pt;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top" height="23"><p><span style="font-size: 14px;">漏洞类型</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;" width="233" valign="top" height="23"><p><span style="font-size: 14px;"></span><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);">RCE</span></p></td></tr><tr style="mso-yfti-irow:3;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top"><p><span style="font-size: 14px;">公开程度</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;" width="233" valign="top"><p><span style="font-size: 14px;">PoC已公开</span></p></td></tr><tr style="mso-yfti-irow:4;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top"><p><span style="font-size: 14px;">利用条件</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;" width="233" valign="top"><p><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);"></span><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);">1.在受影响版本内</span></p><section style="line-height: 1.6em;text-align: justify;margin: 0px;text-indent: 0em;"><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);">2.Broker端口对公网开放且缺乏权限控制</span></section></td></tr><tr style="mso-yfti-irow:5;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top"><p><span style="font-size: 14px;">交互要求</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="233" valign="top"><p><span style="font-size: 14px;"><span style="font-size: 14px;font-family: 黑体;" lang="EN-US">0-</span>click</span></p></td></tr><tr style="mso-yfti-irow:6;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top"><p><span style="font-size: 14px;">威胁类型</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="233" valign="top"><p><span style="font-size: 14px;">远程</span></p></td></tr><tr style="mso-yfti-irow:7;"><td rowspan="2" style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191);border-style: none solid solid;border-width: medium 1pt 1pt;padding: 0cm 5.4pt;" width="91" valign="top"><p><strong><span style="font-size: 15px;">利用情报</span></strong></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="126" valign="top"><p><span style="font-size: 14px;">在野利用</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="261" valign="top"><p><span style="font-size: 14px;">无</span></p></td></tr><tr style="mso-yfti-irow:8;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top"><p><span style="font-size: 14px;">漏洞活跃度</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;" width="233" valign="top"><p><span style="font-size: 14px;">中</span></p></td></tr><tr style="mso-yfti-irow:9;"><td rowspan="4" style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191);border-style: none solid solid;border-width: medium 1pt 1pt;padding: 0cm 5.4pt;" width="91" valign="top"><p><strong><span style="font-size: 15px;">影响产品</span></strong></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="126" valign="top"><p><span style="font-size: 14px;">产品名称</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;" width="261" valign="top"><p><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);">Apache RocketMQ</span></p></td></tr><tr style="mso-yfti-irow:10;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top"><p><span style="font-size: 14px;">受影响版本</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;" width="233" valign="top"><p><span style="font-size: 14px;"></span><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);"></span><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);">5.0.0 &lt;= version &lt;= 5.1.0</span></p><section style="line-height: 1.6em;text-align: justify;margin: 0px;text-indent: 0em;"><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);">4.0.0 &lt;= version &lt;= 4.9.5</span><span style="font-size: 14px;letter-spacing: 0.578px;text-decoration: rgba(0, 0, 0, 0.9);"></span></section></td></tr><tr style="mso-yfti-irow:11;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top"><p><span style="font-size: 14px;">影响范围</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;" width="233" valign="top"><p><span style="font-size: 14px;">中</span></p></td></tr><tr style="mso-yfti-irow:12;mso-yfti-lastrow:yes;height:26.7pt;"><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;" width="92" valign="top" height="26"><p><span style="font-size: 14px;">有无修复补丁</span></p></td><td style="border-color: currentcolor rgb(191, 191, 191) rgb(191, 191, 191) currentcolor;border-style: none solid solid none;border-width: medium 1pt 1pt medium;padding: 0cm 5.4pt;word-break: break-all;" width="233" valign="top" height="26"><p><span style="font-size: 14px;">有</span></p></td></tr></tbody></table>  
  
03 漏洞复现   
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/fFyp1gWjicMLU9FM262QEwXhEXulJD9FjdwqmcvJx8ovxx49MtiawXu3qVR5cqLPklGl96PibRXfgJud9icHQvvia2A/640?wx_fmt=png "")  
### 04 修复方案 1、官方修复方案官方已发布修复方案，受影响的用户建议升级至安全版本（5.x版本升级至5.1.1，4.x版本升级至4.9.6）。https://rocketmq.apache.org/download/2、临时修复方案不建议将Apache RocketMQ直接暴露在公网。如果业务场景要求Apache RocketMQ向公网开放，建议对NameServer、Broker等端口的访问权限最小化，避免未授权条件下允许外部访问。  
### 05 微步产品侧支持情况  微步威胁感知平台TDP已支持检测，规则ID为S3100120106、S3100120116、S3100120119。  
### 06 时间线 2023.05.19 厂商发布补丁2023.05.31 获取该漏洞相关情报2023.05.31 漏洞复现与分析2023.05.31 微步威胁感知平台TDP支持检测2023.06.01 微步发布报告  
  
****  
**---End---**  
  
**CSOP 2023**  
  
网络安全领域最具专业性的年度盛会之一 CSOP 2023 网络安全运营与实战大会将于6月8日在深圳继续，安全负责人和CISO不能错过~  
  
长按识别下方二维码即可报名：  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/fFyp1gWjicMJgBbKyaSXC71DLyNChz2uq2kY5VibvESCibg6ich9ibTUBANVKwcxzzSkD7ITThHTp1kaQSkxgmR3Z1A/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
**微步漏洞情报订阅服务**  
  
微步漏洞情报订阅服务是由微步漏洞团队面向企业推出的一项高级分析服务，致力于通过微步自有产品强大的高价值漏洞发现和收集能力以及微步核心的威胁情报能力，为企业提供0day漏洞预警、最新公开漏洞预警、漏洞分析及评估等漏洞相关情报，帮助企业应对最新0day/1day等漏洞威胁并确定漏洞修复优先级，快速收敛企业的攻击面，保障企业自身业务的正常运转。  
  
点击“  
**阅读原文**”，报名 CSOP 2023 大会  
  
