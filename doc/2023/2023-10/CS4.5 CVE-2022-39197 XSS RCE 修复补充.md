#  CS4.5: CVE-2022-39197 XSS RCE 修复补充   
原创 酒零  NOVASEC   2023-10-25 09:30  
  
![](https://mmbiz.qpic.cn/mmbiz_png/toroKEibicmZDxicuqPkFfjdG2kcyzCXrXf0zrlDGZOnCofnEffxJaK5EDWfvZprrvHVAGSxiaSeXibS6GerhEAsLjw/640?wx_fmt=png "")  
  
  
  
  
**△△△点击上方“蓝字”关注我****们了解更多精彩**  
  
  
  
  
  
**0x00 前言**  
  
  
  
昨天聊到CS4.7.1以前版本那个XSS RCE的修复不完善,还说没有办法修复来着...  
  
  
其实嘛,是没有说全面的, 只是如果单纯修改html.disable属性来修复这个XSS, 因为会遗漏很多compent，所以会导致漏洞不完善.  
  
  
但是我们换一种思路, 就像是修复常规的XSS漏洞一样，只要把特殊字符转义就可以了.  
  
  
  
**0x01 File Browser功能XSS修复**  
  
  
直接在这里把文件名等属性转义, XSS就修复了  
```
   public void result(String key, Object o) {
      LinkedList results = new LinkedList();
      String[] rows = o.toString().trim().split("\n");
      String cwd = rows[0].substring(0, rows[0].length() - 2);

      for(int x = 1; x < rows.length; ++x) {
         String[] cols = rows[x].split("\t");
         Map next = new HashMap();
         if (cols[0].equals("D") && !".".equals(cols[3]) && !"..".equals(cols[3])) {
            next.put("D", "dir");
            next.put("Modified", cols[2]);
            next.put("Name", HtmlSpecialChars.htmlSpecialChars(cols[3]));
            results.add(next);
         } else if (cols[0].equals("F")) {
            next.put("D", "fil");
            next.put("Size", cols[1]);
            next.put("Modified", cols[2]);
            next.put("Name", HtmlSpecialChars.htmlSpecialChars(cols[3]));
            results.add(next);
         }
      }

      if (this.updateTreeModel(cwd, o.toString(), results)) {
         DialogUtils.setText(this.folder, cwd);
         DialogUtils.setTable(this.table, this.model, results);
      }
   }
   
   
```  
  
     
  
  
  
**0x02 修复截图**  
  
****  
![](https://mmbiz.qpic.cn/mmbiz_png/toroKEibicmZBicPBzf735NjNpWH5pTFEWoicUGsSxA7ia7TicuUicmtWIYrCIeJzaTEhHO7sW5n2JpbKKqyHS9qEVOfg/640?wx_fmt=png "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/toroKEibicmZBicPBzf735NjNpWH5pTFEWo7O1bjF1vPnXs7pB5k4VsKffjlGtf37HyJPHxQhP6EOD8NgQP9doQ2g/640?wx_fmt=png "")  
  
  
  
  
**0x03****总结**  
  
  
主要还  
是太菜了,导致这个漏洞修了这么久.  
  
  
PS: 这不是完整的代码  
，session和process l  
i  
st  
的修复没有贴上去.相信大家可以获取到  
,或者等我哪天更新下  
.  
  
  
  
  
**0x99 免责声明**  
  
  
在学习本文技术或工具使用前，请您务必审慎阅读、充分理解各条款内容。  
  
  
1、本团队分享的任何类型技术、工具文章等文章仅面向合法授权的企业安全建设行为与个人学习行为，严禁任何组织或个人使用本团队技术或工具进行非法活动。  
  
  
2、在使用本文相关工具及技术进行测试时，您应确保该行为符合当地的法律法规，并且已经取得了足够的授权。如您仅需要测试技术或工具的可行性，建议请自行搭建靶机环境，请勿对非授权目标进行扫描。  
  
  
3、如您在使用本工具的过程中存在任何非法行为，您需自行承担相应后果，我们将不承担任何法律及连带责任。  
  
  
4、本团队目前未发起任何对外公开培训项目和其他对外收费项目，严禁任何组织或个人使用本团队名义进行非法盈利。  
  
  
5、本团队所有分享工具及技术文章，严禁不经过授权的公开分享。  
  
  
如果发现上述禁止行为，我们将保留追究您法律责任的权利，并由您自身承担由禁止行为造成的任何后果。  
  
  
  
END  
  
  
  
如您有任何  
投稿、  
问题、建议、需求、  
合作、请  
后台留言NOVASEC公众号！  
  
![](https://mmbiz.qpic.cn/mmbiz_png/toroKEibicmZCP3AeicSCQAYIOvxVDSRUxpiadmBKZ8gtggx02BmG1WwCqoM23l72qV8AiabXSRKjGmk8S1HS1nTjXw/640?wx_fmt=png "")  
  
或添  
加NOVASEC-酒零   
以便于及时回复。  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/toroKEibicmZD7m4f7uBkNfCG8BjypNEukN0Ht6Ha0XsryrmS5PAmaVeyzb3JzsH5ibx6DmpHq9e8agwMkccrwNSQ/640?wx_fmt=jpeg "微信图片_20201214143605.jpg")  
  
  
感谢大哥们的对NOVASEC的支持点赞和关注  
  
加入我们与萌新一起成长吧！  
  
  
**本团队任何技术及文件仅用于学习分享，请勿用于任何违法活动，感谢大家的支持！！**  
  
  
  
  
