#  As-Exploits 1.5更新   
原创 yzddMr6  网络安全回收站   2023-10-21 16:57  
  
## 更新日志  
1. 新增支持jspjs/aspxcsharp类型  
  
1. 除内存马/内存马管理模块以外，均支持Tomcat10  
  
1. 内存马注入模块更新:  
  
1. Filter类型：新增PystingerFilter，SorFilter  
  
1. 新增WebSocket类型：CmdWs，CmdBase64Ws，JSPJSWs，JSPJSBase64Ws  
  
1. 不再支持Servlet内存马  
  
1. 内存马管理模块新增Listener、Tomcat-Value、Timer、Websocket 、Upgrade 、ExecutorShell内存马的查杀检测（thx https://github.com/ruyueattention/java-memshell-scanner）  
  
1. Jar加载器模块内存加载功能BUG修复  
  
1. ShellCode加载-JNA模块更新，提高兼容性跟稳定性  
  
1. execPayload模块支持新增额外参数  
  
1. 新增Js引擎执行模块，可用Payload见：https://github.com/yzddmr6/Java-Js-Engine-Payloads  
  
1. aspxcsharp类型支持回显自定义分隔符  
  
1. aspxcsharp新增SharpLoader模块，支持内存加载、远程加载Assembly；支持获取已加载过的Assembly，无需重复上传；支持传递命令行参数，自动获取输入输出。  
  
## 兼容Tomcat 10  
  
不用多解释![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4euWRRxbBpgY6VAsohgdEULQic17pmt0WzqJxmzjTJxmIgS4dBaOdJY8A/640?wx_fmt=png "")  
  
## 新增WebSocket内存马  
  
新增4中WebSocket类型内存马：CmdWs，CmdBase64Ws，JSPJSWs，JSPJSBase64Ws
注意Websocket的路径不能填/*![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4e9MWBlEgs20OhKycTKzclHfcFluf2oTluy5XNdLF8V13Fl2ztGc1SHQ/640?wx_fmt=png "")  
内存马管理模块中可以看到已经注入成功![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eezibMHyiaTu7cgvGczbPLBabd2NuWKicn0ZKTqShxPDtdMrCg21MspliaQ/640?wx_fmt=png "")  
通过ws协议直接连接![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4ecj8o2cgnAUJs5ibMOfxsTIdaejLOyibe3gLg5faRHgBWibSY8hMvIIAYQ/640?wx_fmt=png "")  
卸载内存马![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4ejCJYlzdkYZfSk7SbicdO9fl0ttYUd5NViaT8p56opeaQfFpPOOViaM5dA/640?wx_fmt=png "")  
也可以打入cmd类型，通过Chrome插件手动发送命令![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eLkKPhNMjpUIRTDILOBSvdtxBtO29BlWzQvl7BKWW5F6n2Oq8aKfSBg/640?wx_fmt=png "")  
  
## 新增6种内存马检测  
  
增加Listener、Tomcat-Value、Timer、Websocket 、Upgrade 、ExecutorShell内存马的查杀检测
核心代码来自：https://github.com/ruyueattention/java-memshell-scanner![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4e8TibR4dRviagmATsKp0qm1SFgzNksWRqUC4QpeCxfYnyd9tEJUYRVIqQ/640?wx_fmt=png "")  
  
## 内存加载ShellCode  
  
通过Jar加载器-内存加载，上传ext目录下的loader.jar![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eP1M48SOndrp0MOrzgbGbR9e4HUL1a8vWAh0nwAXkgqv5Y0wPGscfVg/640?wx_fmt=png "")  
可以通过Js引擎执行功能先试一下看类在不在，发现确实可以查找到![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eliaWkUtIVsuvican8VTe8qjlbmkHhINJP3Tz2zyb0WicUC9VqYhlzZWHw/640?wx_fmt=png "")  
ShellCode加载器模块-加载方式JNA，exploit，弹出计算器，也就实现了内存加载ShellCode的功能![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eDY4sQsNnEZUEOwrpA9l1GogL3niafYn910tibSl7anRTLibh78HRY3ERg/640?wx_fmt=png "")  
  
## SharpLoader  
  
具体实现可以看之前写的文章：https://yzddmr6.com/posts/as-exploits-sharploader/
以Efspotato为例  
### 内存加载  
  
选择我们要加载的本地文件即可![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eq4I1njzZRgd5kkx2OicdgkA7kN7MD2G5ura0iccKUmCZicicKHG4hrHkQQ/640?wx_fmt=png "")  
  
### URL加载  
  
把exp托管到一个web上，然后填写远程URl地址![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4e3p0TLgf6HInAia5069QtA6AftR9Lttf4mVEtpDQicPjUefCWAL0JUQzA/640?wx_fmt=png "")  
需要注意的是，这里有一个坑。本来想着可以直接去加载github上面各种编译好的payload，但是发现.net 4好像不支持tls1.2https://stackoverflow.com/questions/47269609/system-net-securityprotocoltype-tls12-definition-not-found![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4ekrNY7fqiaJTCX6tl0s8EzrGIdA0myOLh1iabYia5hPphick7N0eyPEctOQ/640?wx_fmt=png "")  
那还是自己搭个http的服务吧  
### 通过名称加载  
  
在前面通过内存或者URL加载过的程序集，后续都可以通过项目名来反射加载。可以先通过 **获取已加载的Assembly** 功能来获取之前所有打进去过的项目名，多个结果以|分割![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4e28GwicPtdwyzDhvuqtByRzPPh5MnUkSpkzdvjoLDg9qFniaC3TrOmrag/640?wx_fmt=png "")  
填入你想要反射的Assembly的名称，加上要执行的参数，exploit！![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4e50hrkMbkeHVpxOBNllTJZdV4aibrjTFGicXH1rrzSVMz6B60scaHUbOQ/640?wx_fmt=png "")  
成功调用
参数内空格分割符：{}
例如需要执行 cmd /c 'net user'
则填写 cmd /c net{}user即可  
## 联动JMG实现内存马扩展  
  
As-Exploits设计理念之一就是要提供良好的扩展性，这里以 执行自定义Payload 功能举例。虽然插件中内置了一些常见的内存马，但是在实际中我们可能想打入一些别的内存马。这里可以借助pen4uin师傅的JMG项目生成一个蚁剑-Listener内存马
打开JMG，选择内存马类型，中间件类型，设置密码，输出格式选择Base64![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eKM5Kic2SDYGficyatQtAmoUJNs0gictwiagYRWcK4GAQziazFGic1NcvHF6w/640?wx_fmt=png "")  
生成之后把Payload贴进去，执行![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eiaDHa3fWbyNBD54ByQNI6hfaichgjlibu7wiblb4kUQhtylKcPeSyLJkpg/640?wx_fmt=png "")  
通过内存马管理模块可以看到已经打进去了一个Listener![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4embT6Lic39ohGYHVOZ64049dMpSO0MzZPyUK5FsDO4qQyXtXhlgibb42Q/640?wx_fmt=png "")  
配置连接的时候别忘了配置敲门的header参数，成功连接![](https://mmbiz.qpic.cn/sz_mmbiz_png/LtiayO136fU4j9YO4WHicvge4MgYibjfib4eTMkJqIRf694BSEqY7sBqRhDQnlQhsaHfGHISWhL5Ondvic1ApCMo2Ng/640?wx_fmt=png "")  
  
  
  
